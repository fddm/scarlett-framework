/*! scarlett-framework 2017-02-10 */
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function CallbackResponse(a){a=a||{},this.success=a.success,this.data=a.data||{}}function Logger(a){a=a||{},this._context=a.context||"Default"}function isObjectAssigned(a){return"undefined"!=typeof a&&null!==a}function isString(a){return"string"==typeof a}function isNumber(a){return"number"==typeof a}function isGame(a){return a instanceof Game}function isGameScene(a){return a instanceof GameScene}function isTexture2D(a){return a instanceof Texture2D}function isFunction(a){return"function"==typeof a}function isSprite(a){return a instanceof Sprite}function inheritsFrom(a,b){a.prototype=Object.create(b.prototype)}function generateUID(){return++_SS_UID}function capitalize(a){return a.length>=2?a.charAt(0).toUpperCase()+a.slice(1):1==a.length?a.charAt(0).toUpperCase():a}function splitCamelCase(a){return a.replace(/([a-z](?=[A-Z]))/g,"$1 ")}function getType(a){return null===a?"[object Null]":a.getType?a.getType():a.constructor.name||Object.prototype.toString.call(a)}function isEqual(a,b){return isFunction(a.equals)?a.equals(b):a===b}function RigidBody(a){a=a||{},this.gameObject=null,this._isStatic=a["static"]||!1,this._mass=a.mass||null,this._friction=a.friction||null,this._body=null}function ContentObject(a){}function ProjectFile(a){a=a||{},this.name=a.name||"New Project",this.settings=a.settings||{},this.editor=a.editor||{lastScene:null,layout:null},this.content=a.content||{}}function TextureAtlas(a){a=a||{},this.sourcePath=a.sourcePath||"",this.mapping=[]}function Camera2D(a,b,c,d,e){this.x=a||0,this.y=b||0,this.zoom=e||1,this.viewWidth=c||0,this.viewHeight=d||0,this._lastX=null,this._lastY=null,this._lastZoom=null,this._matrix=mat4.create(),this._omatrix=mat4.create()}function Color(a,b,c,d,e){this.r=0,this.g=0,this.b=0,this.a=1,this.setSpecial(a,b,c,d,e)}function FontStyle(a){this._fontDescription=a,this._fontSize=70,this._letterSpacing=0}function Game(a){a=a||{};var b=800,c=640;this._renderContext=null,this._logger=new Logger("Game"),this._initialized=!1,this._gameScene=a.scene,this._totalElapsedTime=null,this._virtualResolution=null,this._shaderManager=null,this._executionPhase=SC.EXECUTION_PHASES.WAITING,this._physicsEngine=Matter.Engine.create(),this._physicsEngine.enableSleeping=!0,this._renderExtensions={},this._paused=!1,this._swapScene=null,this._swappingScenes=!1,this._inputHandlersBinded=!1,Matter.Engine.run(this._physicsEngine),this.setVirtualResolution(b,c),isString(a.target)&&this.setTarget(a.target)}function GameProject(a){this.name=a}function GameScene(a){if(a=a||{},!a.game)throw"cannot create a game scene without the game parameter";this.name=a.name||"GameScene",this._uid=generateUID(),this._game=a.game||null,this._backgroundColor=a.backgroundColor||Color.CornflowerBlue,this._gameObjects=a.gameObjects||[],this._camera=a.camera||new Camera2D(0,0,this._game.getVirtualResolution().width,this._game.getVirtualResolution().height),this._spriteBatch=new SpriteBatch(a.game)}function PrimitiveBatch(a){if(!isGame(a))throw new Error("Cannot create primitive render, the Game object is missing from the parameters");this._game=a,this._gl=a.getRenderContext().getContext(),this._primitiveShader=new PrimitiveShader,this._vertexBuffer=this._gl.createBuffer(),this._colorBuffer=this._gl.createBuffer(),this._rectangleVertexData=[],this._rectangleColorData=[],this._rectangleCount=0,this._transformMatrix=mat4.create(),this._rectangleData=new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])}function PrimitiveRender(a){if(!isGame(a))throw"Cannot create primitive render, the Game object is missing from the parameters";this._game=a,this._gl=a.getRenderContext().getContext(),this._primitiveShader=new PrimitiveShader,this._vertexBuffer=this._gl.createBuffer(),this._transformMatrix=mat4.create(),this._rectangleData=new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),this._pointData=new Float32Array([0,0])}function Scripts(){}function Sound(a){if(!isObjectAssigned(a))throw new Error("Cannot create Sound without a valid audio source");this._source=a}function Sprite(a){a=a||{},a.name=a.name||"Sprite",GameObject.call(this,a),this._source="",this._atlasRegion="",this._tint=a.tint||Color.fromRGB(255,255,255),this._textureWidth=0,this._textureHeight=0,this._origin=new Vector2(.5,.5),this._wrapMode=WrapMode.CLAMP,this._atlas=null,this.setTexture(a.texture)}function SpriteBatch(a){if(!isGame(a))throw new Error("Cannot create sprite render, the Game object is missing from the parameters");this._game=a,this._gl=a.getRenderContext().getContext(),this._vertexBuffer=this._gl.createBuffer(),this._texBuffer=this._gl.createBuffer(),this._textureShader=new TextureShader,this._lastTexUID=-1,this._sprites=[],this._rectangleData=new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),this._textureData=new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])}function SpriteBatchOld(a){if(!isGame(a))throw new Error("Cannot create sprite render, the Game object is missing from the parameters");this._game=a,this._gl=a.getRenderContext().getContext(),this._vertexBuffer=this._gl.createBuffer(),this._texBuffer=this._gl.createBuffer(),this._transformMatrix=mat4.create(),this._textureShader=new TextureShader,this._lastTexUID=-1,this._drawData=[],this._rectangleData=new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),this._textureData=new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])}function Stroke(a,b){this._color=a||Color.fromRGBA(0,0,0,1),this._size=b||0}function Text(a){a=a||{},a.name=a.name||"Text",GameObject.call(this,a),this._fontStyle=new FontStyle(a.font||{}),this._fontStyle.setFontSize(a.fontSize||70),this._fontStyle.setLetterSpacing(a.letterSpacing||0),this._wordWrap=!0,this._characterWrap=!0,this._alignType=Text.AlignType.LEFT,this._textureSrc="",this._color=a.color||Color.fromRGBA(164,56,32,1),this._text=a.text||"",this._gamma=a.gamma||2,this._stroke=new Stroke(Color.fromRGBA(186,85,54,.5),0),this._dropShadow=new Stroke(Color.fromRGBA(0,0,0,1),5),this._dropShadowOffset=new Vector2(0,0),this._debug=0,this._gl=GameManager.renderContext.getContext(),this._vertexBuffer=this._gl.createBuffer(),this._textureBuffer=this._gl.createBuffer(),this._vertexIndicesBuffer=this._gl.createBuffer(),this._textShader=new TextShader,this.setTexture(a.texture)}function Texture2D(a){if(!isObjectAssigned(a))throw new Error("Cannot create Texture2D without an image source");this._uid=generateUID(),this._source=a,this._texture=null,this._gl=GameManager.renderContext.getContext();var b=this._gl;this._texture=b.createTexture(),b.bindTexture(b.TEXTURE_2D,this._texture),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,this._source),this._hasLoaded=!0}function Transform(a){a=a||{},this.gameObject=a.gameObject||null,this._position=a.position||new Vector2,this._rotation=a.rotation||0,this._scale=a.scale||new Vector2(1,1),this._overridePositionFunction=null,this._overrideRotationFunction=null,this._overrideScaleFunction=null}function GridExt(a){if(a=a||{},!a.game)throw"cannot create debug extension without game parameter";this.enabled=!0,this._game=a.game||null,this._gridSize=a.gridSize||32,this._gridColor=a.gridColor||Color.Red,this._originLines=!0,this._zoomMultiplier=2,this._primitiveRender=new PrimitiveRender(a.game)}function Keyboard(){}function KeyboardState(a){this._keys=[],a.forEach(function(a){this._keys.push(a)}.bind(this))}function Keys(){}function Boundary(a,b,c,d){this.topLeft=a||new Vector2,this.topRight=b||new Vector2,this.bottomRight=c||new Vector2,this.bottomLeft=d||new Vector2}function Ray(a,b){this.origin=a||0,this.direction=b||0}function Rectangle(a,b,c,d){this.x=a||0,this.y=b||0,this.width=c||10,this.height=d||10}function Vector2(a,b){this.x=a||0,this.y=b||0}function Vector3(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0}function Vector4(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=d||0}function Shader(a,b,c,d){if(!isObjectAssigned(a)||!isObjectAssigned(b))throw new Error("Vertex and Fragment scripts are required to create a shader, discarding..");if(!isObjectAssigned(GameManager.renderContext))throw new Error("The WebGL render context is not yet set, can't create shader.");this.uniforms=c||{},this.attributes=d||{},this._gl=GameManager.renderContext.getContext(),this._program=null,this._vertexScript=a,this._fragmentScript=b,this._textureCount=1,this._uid=generateUID(),this.setup()}function ShaderManager(a){this._game=a,this._gl=this._game.getRenderContext().getContext(),this._activeShader=null}function TestShader(){Shader.call(this,["attribute vec4 a_position;","void main() {","gl_Position = a_position;","}"].join("\n"),["precision mediump float;","void main() {","gl_FragColor = vec4(1, 0, 0.5, 1);","}"].join("\n"),{},{a_position:0})}function TextShader(){Shader.call(this,["attribute vec2 aPos;","attribute vec2 aTexCoord;","uniform mat4 uMatrix;","uniform mat4 uTransform;","uniform vec2 uTexSize;","varying vec2 vTexCoord;","void main() {","gl_Position = uMatrix * uTransform * vec4(aPos, 0, 1);","vTexCoord = aTexCoord / uTexSize;","}"].join("\n"),["#ifdef GL_ES","   precision mediump float;","#endif","uniform sampler2D uTexture;","uniform vec4 uColor;","uniform float uGamma;","uniform float uOutlineDistance;","uniform vec4 uOutlineColor;","uniform vec4 uDropShadowColor;","uniform float uDropShadowSmoothing;","uniform vec2 uDropShadowOffset;","uniform float uDebug;","varying vec2 vTexCoord;","void main() {","  float distance = texture2D(uTexture, vTexCoord).a;","  vec4 finalColor = uColor;","  if (uDebug > 0.0) {","     gl_FragColor = vec4(distance, distance, distance, 1);","  } else {","       if (uOutlineDistance <= 0.5) {","           float outlineFactor = smoothstep(0.5 - uGamma, 0.5 + uGamma, distance);","           vec4 color = mix(uOutlineColor, uColor, outlineFactor);","           float alpha = smoothstep(uOutlineDistance - uGamma, uOutlineDistance + uGamma, distance);","           finalColor = vec4(color.rgb, color.a * alpha);","       } else {","           float alpha = smoothstep(0.5 - uGamma, 0.5 + uGamma, distance);","           finalColor = vec4(uColor.rgb, uColor.a * alpha);","       }","       float shadowDistance = texture2D(uTexture, vTexCoord - uDropShadowOffset).a;","       float shadowAlpha = smoothstep(0.5 - uDropShadowSmoothing, 0.5 + uDropShadowSmoothing, shadowDistance);","       vec4 shadow = vec4(uDropShadowColor.rgb, uDropShadowColor.a * shadowAlpha);","       gl_FragColor = mix(shadow, finalColor, finalColor.a);","  }","}"].join("\n"),{uMatrix:{type:"mat4",value:mat4.create()},uTransform:{type:"mat4",value:mat4.create()},uTexture:{type:"tex",value:0},uTexSize:{type:"1i",value:24},uColor:[1,0,0,1],uOutlineColor:[1,1,1,1],uDropShadowColor:[0,0,0,1],uDropShadowSmoothing:{type:"1i",value:0},uDropShadowOffset:[0,0],uOutlineDistance:{type:"1i",value:0},uGamma:{type:"1i",value:0},uDebug:{type:"1i",value:1}},{aPos:0,aTexCoord:0})}function TextureShader(){Shader.call(this,["precision mediump float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat4 uMatrix;","uniform mat4 uTransform;","varying vec2 vTextureCoord;","void main(void){","   gl_Position = uMatrix * uTransform * vec4(aVertexPosition, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"].join("\n"),["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform vec4 uColor;","void main(void){","   gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;","}"].join("\n"),{uSampler:{type:"tex",value:0},uMatrix:{type:"mat4",value:mat4.create()},uTransform:{type:"mat4",value:mat4.create()},uColor:[1,1,1,1]},{aVertexPosition:0,aTextureCoord:0})}function WebGLContext(a){a=a||{},this._logger=new Logger("WebGLContext"),this._canvas=null,this._gl=null,isObjectAssigned(a.renderContainer)&&this.assignContextFromContainer(a.renderContainer)}function WebGLUtils(){this._logger=new Logger("WebGLUtils")}function PrimitiveShader(){Shader.call(this,["attribute vec2 aVertexPosition;","uniform mat4 uMatrix;","uniform mat4 uTransform;","uniform float uPointSize;","void main(void) {","   gl_PointSize = uPointSize;","   gl_Position = uMatrix * uTransform * vec4(aVertexPosition, 0.0, 1.0);","}"].join("\n"),["precision mediump float;","uniform vec4 uColor;","void main(void) {","   gl_FragColor = uColor;","}"].join("\n"),{uMatrix:{type:"mat4",value:mat4.create()},uTransform:{type:"mat4",value:mat4.create()},uColor:[0,0,0,1],uPointSize:2},{aVertexPosition:0})}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};!function(a){if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Matter=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d={};b.exports=d;var e=a("../geometry/Vertices"),f=a("../geometry/Vector"),g=a("../core/Sleeping"),h=(a("../render/Render"),a("../core/Common")),i=a("../geometry/Bounds"),j=a("../geometry/Axes");!function(){d._inertiaScale=4,d._nextCollidingGroupId=1,d._nextNonCollidingGroupId=-1,d._nextCategory=1,d.create=function(b){var c={id:h.nextId(),type:"body",label:"Body",parts:[],angle:0,vertices:e.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0},lineWidth:1.5}},d=h.extend(c,b);return a(d,b),d},d.nextGroup=function(a){return a?d._nextNonCollidingGroupId--:d._nextCollidingGroupId++},d.nextCategory=function(){return d._nextCategory=d._nextCategory<<1,d._nextCategory};var a=function(a,b){d.set(a,{bounds:a.bounds||i.create(a.vertices),positionPrev:a.positionPrev||f.clone(a.position),anglePrev:a.anglePrev||a.angle,vertices:a.vertices,parts:a.parts||[a],isStatic:a.isStatic,isSleeping:a.isSleeping,parent:a.parent||a}),e.rotate(a.vertices,a.angle,a.position),j.rotate(a.axes,a.angle),i.update(a.bounds,a.vertices,a.velocity),d.set(a,{axes:b.axes||a.axes,area:b.area||a.area,mass:b.mass||a.mass,inertia:b.inertia||a.inertia});var c=a.isStatic?"#eeeeee":h.choose(["#556270","#4ECDC4","#C7F464","#FF6B6B","#C44D58"]),g=h.shadeColor(c,-20);a.render.fillStyle=a.render.fillStyle||c,a.render.strokeStyle=a.render.strokeStyle||g,a.render.sprite.xOffset+=-(a.bounds.min.x-a.position.x)/(a.bounds.max.x-a.bounds.min.x),a.render.sprite.yOffset+=-(a.bounds.min.y-a.position.y)/(a.bounds.max.y-a.bounds.min.y)};d.set=function(a,b,c){var e;"string"==typeof b&&(e=b,b={},b[e]=c);for(e in b)if(c=b[e],b.hasOwnProperty(e))switch(e){case"isStatic":d.setStatic(a,c);break;case"isSleeping":g.set(a,c);break;case"mass":d.setMass(a,c);break;case"density":d.setDensity(a,c);break;case"inertia":d.setInertia(a,c);break;case"vertices":d.setVertices(a,c);break;case"position":d.setPosition(a,c);break;case"angle":d.setAngle(a,c);break;case"velocity":d.setVelocity(a,c);break;case"angularVelocity":d.setAngularVelocity(a,c);break;case"parts":d.setParts(a,c);break;default:a[e]=c}},d.setStatic=function(a,b){for(var c=0;c<a.parts.length;c++){var d=a.parts[c];d.isStatic=b,b&&(d.restitution=0,d.friction=1,d.mass=d.inertia=d.density=1/0,d.inverseMass=d.inverseInertia=0,d.positionPrev.x=d.position.x,d.positionPrev.y=d.position.y,d.anglePrev=d.angle,d.angularVelocity=0,d.speed=0,d.angularSpeed=0,d.motion=0)}},d.setMass=function(a,b){a.mass=b,a.inverseMass=1/a.mass,a.density=a.mass/a.area},d.setDensity=function(a,b){d.setMass(a,b*a.area),a.density=b},d.setInertia=function(a,b){a.inertia=b,a.inverseInertia=1/a.inertia},d.setVertices=function(a,b){b[0].body===a?a.vertices=b:a.vertices=e.create(b,a),a.axes=j.fromVertices(a.vertices),a.area=e.area(a.vertices),d.setMass(a,a.density*a.area);var c=e.centre(a.vertices);e.translate(a.vertices,c,-1),d.setInertia(a,d._inertiaScale*e.inertia(a.vertices,a.mass)),e.translate(a.vertices,a.position),i.update(a.bounds,a.vertices,a.velocity)},d.setParts=function(a,c,f){var g;for(c=c.slice(0),a.parts.length=0,a.parts.push(a),a.parent=a,g=0;g<c.length;g++){var h=c[g];h!==a&&(h.parent=a,a.parts.push(h))}if(1!==a.parts.length){if(f="undefined"==typeof f||f){var i=[];for(g=0;g<c.length;g++)i=i.concat(c[g].vertices);e.clockwiseSort(i);var j=e.hull(i),k=e.centre(j);d.setVertices(a,j),e.translate(a.vertices,k)}var l=b(a);a.area=l.area,a.parent=a,a.position.x=l.centre.x,a.position.y=l.centre.y,a.positionPrev.x=l.centre.x,a.positionPrev.y=l.centre.y,d.setMass(a,l.mass),d.setInertia(a,l.inertia),d.setPosition(a,l.centre)}},d.setPosition=function(a,b){var c=f.sub(b,a.position);a.positionPrev.x+=c.x,a.positionPrev.y+=c.y;for(var d=0;d<a.parts.length;d++){var g=a.parts[d];g.position.x+=c.x,g.position.y+=c.y,e.translate(g.vertices,c),i.update(g.bounds,g.vertices,a.velocity)}},d.setAngle=function(a,b){var c=b-a.angle;a.anglePrev+=c;for(var d=0;d<a.parts.length;d++){var g=a.parts[d];g.angle+=c,e.rotate(g.vertices,c,a.position),j.rotate(g.axes,c),i.update(g.bounds,g.vertices,a.velocity),d>0&&f.rotateAbout(g.position,c,a.position,g.position)}},d.setVelocity=function(a,b){a.positionPrev.x=a.position.x-b.x,a.positionPrev.y=a.position.y-b.y,a.velocity.x=b.x,a.velocity.y=b.y,a.speed=f.magnitude(a.velocity)},d.setAngularVelocity=function(a,b){a.anglePrev=a.angle-b,a.angularVelocity=b,a.angularSpeed=Math.abs(a.angularVelocity)},d.translate=function(a,b){d.setPosition(a,f.add(a.position,b))},d.rotate=function(a,b){d.setAngle(a,a.angle+b)},d.scale=function(a,c,f,g){for(var h=0;h<a.parts.length;h++){var k=a.parts[h];e.scale(k.vertices,c,f,a.position),k.axes=j.fromVertices(k.vertices),a.isStatic||(k.area=e.area(k.vertices),d.setMass(k,a.density*k.area),e.translate(k.vertices,{x:-k.position.x,y:-k.position.y}),d.setInertia(k,e.inertia(k.vertices,k.mass)),e.translate(k.vertices,{x:k.position.x,y:k.position.y})),i.update(k.bounds,k.vertices,a.velocity)}if(a.circleRadius&&(c===f?a.circleRadius*=c:a.circleRadius=null),!a.isStatic){var l=b(a);a.area=l.area,d.setMass(a,l.mass),d.setInertia(a,l.inertia)}},d.update=function(a,b,c,d){var g=Math.pow(b*c*a.timeScale,2),h=1-a.frictionAir*c*a.timeScale,k=a.position.x-a.positionPrev.x,l=a.position.y-a.positionPrev.y;a.velocity.x=k*h*d+a.force.x/a.mass*g,a.velocity.y=l*h*d+a.force.y/a.mass*g,a.positionPrev.x=a.position.x,a.positionPrev.y=a.position.y,a.position.x+=a.velocity.x,a.position.y+=a.velocity.y,a.angularVelocity=(a.angle-a.anglePrev)*h*d+a.torque/a.inertia*g,a.anglePrev=a.angle,a.angle+=a.angularVelocity,a.speed=f.magnitude(a.velocity),a.angularSpeed=Math.abs(a.angularVelocity);for(var m=0;m<a.parts.length;m++){var n=a.parts[m];e.translate(n.vertices,a.velocity),m>0&&(n.position.x+=a.velocity.x,n.position.y+=a.velocity.y),0!==a.angularVelocity&&(e.rotate(n.vertices,a.angularVelocity,a.position),j.rotate(n.axes,a.angularVelocity),m>0&&f.rotateAbout(n.position,a.angularVelocity,a.position,n.position)),i.update(n.bounds,n.vertices,a.velocity)}},d.applyForce=function(a,b,c){a.force.x+=c.x,a.force.y+=c.y;var d={x:b.x-a.position.x,y:b.y-a.position.y};a.torque+=d.x*c.y-d.y*c.x};var b=function(a){for(var b={mass:0,area:0,inertia:0,centre:{x:0,y:0}},c=1===a.parts.length?0:1;c<a.parts.length;c++){var d=a.parts[c];b.mass+=d.mass,b.area+=d.area,b.inertia+=d.inertia,b.centre=f.add(b.centre,f.mult(d.position,d.mass!==1/0?d.mass:1))}return b.centre=f.div(b.centre,b.mass!==1/0?b.mass:a.parts.length),b}}()},{"../core/Common":14,"../core/Sleeping":20,"../geometry/Axes":23,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27,"../render/Render":29}],2:[function(a,b,c){var d={};b.exports=d;var e=a("../core/Events"),f=a("../core/Common"),g=a("./Body");!function(){d.create=function(a){return f.extend({id:f.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite"},a)},d.setModified=function(a,b,c,e){if(a.isModified=b,c&&a.parent&&d.setModified(a.parent,b,c,e),e)for(var f=0;f<a.composites.length;f++){var g=a.composites[f];d.setModified(g,b,c,e)}},d.add=function(a,b){var c=[].concat(b);e.trigger(a,"beforeAdd",{object:b});for(var g=0;g<c.length;g++){var h=c[g];switch(h.type){case"body":if(h.parent!==h){f.log("Composite.add: skipped adding a compound body part (you must add its parent instead)","warn");break}d.addBody(a,h);break;case"constraint":d.addConstraint(a,h);break;case"composite":d.addComposite(a,h);break;case"mouseConstraint":d.addConstraint(a,h.constraint)}}return e.trigger(a,"afterAdd",{object:b}),a},d.remove=function(a,b,c){var f=[].concat(b);e.trigger(a,"beforeRemove",{object:b});for(var g=0;g<f.length;g++){var h=f[g];switch(h.type){case"body":d.removeBody(a,h,c);break;case"constraint":d.removeConstraint(a,h,c);break;case"composite":d.removeComposite(a,h,c);break;case"mouseConstraint":d.removeConstraint(a,h.constraint)}}return e.trigger(a,"afterRemove",{object:b}),a},d.addComposite=function(a,b){return a.composites.push(b),b.parent=a,d.setModified(a,!0,!0,!1),a},d.removeComposite=function(a,b,c){var e=f.indexOf(a.composites,b);if(e!==-1&&(d.removeCompositeAt(a,e),d.setModified(a,!0,!0,!1)),c)for(var g=0;g<a.composites.length;g++)d.removeComposite(a.composites[g],b,!0);return a},d.removeCompositeAt=function(a,b){return a.composites.splice(b,1),d.setModified(a,!0,!0,!1),a},d.addBody=function(a,b){return a.bodies.push(b),d.setModified(a,!0,!0,!1),a},d.removeBody=function(a,b,c){var e=f.indexOf(a.bodies,b);if(e!==-1&&(d.removeBodyAt(a,e),d.setModified(a,!0,!0,!1)),c)for(var g=0;g<a.composites.length;g++)d.removeBody(a.composites[g],b,!0);return a},d.removeBodyAt=function(a,b){return a.bodies.splice(b,1),d.setModified(a,!0,!0,!1),a},d.addConstraint=function(a,b){return a.constraints.push(b),d.setModified(a,!0,!0,!1),a},d.removeConstraint=function(a,b,c){var e=f.indexOf(a.constraints,b);if(e!==-1&&d.removeConstraintAt(a,e),c)for(var g=0;g<a.composites.length;g++)d.removeConstraint(a.composites[g],b,!0);return a},d.removeConstraintAt=function(a,b){return a.constraints.splice(b,1),d.setModified(a,!0,!0,!1),a},d.clear=function(a,b,c){if(c)for(var e=0;e<a.composites.length;e++)d.clear(a.composites[e],b,!0);return b?a.bodies=a.bodies.filter(function(a){return a.isStatic}):a.bodies.length=0,a.constraints.length=0,a.composites.length=0,d.setModified(a,!0,!0,!1),a},d.allBodies=function(a){for(var b=[].concat(a.bodies),c=0;c<a.composites.length;c++)b=b.concat(d.allBodies(a.composites[c]));return b},d.allConstraints=function(a){for(var b=[].concat(a.constraints),c=0;c<a.composites.length;c++)b=b.concat(d.allConstraints(a.composites[c]));return b},d.allComposites=function(a){for(var b=[].concat(a.composites),c=0;c<a.composites.length;c++)b=b.concat(d.allComposites(a.composites[c]));return b},d.get=function(a,b,c){var e,f;switch(c){case"body":e=d.allBodies(a);break;case"constraint":e=d.allConstraints(a);break;case"composite":e=d.allComposites(a).concat(a)}return e?(f=e.filter(function(a){return a.id.toString()===b.toString()}),0===f.length?null:f[0]):null},d.move=function(a,b,c){return d.remove(a,b),d.add(c,b),a},d.rebase=function(a){for(var b=d.allBodies(a).concat(d.allConstraints(a)).concat(d.allComposites(a)),c=0;c<b.length;c++)b[c].id=f.nextId();return d.setModified(a,!0,!0,!1),a},d.translate=function(a,b,c){for(var e=c?d.allBodies(a):a.bodies,f=0;f<e.length;f++)g.translate(e[f],b);return d.setModified(a,!0,!0,!1),a},d.rotate=function(a,b,c,e){for(var f=Math.cos(b),h=Math.sin(b),i=e?d.allBodies(a):a.bodies,j=0;j<i.length;j++){var k=i[j],l=k.position.x-c.x,m=k.position.y-c.y;g.setPosition(k,{x:c.x+(l*f-m*h),y:c.y+(l*h+m*f)}),g.rotate(k,b)}return d.setModified(a,!0,!0,!1),a},d.scale=function(a,b,c,e,f){for(var h=f?d.allBodies(a):a.bodies,i=0;i<h.length;i++){var j=h[i],k=j.position.x-e.x,l=j.position.y-e.y;g.setPosition(j,{x:e.x+k*b,y:e.y+l*c}),g.scale(j,b,c)}return d.setModified(a,!0,!0,!1),a}}()},{"../core/Common":14,"../core/Events":16,"./Body":1}],3:[function(a,b,c){var d={};b.exports=d;var e=a("./Composite"),f=(a("../constraint/Constraint"),a("../core/Common"));!function(){d.create=function(a){var b=e.create(),c={label:"World",gravity:{x:0,y:1,scale:.001},bounds:{min:{x:-(1/0),y:-(1/0)},max:{x:1/0,y:1/0}}};return f.extend(b,c,a)}}()},{"../constraint/Constraint":12,"../core/Common":14,"./Composite":2}],4:[function(a,b,c){var d={};b.exports=d,function(){d.create=function(a){return{id:d.id(a),vertex:a,normalImpulse:0,tangentImpulse:0}},d.id=function(a){return a.body.id+"_"+a.index}}()},{}],5:[function(a,b,c){var d={};b.exports=d;var e=a("./SAT"),f=a("./Pair"),g=a("../geometry/Bounds");!function(){d.collisions=function(a,b){for(var c=[],h=b.pairs.table,i=0;i<a.length;i++){var j=a[i][0],k=a[i][1];if((!j.isStatic&&!j.isSleeping||!k.isStatic&&!k.isSleeping)&&d.canCollide(j.collisionFilter,k.collisionFilter)&&g.overlaps(j.bounds,k.bounds))for(var l=j.parts.length>1?1:0;l<j.parts.length;l++)for(var m=j.parts[l],n=k.parts.length>1?1:0;n<k.parts.length;n++){var o=k.parts[n];if(m===j&&o===k||g.overlaps(m.bounds,o.bounds)){var p,q=f.id(m,o),r=h[q];p=r&&r.isActive?r.collision:null;var s=e.collides(m,o,p);s.collided&&c.push(s)}}}return c},d.canCollide=function(a,b){return a.group===b.group&&0!==a.group?a.group>0:0!==(a.mask&b.category)&&0!==(b.mask&a.category)}}()},{"../geometry/Bounds":24,"./Pair":7,"./SAT":11}],6:[function(a,b,c){var d={};b.exports=d;var e=a("./Pair"),f=a("./Detector"),g=a("../core/Common");!function(){d.create=function(a){var b={controller:d,detector:f.collisions,buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return g.extend(b,a)},d.update=function(c,d,e,f){var g,m,n,o,p,q=e.world,r=c.buckets,s=!1;for(g=0;g<d.length;g++){var t=d[g];if((!t.isSleeping||f)&&!(t.bounds.max.x<q.bounds.min.x||t.bounds.min.x>q.bounds.max.x||t.bounds.max.y<q.bounds.min.y||t.bounds.min.y>q.bounds.max.y)){var u=b(c,t);if(!t.region||u.id!==t.region.id||f){t.region&&!f||(t.region=u);var v=a(u,t.region);for(m=v.startCol;m<=v.endCol;m++)for(n=v.startRow;n<=v.endRow;n++){p=h(m,n),o=r[p];var w=m>=u.startCol&&m<=u.endCol&&n>=u.startRow&&n<=u.endRow,x=m>=t.region.startCol&&m<=t.region.endCol&&n>=t.region.startRow&&n<=t.region.endRow;!w&&x&&x&&o&&k(c,o,t),(t.region===u||w&&!x||f)&&(o||(o=i(r,p)),j(c,o,t))}t.region=u,s=!0}}}s&&(c.pairsList=l(c))},d.clear=function(a){a.buckets={},a.pairs={},a.pairsList=[]};var a=function(a,b){var d=Math.min(a.startCol,b.startCol),e=Math.max(a.endCol,b.endCol),f=Math.min(a.startRow,b.startRow),g=Math.max(a.endRow,b.endRow);return c(d,e,f,g)},b=function(a,b){var d=b.bounds,e=Math.floor(d.min.x/a.bucketWidth),f=Math.floor(d.max.x/a.bucketWidth),g=Math.floor(d.min.y/a.bucketHeight),h=Math.floor(d.max.y/a.bucketHeight);return c(e,f,g,h)},c=function(a,b,c,d){return{id:a+","+b+","+c+","+d,startCol:a,endCol:b,startRow:c,endRow:d}},h=function(a,b){return a+","+b},i=function(a,b){var c=a[b]=[];return c},j=function(a,b,c){for(var d=0;d<b.length;d++){var f=b[d];if(!(c.id===f.id||c.isStatic&&f.isStatic)){var g=e.id(c,f),h=a.pairs[g];h?h[2]+=1:a.pairs[g]=[c,f,1]}}b.push(c)},k=function(a,b,c){b.splice(g.indexOf(b,c),1);for(var d=0;d<b.length;d++){var f=b[d],h=e.id(c,f),i=a.pairs[h];i&&(i[2]-=1)}},l=function(a){var b,c,d=[];b=g.keys(a.pairs);for(var e=0;e<b.length;e++)c=a.pairs[b[e]],c[2]>0?d.push(c):delete a.pairs[b[e]];return d}}()},{"../core/Common":14,"./Detector":5,"./Pair":7}],7:[function(a,b,c){var d={};b.exports=d;var e=a("./Contact");!function(){d.create=function(a,b){var c=a.bodyA,e=a.bodyB,f=a.parentA,g=a.parentB,h={id:d.id(c,e),bodyA:c,bodyB:e,contacts:{},activeContacts:[],separation:0,isActive:!0,isSensor:c.isSensor||e.isSensor,timeCreated:b,timeUpdated:b,inverseMass:f.inverseMass+g.inverseMass,friction:Math.min(f.friction,g.friction),frictionStatic:Math.max(f.frictionStatic,g.frictionStatic),restitution:Math.max(f.restitution,g.restitution),slop:Math.max(f.slop,g.slop)};return d.update(h,a,b),h},d.update=function(a,b,c){var f=a.contacts,g=b.supports,h=a.activeContacts,i=b.parentA,j=b.parentB;if(a.collision=b,a.inverseMass=i.inverseMass+j.inverseMass,a.friction=Math.min(i.friction,j.friction),a.frictionStatic=Math.max(i.frictionStatic,j.frictionStatic),a.restitution=Math.max(i.restitution,j.restitution),a.slop=Math.max(i.slop,j.slop),h.length=0,b.collided){for(var k=0;k<g.length;k++){var l=g[k],m=e.id(l),n=f[m];n?h.push(n):h.push(f[m]=e.create(l))}a.separation=b.depth,d.setActive(a,!0,c)}else a.isActive===!0&&d.setActive(a,!1,c)},d.setActive=function(a,b,c){b?(a.isActive=!0,a.timeUpdated=c):(a.isActive=!1,a.activeContacts.length=0)},d.id=function(a,b){return a.id<b.id?a.id+"_"+b.id:b.id+"_"+a.id}}()},{"./Contact":4}],8:[function(a,b,c){var d={};b.exports=d;var e=a("./Pair"),f=a("../core/Common");!function(){var a=1e3;d.create=function(a){return f.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},a)},d.update=function(a,b,c){var d,g,h,i,j=a.list,k=a.table,l=a.collisionStart,m=a.collisionEnd,n=a.collisionActive,o=[];for(l.length=0,m.length=0,n.length=0,i=0;i<b.length;i++)d=b[i],d.collided&&(g=e.id(d.bodyA,d.bodyB),o.push(g),h=k[g],h?(h.isActive?n.push(h):l.push(h),e.update(h,d,c)):(h=e.create(d,c),k[g]=h,l.push(h),j.push(h)));for(i=0;i<j.length;i++)h=j[i],h.isActive&&f.indexOf(o,h.id)===-1&&(e.setActive(h,!1,c),m.push(h))},d.removeOld=function(b,c){var d,e,f,g,h=b.list,i=b.table,j=[];for(g=0;g<h.length;g++)d=h[g],e=d.collision,e.bodyA.isSleeping||e.bodyB.isSleeping?d.timeUpdated=c:c-d.timeUpdated>a&&j.push(g);for(g=0;g<j.length;g++)f=j[g]-g,d=h[f],delete i[d.id],h.splice(f,1)},d.clear=function(a){return a.table={},a.list.length=0,a.collisionStart.length=0,a.collisionActive.length=0,a.collisionEnd.length=0,a}}()},{"../core/Common":14,"./Pair":7}],9:[function(a,b,c){var d={};b.exports=d;var e=a("../geometry/Vector"),f=a("./SAT"),g=a("../geometry/Bounds"),h=a("../factory/Bodies"),i=a("../geometry/Vertices");!function(){d.ray=function(a,b,c,d){d=d||1e-100;for(var i=e.angle(b,c),j=e.magnitude(e.sub(b,c)),k=.5*(c.x+b.x),l=.5*(c.y+b.y),m=h.rectangle(k,l,j,d,{angle:i}),n=[],o=0;o<a.length;o++){var p=a[o];if(g.overlaps(p.bounds,m.bounds))for(var q=1===p.parts.length?0:1;q<p.parts.length;q++){var r=p.parts[q];if(g.overlaps(r.bounds,m.bounds)){var s=f.collides(r,m);if(s.collided){s.body=s.bodyA=s.bodyB=p,n.push(s);break}}}}return n},d.region=function(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=a[e],h=g.overlaps(f.bounds,b);(h&&!c||!h&&c)&&d.push(f)}return d},d.point=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];if(g.contains(e.bounds,b))for(var f=1===e.parts.length?0:1;f<e.parts.length;f++){var h=e.parts[f];if(g.contains(h.bounds,b)&&i.contains(h.vertices,b)){
c.push(e);break}}}return c}}()},{"../factory/Bodies":21,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27,"./SAT":11}],10:[function(a,b,c){var d={};b.exports=d;var e=a("../geometry/Vertices"),f=a("../geometry/Vector"),g=a("../core/Common"),h=a("../geometry/Bounds");!function(){d._restingThresh=4,d._restingThreshTangent=6,d._positionDampen=.9,d._positionWarming=.8,d._frictionNormalMultiplier=5,d.preSolvePosition=function(a){var b,c,d;for(b=0;b<a.length;b++)c=a[b],c.isActive&&(d=c.activeContacts.length,c.collision.parentA.totalContacts+=d,c.collision.parentB.totalContacts+=d)},d.solvePosition=function(a,b){var c,e,g,h,i,j,k,l,m,n=f._temp[0],o=f._temp[1],p=f._temp[2],q=f._temp[3];for(c=0;c<a.length;c++)e=a[c],e.isActive&&!e.isSensor&&(g=e.collision,h=g.parentA,i=g.parentB,j=g.normal,k=f.sub(f.add(i.positionImpulse,i.position,n),f.add(h.positionImpulse,f.sub(i.position,g.penetration,o),p),q),e.separation=f.dot(j,k));for(c=0;c<a.length;c++)e=a[c],!e.isActive||e.isSensor||e.separation<0||(g=e.collision,h=g.parentA,i=g.parentB,j=g.normal,m=(e.separation-e.slop)*b,(h.isStatic||i.isStatic)&&(m*=2),h.isStatic||h.isSleeping||(l=d._positionDampen/h.totalContacts,h.positionImpulse.x+=j.x*m*l,h.positionImpulse.y+=j.y*m*l),i.isStatic||i.isSleeping||(l=d._positionDampen/i.totalContacts,i.positionImpulse.x-=j.x*m*l,i.positionImpulse.y-=j.y*m*l))},d.postSolvePosition=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.totalContacts=0,0!==c.positionImpulse.x||0!==c.positionImpulse.y){for(var g=0;g<c.parts.length;g++){var i=c.parts[g];e.translate(i.vertices,c.positionImpulse),h.update(i.bounds,i.vertices,c.velocity),i.position.x+=c.positionImpulse.x,i.position.y+=c.positionImpulse.y}c.positionPrev.x+=c.positionImpulse.x,c.positionPrev.y+=c.positionImpulse.y,f.dot(c.positionImpulse,c.velocity)<0?(c.positionImpulse.x=0,c.positionImpulse.y=0):(c.positionImpulse.x*=d._positionWarming,c.positionImpulse.y*=d._positionWarming)}}},d.preSolveVelocity=function(a){var b,c,d,e,g,h,i,j,k,l,m,n,o,p,q=f._temp[0],r=f._temp[1];for(b=0;b<a.length;b++)if(d=a[b],d.isActive&&!d.isSensor)for(e=d.activeContacts,g=d.collision,h=g.parentA,i=g.parentB,j=g.normal,k=g.tangent,c=0;c<e.length;c++)l=e[c],m=l.vertex,n=l.normalImpulse,o=l.tangentImpulse,0===n&&0===o||(q.x=j.x*n+k.x*o,q.y=j.y*n+k.y*o,h.isStatic||h.isSleeping||(p=f.sub(m,h.position,r),h.positionPrev.x+=q.x*h.inverseMass,h.positionPrev.y+=q.y*h.inverseMass,h.anglePrev+=f.cross(p,q)*h.inverseInertia),i.isStatic||i.isSleeping||(p=f.sub(m,i.position,r),i.positionPrev.x-=q.x*i.inverseMass,i.positionPrev.y-=q.y*i.inverseMass,i.anglePrev-=f.cross(p,q)*i.inverseInertia))},d.solveVelocity=function(a,b){for(var c=b*b,e=f._temp[0],h=f._temp[1],i=f._temp[2],j=f._temp[3],k=f._temp[4],l=f._temp[5],m=0;m<a.length;m++){var n=a[m];if(n.isActive&&!n.isSensor){var o=n.collision,p=o.parentA,q=o.parentB,r=o.normal,s=o.tangent,t=n.activeContacts,u=1/t.length;p.velocity.x=p.position.x-p.positionPrev.x,p.velocity.y=p.position.y-p.positionPrev.y,q.velocity.x=q.position.x-q.positionPrev.x,q.velocity.y=q.position.y-q.positionPrev.y,p.angularVelocity=p.angle-p.anglePrev,q.angularVelocity=q.angle-q.anglePrev;for(var v=0;v<t.length;v++){var w=t[v],x=w.vertex,y=f.sub(x,p.position,h),z=f.sub(x,q.position,i),A=f.add(p.velocity,f.mult(f.perp(y),p.angularVelocity),j),B=f.add(q.velocity,f.mult(f.perp(z),q.angularVelocity),k),C=f.sub(A,B,l),D=f.dot(r,C),E=f.dot(s,C),F=Math.abs(E),G=g.sign(E),H=(1+n.restitution)*D,I=g.clamp(n.separation+D,0,1)*d._frictionNormalMultiplier,J=E,K=1/0;F>n.friction*n.frictionStatic*I*c&&(K=F,J=g.clamp(n.friction*G*c,-K,K));var L=f.cross(y,r),M=f.cross(z,r),N=u/(p.inverseMass+q.inverseMass+p.inverseInertia*L*L+q.inverseInertia*M*M);if(H*=N,J*=N,D<0&&D*D>d._restingThresh*c)w.normalImpulse=0;else{var O=w.normalImpulse;w.normalImpulse=Math.min(w.normalImpulse+H,0),H=w.normalImpulse-O}if(E*E>d._restingThreshTangent*c)w.tangentImpulse=0;else{var P=w.tangentImpulse;w.tangentImpulse=g.clamp(w.tangentImpulse+J,-K,K),J=w.tangentImpulse-P}e.x=r.x*H+s.x*J,e.y=r.y*H+s.y*J,p.isStatic||p.isSleeping||(p.positionPrev.x+=e.x*p.inverseMass,p.positionPrev.y+=e.y*p.inverseMass,p.anglePrev+=f.cross(y,e)*p.inverseInertia),q.isStatic||q.isSleeping||(q.positionPrev.x-=e.x*q.inverseMass,q.positionPrev.y-=e.y*q.inverseMass,q.anglePrev-=f.cross(z,e)*q.inverseInertia)}}}}}()},{"../core/Common":14,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27}],11:[function(a,b,c){var d={};b.exports=d;var e=a("../geometry/Vertices"),f=a("../geometry/Vector");!function(){d.collides=function(b,d,g){var h,i,j,k,l=g,m=!1;if(l){var n=b.parent,o=d.parent,p=n.speed*n.speed+n.angularSpeed*n.angularSpeed+o.speed*o.speed+o.angularSpeed*o.angularSpeed;m=l&&l.collided&&p<.2,k=l}else k={collided:!1,bodyA:b,bodyB:d};if(l&&m){var q=k.axisBody,r=q===b?d:b,s=[q.axes[l.axisNumber]];if(j=a(q.vertices,r.vertices,s),k.reused=!0,j.overlap<=0)return k.collided=!1,k}else{if(h=a(b.vertices,d.vertices,b.axes),h.overlap<=0)return k.collided=!1,k;if(i=a(d.vertices,b.vertices,d.axes),i.overlap<=0)return k.collided=!1,k;h.overlap<i.overlap?(j=h,k.axisBody=b):(j=i,k.axisBody=d),k.axisNumber=j.axisNumber}k.bodyA=b.id<d.id?b:d,k.bodyB=b.id<d.id?d:b,k.collided=!0,k.normal=j.axis,k.depth=j.overlap,k.parentA=k.bodyA.parent,k.parentB=k.bodyB.parent,b=k.bodyA,d=k.bodyB,f.dot(k.normal,f.sub(d.position,b.position))>0&&(k.normal=f.neg(k.normal)),k.tangent=f.perp(k.normal),k.penetration={x:k.normal.x*k.depth,y:k.normal.y*k.depth};var t=c(b,d,k.normal),u=k.supports||[];if(u.length=0,e.contains(b.vertices,t[0])&&u.push(t[0]),e.contains(b.vertices,t[1])&&u.push(t[1]),u.length<2){var v=c(d,b,f.neg(k.normal));e.contains(d.vertices,v[0])&&u.push(v[0]),u.length<2&&e.contains(d.vertices,v[1])&&u.push(v[1])}return u.length<1&&(u=[t[0]]),k.supports=u,k};var a=function(a,c,d){for(var e,g,h=f._temp[0],i=f._temp[1],j={overlap:Number.MAX_VALUE},k=0;k<d.length;k++){if(g=d[k],b(h,a,g),b(i,c,g),e=Math.min(h.max-i.min,i.max-h.min),e<=0)return j.overlap=e,j;e<j.overlap&&(j.overlap=e,j.axis=g,j.axisNumber=k)}return j},b=function(a,b,c){for(var d=f.dot(b[0],c),e=d,g=1;g<b.length;g+=1){var h=f.dot(b[g],c);h>e?e=h:h<d&&(d=h)}a.min=d,a.max=e},c=function(a,b,c){for(var d,e,g,h,i=Number.MAX_VALUE,j=f._temp[0],k=b.vertices,l=a.position,m=0;m<k.length;m++)e=k[m],j.x=e.x-l.x,j.y=e.y-l.y,d=-f.dot(c,j),d<i&&(i=d,g=e);var n=g.index-1>=0?g.index-1:k.length-1;e=k[n],j.x=e.x-l.x,j.y=e.y-l.y,i=-f.dot(c,j),h=e;var o=(g.index+1)%k.length;return e=k[o],j.x=e.x-l.x,j.y=e.y-l.y,d=-f.dot(c,j),d<i&&(h=e),[g,h]}}()},{"../geometry/Vector":26,"../geometry/Vertices":27}],12:[function(a,b,c){var d={};b.exports=d;var e=a("../geometry/Vertices"),f=a("../geometry/Vector"),g=a("../core/Sleeping"),h=a("../geometry/Bounds"),i=a("../geometry/Axes"),j=a("../core/Common");!function(){var a=1e-6,b=.001;d.create=function(b){var c=b;c.bodyA&&!c.pointA&&(c.pointA={x:0,y:0}),c.bodyB&&!c.pointB&&(c.pointB={x:0,y:0});var d=c.bodyA?f.add(c.bodyA.position,c.pointA):c.pointA,e=c.bodyB?f.add(c.bodyB.position,c.pointB):c.pointB,g=f.magnitude(f.sub(d,e));c.length=c.length||g||a;var h={visible:!0,lineWidth:2,strokeStyle:"#666"};return c.render=j.extend(h,c.render),c.id=c.id||j.nextId(),c.label=c.label||"Constraint",c.type="constraint",c.stiffness=c.stiffness||1,c.angularStiffness=c.angularStiffness||0,c.angleA=c.bodyA?c.bodyA.angle:c.angleA,c.angleB=c.bodyB?c.bodyB.angle:c.angleB,c},d.solveAll=function(a,b){for(var c=0;c<a.length;c++)d.solve(a[c],b)},d.solve=function(c,d){var e=c.bodyA,g=c.bodyB,h=c.pointA,i=c.pointB;e&&!e.isStatic&&(c.pointA=f.rotate(h,e.angle-c.angleA),c.angleA=e.angle),g&&!g.isStatic&&(c.pointB=f.rotate(i,g.angle-c.angleB),c.angleB=g.angle);var j=h,k=i;if(e&&(j=f.add(e.position,h)),g&&(k=f.add(g.position,i)),j&&k){var l=f.sub(j,k),m=f.magnitude(l);0===m&&(m=a);var n=(m-c.length)/m,o=f.div(l,m),p=f.mult(l,.5*n*c.stiffness*d*d);if(!(Math.abs(1-m/c.length)<b*d)){var q,r,s,t,u,v,w,x;e&&!e.isStatic?(s={x:j.x-e.position.x+p.x,y:j.y-e.position.y+p.y},e.velocity.x=e.position.x-e.positionPrev.x,e.velocity.y=e.position.y-e.positionPrev.y,e.angularVelocity=e.angle-e.anglePrev,q=f.add(e.velocity,f.mult(f.perp(s),e.angularVelocity)),u=f.dot(s,o),w=e.inverseMass+e.inverseInertia*u*u):(q={x:0,y:0},w=e?e.inverseMass:0),g&&!g.isStatic?(t={x:k.x-g.position.x-p.x,y:k.y-g.position.y-p.y},g.velocity.x=g.position.x-g.positionPrev.x,g.velocity.y=g.position.y-g.positionPrev.y,g.angularVelocity=g.angle-g.anglePrev,r=f.add(g.velocity,f.mult(f.perp(t),g.angularVelocity)),v=f.dot(t,o),x=g.inverseMass+g.inverseInertia*v*v):(r={x:0,y:0},x=g?g.inverseMass:0);var y=f.sub(r,q),z=f.dot(o,y)/(w+x);z>0&&(z=0);var A,B={x:o.x*z,y:o.y*z};e&&!e.isStatic&&(A=f.cross(s,B)*e.inverseInertia*(1-c.angularStiffness),e.constraintImpulse.x-=p.x,e.constraintImpulse.y-=p.y,e.constraintImpulse.angle+=A,e.position.x-=p.x,e.position.y-=p.y,e.angle+=A),g&&!g.isStatic&&(A=f.cross(t,B)*g.inverseInertia*(1-c.angularStiffness),g.constraintImpulse.x+=p.x,g.constraintImpulse.y+=p.y,g.constraintImpulse.angle-=A,g.position.x+=p.x,g.position.y+=p.y,g.angle-=A)}}},d.postSolveAll=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.constraintImpulse;if(0!==d.x||0!==d.y||0!==d.angle){g.set(c,!1);for(var j=0;j<c.parts.length;j++){var k=c.parts[j];e.translate(k.vertices,d),j>0&&(k.position.x+=d.x,k.position.y+=d.y),0!==d.angle&&(e.rotate(k.vertices,d.angle,c.position),i.rotate(k.axes,d.angle),j>0&&f.rotateAbout(k.position,d.angle,c.position,k.position)),h.update(k.bounds,k.vertices,c.velocity)}d.angle=0,d.x=0,d.y=0}}}}()},{"../core/Common":14,"../core/Sleeping":20,"../geometry/Axes":23,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27}],13:[function(a,b,c){var d={};b.exports=d;var e=a("../geometry/Vertices"),f=a("../core/Sleeping"),g=a("../core/Mouse"),h=a("../core/Events"),i=a("../collision/Detector"),j=a("./Constraint"),k=a("../body/Composite"),l=a("../core/Common"),m=a("../geometry/Bounds");!function(){d.create=function(b,c){var e=(b?b.mouse:null)||(c?c.mouse:null);e||(b&&b.render&&b.render.canvas?e=g.create(b.render.canvas):c&&c.element?e=g.create(c.element):(e=g.create(),l.log("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected","warn")));var f=j.create({label:"Mouse Constraint",pointA:e.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),i={type:"mouseConstraint",mouse:e,element:null,body:null,constraint:f,collisionFilter:{category:1,mask:4294967295,group:0}},m=l.extend(i,c);return h.on(b,"tick",function(){var c=k.allBodies(b.world);d.update(m,c),a(m)}),m},d.update=function(a,b){var c=a.mouse,d=a.constraint,g=a.body;if(0===c.button){if(d.bodyB)f.set(d.bodyB,!1),d.pointA=c.position;else for(var j=0;j<b.length;j++)if(g=b[j],m.contains(g.bounds,c.position)&&i.canCollide(g.collisionFilter,a.collisionFilter))for(var k=g.parts.length>1?1:0;k<g.parts.length;k++){var l=g.parts[k];if(e.contains(l.vertices,c.position)){d.pointA=c.position,d.bodyB=a.body=g,d.pointB={x:c.position.x-g.position.x,y:c.position.y-g.position.y},d.angleB=g.angle,f.set(g,!1),h.trigger(a,"startdrag",{mouse:c,body:g});break}}}else d.bodyB=a.body=null,d.pointB=null,g&&h.trigger(a,"enddrag",{mouse:c,body:g})};var a=function(a){var b=a.mouse,c=b.sourceEvents;c.mousemove&&h.trigger(a,"mousemove",{mouse:b}),c.mousedown&&h.trigger(a,"mousedown",{mouse:b}),c.mouseup&&h.trigger(a,"mouseup",{mouse:b}),g.clearSourceEvents(b)}}()},{"../body/Composite":2,"../collision/Detector":5,"../core/Common":14,"../core/Events":16,"../core/Mouse":18,"../core/Sleeping":20,"../geometry/Bounds":24,"../geometry/Vertices":27,"./Constraint":12}],14:[function(a,b,c){var d={};b.exports=d,function(){d._nextId=0,d._seed=0,d.extend=function(a,b){var c,e,f;"boolean"==typeof b?(c=2,f=b):(c=1,f=!0),e=Array.prototype.slice.call(arguments,c);for(var g=0;g<e.length;g++){var h=e[g];if(h)for(var i in h)f&&h[i]&&h[i].constructor===Object?a[i]&&a[i].constructor!==Object?a[i]=h[i]:(a[i]=a[i]||{},d.extend(a[i],f,h[i])):a[i]=h[i]}return a},d.clone=function(a,b){return d.extend({},b,a)},d.keys=function(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)b.push(c);return b},d.values=function(a){var b=[];if(Object.keys){for(var c=Object.keys(a),d=0;d<c.length;d++)b.push(a[c[d]]);return b}for(var e in a)b.push(a[e]);return b},d.shadeColor=function(a,b){var c=parseInt(a.slice(1),16),d=Math.round(2.55*b),e=(c>>16)+d,f=(c>>8&255)+d,g=(255&c)+d;return"#"+(16777216+65536*(e<255?e<1?0:e:255)+256*(f<255?f<1?0:f:255)+(g<255?g<1?0:g:255)).toString(16).slice(1)},d.shuffle=function(a){for(var b=a.length-1;b>0;b--){var c=Math.floor(d.random()*(b+1)),e=a[b];a[b]=a[c],a[c]=e}return a},d.choose=function(a){return a[Math.floor(d.random()*a.length)]},d.isElement=function(a){try{return a instanceof HTMLElement}catch(b){return"object"===("undefined"==typeof a?"undefined":_typeof(a))&&1===a.nodeType&&"object"===_typeof(a.style)&&"object"===_typeof(a.ownerDocument)}},d.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},d.clamp=function(a,b,c){return a<b?b:a>c?c:a},d.sign=function(a){return a<0?-1:1},d.now=function(){var a=window.performance||{};return a.now=function(){return a.now||a.webkitNow||a.msNow||a.oNow||a.mozNow||function(){return+new Date}}(),a.now()},d.random=function(b,c){return b="undefined"!=typeof b?b:0,c="undefined"!=typeof c?c:1,b+a()*(c-b)},d.colorToNumber=function(a){return a=a.replace("#",""),3==a.length&&(a=a.charAt(0)+a.charAt(0)+a.charAt(1)+a.charAt(1)+a.charAt(2)+a.charAt(2)),parseInt(a,16)},d.log=function(a,b){if(console&&console.log&&console.warn)switch(b){case"warn":console.warn("Matter.js:",a);break;case"error":console.log("Matter.js:",a)}},d.nextId=function(){return d._nextId++},d.indexOf=function(a,b){if(a.indexOf)return a.indexOf(b);for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1};var a=function(){return d._seed=(9301*d._seed+49297)%233280,d._seed/233280}}()},{}],15:[function(a,b,c){var d={};b.exports=d;var e=a("../body/World"),f=a("./Sleeping"),g=a("../collision/Resolver"),h=a("../render/Render"),i=a("../collision/Pairs"),j=(a("./Metrics"),a("../collision/Grid")),k=a("./Events"),l=a("../body/Composite"),m=a("../constraint/Constraint"),n=a("./Common"),o=a("../body/Body");!function(){d.create=function(a,b){b=n.isElement(a)?b:a,a=n.isElement(a)?a:null,b=b||{},(a||b.render)&&n.log("Engine.create: engine.render is deprecated (see docs)","warn");var c={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],timing:{timestamp:0,timeScale:1},broadphase:{controller:j}},d=n.extend(c,b);if(a||d.render){var f={element:a,controller:h};d.render=n.extend(f,d.render)}return d.render&&d.render.controller&&(d.render=d.render.controller.create(d.render)),d.render&&(d.render.engine=d),d.world=b.world||e.create(d.world),d.pairs=i.create(),d.broadphase=d.broadphase.controller.create(d.broadphase),d.metrics=d.metrics||{extended:!1},d},d.update=function(d,e,h){e=e||1e3/60,h=h||1;var j,n=d.world,o=d.timing,p=d.broadphase,q=[];o.timestamp+=e*o.timeScale;var r={timestamp:o.timestamp};k.trigger(d,"beforeUpdate",r);var s=l.allBodies(n),t=l.allConstraints(n);for(d.enableSleeping&&f.update(s,o.timeScale),b(s,n.gravity),c(s,e,o.timeScale,h,n.bounds),j=0;j<d.constraintIterations;j++)m.solveAll(t,o.timeScale);m.postSolveAll(s),p.controller?(n.isModified&&p.controller.clear(p),p.controller.update(p,s,d,n.isModified),q=p.pairsList):q=s,n.isModified&&l.setModified(n,!1,!1,!0);var u=p.detector(q,d),v=d.pairs,w=o.timestamp;for(i.update(v,u,w),i.removeOld(v,w),d.enableSleeping&&f.afterCollisions(v.list,o.timeScale),v.collisionStart.length>0&&k.trigger(d,"collisionStart",{pairs:v.collisionStart}),g.preSolvePosition(v.list),j=0;j<d.positionIterations;j++)g.solvePosition(v.list,o.timeScale);for(g.postSolvePosition(s),g.preSolveVelocity(v.list),j=0;j<d.velocityIterations;j++)g.solveVelocity(v.list,o.timeScale);return v.collisionActive.length>0&&k.trigger(d,"collisionActive",{pairs:v.collisionActive}),v.collisionEnd.length>0&&k.trigger(d,"collisionEnd",{pairs:v.collisionEnd}),a(s),k.trigger(d,"afterUpdate",r),d},d.merge=function(a,b){if(n.extend(a,b),b.world){a.world=b.world,d.clear(a);for(var c=l.allBodies(a.world),e=0;e<c.length;e++){var g=c[e];f.set(g,!1),g.id=n.nextId()}}},d.clear=function(a){var b=a.world;i.clear(a.pairs);var c=a.broadphase;if(c.controller){var d=l.allBodies(b);c.controller.clear(c),c.controller.update(c,d,a,!0)}};var a=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.force.x=0,c.force.y=0,c.torque=0}},b=function(a,b){var c="undefined"!=typeof b.scale?b.scale:.001;if((0!==b.x||0!==b.y)&&0!==c)for(var d=0;d<a.length;d++){var e=a[d];e.isStatic||e.isSleeping||(e.force.y+=e.mass*b.y*c,e.force.x+=e.mass*b.x*c)}},c=function(a,b,c,d,e){for(var f=0;f<a.length;f++){var g=a[f];g.isStatic||g.isSleeping||o.update(g,b,c,d)}}}()},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Grid":6,"../collision/Pairs":8,"../collision/Resolver":10,"../constraint/Constraint":12,"../render/Render":29,"./Common":14,"./Events":16,"./Metrics":17,"./Sleeping":20}],16:[function(a,b,c){var d={};b.exports=d;var e=a("./Common");!function(){d.on=function(a,b,c){for(var d,e=b.split(" "),f=0;f<e.length;f++)d=e[f],a.events=a.events||{},a.events[d]=a.events[d]||[],a.events[d].push(c);return c},d.off=function(a,b,c){if(!b)return void(a.events={});"function"==typeof b&&(c=b,b=e.keys(a.events).join(" "));for(var d=b.split(" "),f=0;f<d.length;f++){var g=a.events[d[f]],h=[];if(c&&g)for(var i=0;i<g.length;i++)g[i]!==c&&h.push(g[i]);a.events[d[f]]=h}},d.trigger=function(a,b,c){var d,f,g,h;if(a.events){c||(c={}),d=b.split(" ");for(var i=0;i<d.length;i++)if(f=d[i],g=a.events[f]){h=e.clone(c,!1),h.name=f,h.source=a;for(var j=0;j<g.length;j++)g[j].apply(a,[h])}}}}()},{"./Common":14}],17:[function(a,b,c){},{"../body/Composite":2,"./Common":14}],18:[function(a,b,c){var d={};b.exports=d;var e=a("../core/Common");!function(){d.create=function(b){var c={};return b||e.log("Mouse.create: element was undefined, defaulting to document.body","warn"),c.element=b||document.body,c.absolute={x:0,y:0},c.position={x:0,y:0},c.mousedownPosition={x:0,y:0},c.mouseupPosition={x:0,y:0},c.offset={x:0,y:0},c.scale={x:1,y:1},c.wheelDelta=0,c.button=-1,c.pixelRatio=c.element.getAttribute("data-pixel-ratio")||1,c.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},c.mousemove=function(b){var d=a(b,c.element,c.pixelRatio),e=b.changedTouches;e&&(c.button=0,b.preventDefault()),c.absolute.x=d.x,c.absolute.y=d.y,c.position.x=c.absolute.x*c.scale.x+c.offset.x,c.position.y=c.absolute.y*c.scale.y+c.offset.y,c.sourceEvents.mousemove=b},c.mousedown=function(b){var d=a(b,c.element,c.pixelRatio),e=b.changedTouches;e?(c.button=0,b.preventDefault()):c.button=b.button,c.absolute.x=d.x,c.absolute.y=d.y,c.position.x=c.absolute.x*c.scale.x+c.offset.x,c.position.y=c.absolute.y*c.scale.y+c.offset.y,c.mousedownPosition.x=c.position.x,c.mousedownPosition.y=c.position.y,c.sourceEvents.mousedown=b},c.mouseup=function(b){var d=a(b,c.element,c.pixelRatio),e=b.changedTouches;e&&b.preventDefault(),c.button=-1,c.absolute.x=d.x,c.absolute.y=d.y,c.position.x=c.absolute.x*c.scale.x+c.offset.x,c.position.y=c.absolute.y*c.scale.y+c.offset.y,c.mouseupPosition.x=c.position.x,c.mouseupPosition.y=c.position.y,c.sourceEvents.mouseup=b},c.mousewheel=function(a){c.wheelDelta=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail)),a.preventDefault()},d.setElement(c,c.element),c},d.setElement=function(a,b){a.element=b,b.addEventListener("mousemove",a.mousemove),b.addEventListener("mousedown",a.mousedown),b.addEventListener("mouseup",a.mouseup),b.addEventListener("mousewheel",a.mousewheel),b.addEventListener("DOMMouseScroll",a.mousewheel),b.addEventListener("touchmove",a.mousemove),b.addEventListener("touchstart",a.mousedown),b.addEventListener("touchend",a.mouseup)},d.clearSourceEvents=function(a){a.sourceEvents.mousemove=null,a.sourceEvents.mousedown=null,a.sourceEvents.mouseup=null,a.sourceEvents.mousewheel=null,a.wheelDelta=0},d.setOffset=function(a,b){a.offset.x=b.x,a.offset.y=b.y,a.position.x=a.absolute.x*a.scale.x+a.offset.x,a.position.y=a.absolute.y*a.scale.y+a.offset.y},d.setScale=function(a,b){a.scale.x=b.x,a.scale.y=b.y,a.position.x=a.absolute.x*a.scale.x+a.offset.x,a.position.y=a.absolute.y*a.scale.y+a.offset.y};var a=function(a,b,c){var d,e,f=b.getBoundingClientRect(),g=document.documentElement||document.body.parentNode||document.body,h=void 0!==window.pageXOffset?window.pageXOffset:g.scrollLeft,i=void 0!==window.pageYOffset?window.pageYOffset:g.scrollTop,j=a.changedTouches;return j?(d=j[0].pageX-f.left-h,e=j[0].pageY-f.top-i):(d=a.pageX-f.left-h,e=a.pageY-f.top-i),{x:d/(b.clientWidth/b.width*c),y:e/(b.clientHeight/b.height*c)}}}()},{"../core/Common":14}],19:[function(a,b,c){var d={};b.exports=d;var e=a("./Events"),f=a("./Engine"),g=a("./Common");!function(){var a,b;"undefined"!=typeof window&&(a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(function(){a(g.now())},1e3/60)},b=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),d.create=function(a){var b={fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},c=g.extend(b,a);return c.delta=c.delta||1e3/c.fps,c.deltaMin=c.deltaMin||1e3/c.fps,c.deltaMax=c.deltaMax||1e3/(.5*c.fps),c.fps=1e3/c.delta,c},d.run=function(b,c){return"undefined"!=typeof b.positionIterations&&(c=b,b=d.create()),function e(f){b.frameRequestId=a(e),f&&b.enabled&&d.tick(b,c,f)}(),b},d.tick=function(a,b,c){var d,g=b.timing,h=1,i={timestamp:g.timestamp};e.trigger(a,"beforeTick",i),e.trigger(b,"beforeTick",i),a.isFixed?d=a.delta:(d=c-a.timePrev||a.delta,a.timePrev=c,a.deltaHistory.push(d),a.deltaHistory=a.deltaHistory.slice(-a.deltaSampleSize),d=Math.min.apply(null,a.deltaHistory),d=d<a.deltaMin?a.deltaMin:d,d=d>a.deltaMax?a.deltaMax:d,h=d/a.delta,a.delta=d),0!==a.timeScalePrev&&(h*=g.timeScale/a.timeScalePrev),0===g.timeScale&&(h=0),a.timeScalePrev=g.timeScale,a.correction=h,a.frameCounter+=1,c-a.counterTimestamp>=1e3&&(a.fps=a.frameCounter*((c-a.counterTimestamp)/1e3),a.counterTimestamp=c,a.frameCounter=0),e.trigger(a,"tick",i),e.trigger(b,"tick",i),b.world.isModified&&b.render&&b.render.controller&&b.render.controller.clear&&b.render.controller.clear(b.render),e.trigger(a,"beforeUpdate",i),f.update(b,d,h),e.trigger(a,"afterUpdate",i),b.render&&b.render.controller&&(e.trigger(a,"beforeRender",i),e.trigger(b,"beforeRender",i),b.render.controller.world(b.render),e.trigger(a,"afterRender",i),e.trigger(b,"afterRender",i)),e.trigger(a,"afterTick",i),e.trigger(b,"afterTick",i)},d.stop=function(a){b(a.frameRequestId)},d.start=function(a,b){d.run(a,b)}}()},{"./Common":14,"./Engine":15,"./Events":16}],20:[function(a,b,c){var d={};b.exports=d;var e=a("./Events");!function(){d._motionWakeThreshold=.18,d._motionSleepThreshold=.08,d._minBias=.9,d.update=function(a,b){for(var c=b*b*b,e=0;e<a.length;e++){var f=a[e],g=f.speed*f.speed+f.angularSpeed*f.angularSpeed;if(0===f.force.x&&0===f.force.y){var h=Math.min(f.motion,g),i=Math.max(f.motion,g);f.motion=d._minBias*h+(1-d._minBias)*i,f.sleepThreshold>0&&f.motion<d._motionSleepThreshold*c?(f.sleepCounter+=1,f.sleepCounter>=f.sleepThreshold&&d.set(f,!0)):f.sleepCounter>0&&(f.sleepCounter-=1)}else d.set(f,!1)}},d.afterCollisions=function(a,b){for(var c=b*b*b,e=0;e<a.length;e++){var f=a[e];if(f.isActive){var g=f.collision,h=g.bodyA.parent,i=g.bodyB.parent;if(!(h.isSleeping&&i.isSleeping||h.isStatic||i.isStatic)&&(h.isSleeping||i.isSleeping)){var j=h.isSleeping&&!h.isStatic?h:i,k=j===h?i:h;!j.isStatic&&k.motion>d._motionWakeThreshold*c&&d.set(j,!1)}}}},d.set=function(a,b){var c=a.isSleeping;b?(a.isSleeping=!0,a.sleepCounter=a.sleepThreshold,a.positionImpulse.x=0,a.positionImpulse.y=0,a.positionPrev.x=a.position.x,a.positionPrev.y=a.position.y,a.anglePrev=a.angle,a.speed=0,a.angularSpeed=0,a.motion=0,c||e.trigger(a,"sleepStart")):(a.isSleeping=!1,a.sleepCounter=0,c&&e.trigger(a,"sleepEnd"))}}()},{"./Events":16}],21:[function(a,b,c){var d={};b.exports=d;var e=a("../geometry/Vertices"),f=a("../core/Common"),g=a("../body/Body"),h=a("../geometry/Bounds"),i=a("../geometry/Vector");!function(){d.rectangle=function(a,b,c,d,h){h=h||{};var i={label:"Rectangle Body",position:{x:a,y:b},vertices:e.fromPath("L 0 0 L "+c+" 0 L "+c+" "+d+" L 0 "+d)};if(h.chamfer){var j=h.chamfer;i.vertices=e.chamfer(i.vertices,j.radius,j.quality,j.qualityMin,j.qualityMax),delete h.chamfer}return g.create(f.extend({},i,h))},d.trapezoid=function(a,b,c,d,h,i){i=i||{},h*=.5;var j,k=(1-2*h)*c,l=c*h,m=l+k,n=m+l;j=h<.5?"L 0 0 L "+l+" "+-d+" L "+m+" "+-d+" L "+n+" 0":"L 0 0 L "+m+" "+-d+" L "+n+" 0";var o={label:"Trapezoid Body",position:{x:a,y:b},vertices:e.fromPath(j)};if(i.chamfer){var p=i.chamfer;o.vertices=e.chamfer(o.vertices,p.radius,p.quality,p.qualityMin,p.qualityMax),delete i.chamfer}return g.create(f.extend({},o,i))},d.circle=function(a,b,c,e,g){e=e||{};var h={label:"Circle Body",circleRadius:c};g=g||25;var i=Math.ceil(Math.max(10,Math.min(g,c)));return i%2===1&&(i+=1),d.polygon(a,b,i,c,f.extend({},h,e))},d.polygon=function(a,b,c,h,i){if(i=i||{},c<3)return d.circle(a,b,h,i);for(var j=2*Math.PI/c,k="",l=.5*j,m=0;m<c;m+=1){var n=l+m*j,o=Math.cos(n)*h,p=Math.sin(n)*h;k+="L "+o.toFixed(3)+" "+p.toFixed(3)+" "}var q={label:"Polygon Body",position:{x:a,y:b},vertices:e.fromPath(k)};if(i.chamfer){var r=i.chamfer;q.vertices=e.chamfer(q.vertices,r.radius,r.quality,r.qualityMin,r.qualityMax),delete i.chamfer}return g.create(f.extend({},q,i))},d.fromVertices=function(a,b,c,d,j,k,l){var m,n,o,p,q,r,s,t,u;for(d=d||{},n=[],j="undefined"!=typeof j&&j,k="undefined"!=typeof k?k:.01,l="undefined"!=typeof l?l:10,window.decomp||f.log("Bodies.fromVertices: poly-decomp.js required. Could not decompose vertices. Fallback to convex hull.","warn"),f.isArray(c[0])||(c=[c]),t=0;t<c.length;t+=1)if(p=c[t],o=e.isConvex(p),o||!window.decomp)p=o?e.clockwiseSort(p):e.hull(p),n.push({position:{x:a,y:b},vertices:p});else{var v=new decomp.Polygon;for(q=0;q<p.length;q++)v.vertices.push([p[q].x,p[q].y]);v.makeCCW(),k!==!1&&v.removeCollinearPoints(k);var w=v.quickDecomp();for(q=0;q<w.length;q++){var x=w[q],y=[];for(r=0;r<x.vertices.length;r++)y.push({x:x.vertices[r][0],y:x.vertices[r][1]});l>0&&e.area(y)<l||n.push({position:e.centre(y),vertices:y})}}for(q=0;q<n.length;q++)n[q]=g.create(f.extend(n[q],d));if(j){var z=5;for(q=0;q<n.length;q++){var A=n[q];for(r=q+1;r<n.length;r++){var B=n[r];if(h.overlaps(A.bounds,B.bounds)){var C=A.vertices,D=B.vertices;for(s=0;s<A.vertices.length;s++)for(u=0;u<B.vertices.length;u++){var E=i.magnitudeSquared(i.sub(C[(s+1)%C.length],D[u])),F=i.magnitudeSquared(i.sub(C[s],D[(u+1)%D.length]));E<z&&F<z&&(C[s].isInternal=!0,D[u].isInternal=!0)}}}}}return n.length>1?(m=g.create(f.extend({parts:n.slice(0)},d)),g.setPosition(m,{x:a,y:b}),m):n[0]}}()},{"../body/Body":1,"../core/Common":14,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27}],22:[function(a,b,c){var d={};b.exports=d;var e=a("../body/Composite"),f=a("../constraint/Constraint"),g=a("../core/Common"),h=a("../body/Body"),i=a("./Bodies");!function(){d.stack=function(a,b,c,d,f,g,i){for(var j,k=e.create({label:"Stack"}),l=a,m=b,n=0,o=0;o<d;o++){for(var p=0,q=0;q<c;q++){var r=i(l,m,q,o,j,n);if(r){var s=r.bounds.max.y-r.bounds.min.y,t=r.bounds.max.x-r.bounds.min.x;s>p&&(p=s),h.translate(r,{x:.5*t,y:.5*s}),l=r.bounds.max.x+f,e.addBody(k,r),j=r,n+=1}else l+=f}m+=p+g,l=a}return k},d.chain=function(a,b,c,d,h,i){for(var j=a.bodies,k=1;k<j.length;k++){var l=j[k-1],m=j[k],n=l.bounds.max.y-l.bounds.min.y,o=l.bounds.max.x-l.bounds.min.x,p=m.bounds.max.y-m.bounds.min.y,q=m.bounds.max.x-m.bounds.min.x,r={bodyA:l,pointA:{x:o*b,y:n*c},bodyB:m,pointB:{x:q*d,y:p*h}},s=g.extend(r,i);e.addConstraint(a,f.create(s))}return a.label+=" Chain",a},d.mesh=function(a,b,c,d,h){var i,j,k,l,m,n=a.bodies;for(i=0;i<c;i++){for(j=1;j<b;j++)k=n[j-1+i*b],l=n[j+i*b],e.addConstraint(a,f.create(g.extend({bodyA:k,bodyB:l},h)));if(i>0)for(j=0;j<b;j++)k=n[j+(i-1)*b],l=n[j+i*b],e.addConstraint(a,f.create(g.extend({bodyA:k,bodyB:l},h))),d&&j>0&&(m=n[j-1+(i-1)*b],e.addConstraint(a,f.create(g.extend({bodyA:m,bodyB:l},h)))),d&&j<b-1&&(m=n[j+1+(i-1)*b],e.addConstraint(a,f.create(g.extend({bodyA:m,bodyB:l},h))))}return a.label+=" Mesh",a},d.pyramid=function(a,b,c,e,f,g,i){return d.stack(a,b,c,e,f,g,function(b,d,g,j,k,l){var m=Math.min(e,Math.ceil(c/2)),n=k?k.bounds.max.x-k.bounds.min.x:0;if(!(j>m)){j=m-j;var o=j,p=c-1-j;if(!(g<o||g>p)){1===l&&h.translate(k,{x:(g+(c%2===1?1:-1))*n,y:0});var q=k?g*n:0;return i(a+q+g*f,d,g,j,k,l)}}})},d.newtonsCradle=function(a,b,c,d,g){for(var h=e.create({label:"Newtons Cradle"}),j=0;j<c;j++){var k=1.9,l=i.circle(a+j*(d*k),b+g,d,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),m=f.create({pointA:{x:a+j*(d*k),y:b},bodyB:l});e.addBody(h,l),e.addConstraint(h,m)}return h},d.car=function(a,b,c,d,g){var j=h.nextGroup(!0),k=-20,l=.5*-c+k,m=.5*c-k,n=0,o=e.create({label:"Car"}),p=i.trapezoid(a,b,c,d,.3,{collisionFilter:{group:j},friction:.01,chamfer:{radius:10}}),q=i.circle(a+l,b+n,g,{collisionFilter:{group:j},friction:.8,density:.01}),r=i.circle(a+m,b+n,g,{collisionFilter:{group:j},friction:.8,density:.01}),s=f.create({bodyA:p,pointA:{x:l,y:n},bodyB:q,stiffness:.2}),t=f.create({bodyA:p,pointA:{x:m,y:n},bodyB:r,stiffness:.2});return e.addBody(o,p),e.addBody(o,q),e.addBody(o,r),e.addConstraint(o,s),e.addConstraint(o,t),o},d.softBody=function(a,b,c,e,f,h,j,k,l,m){l=g.extend({inertia:1/0},l),m=g.extend({stiffness:.4},m);var n=d.stack(a,b,c,e,f,h,function(a,b){return i.circle(a,b,k,l)});return d.mesh(n,c,e,j,m),n.label="Soft Body",n}}()},{"../body/Body":1,"../body/Composite":2,"../constraint/Constraint":12,"../core/Common":14,"./Bodies":21}],23:[function(a,b,c){var d={};b.exports=d;var e=a("../geometry/Vector"),f=a("../core/Common");!function(){d.fromVertices=function(a){for(var b={},c=0;c<a.length;c++){var d=(c+1)%a.length,g=e.normalise({x:a[d].y-a[c].y,y:a[c].x-a[d].x}),h=0===g.y?1/0:g.x/g.y;h=h.toFixed(3).toString(),b[h]=g}return f.values(b)},d.rotate=function(a,b){if(0!==b)for(var c=Math.cos(b),d=Math.sin(b),e=0;e<a.length;e++){var f,g=a[e];f=g.x*c-g.y*d,g.y=g.x*d+g.y*c,g.x=f}}}()},{"../core/Common":14,"../geometry/Vector":26}],24:[function(a,b,c){var d={};b.exports=d,function(){d.create=function(a){var b={min:{x:0,y:0},max:{x:0,y:0}};return a&&d.update(b,a),b},d.update=function(a,b,c){a.min.x=1/0,a.max.x=-(1/0),a.min.y=1/0,a.max.y=-(1/0);for(var d=0;d<b.length;d++){var e=b[d];e.x>a.max.x&&(a.max.x=e.x),e.x<a.min.x&&(a.min.x=e.x),e.y>a.max.y&&(a.max.y=e.y),e.y<a.min.y&&(a.min.y=e.y)}c&&(c.x>0?a.max.x+=c.x:a.min.x+=c.x,c.y>0?a.max.y+=c.y:a.min.y+=c.y)},d.contains=function(a,b){return b.x>=a.min.x&&b.x<=a.max.x&&b.y>=a.min.y&&b.y<=a.max.y},d.overlaps=function(a,b){return a.min.x<=b.max.x&&a.max.x>=b.min.x&&a.max.y>=b.min.y&&a.min.y<=b.max.y},d.translate=function(a,b){a.min.x+=b.x,a.max.x+=b.x,a.min.y+=b.y,a.max.y+=b.y},d.shift=function(a,b){var c=a.max.x-a.min.x,d=a.max.y-a.min.y;a.min.x=b.x,a.max.x=b.x+c,a.min.y=b.y,a.max.y=b.y+d}}()},{}],25:[function(a,b,c){var d={};b.exports=d;a("../geometry/Bounds");!function(){d.pathToVertices=function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=[],q=0,r=0,s=0;c=c||15;var t=function(a,b,c){var d=c%2===1&&c>1;if(!l||a!=l.x||b!=l.y){l&&d?(n=l.x,o=l.y):(n=0,o=0);var e={x:n+a,y:o+b};!d&&l||(l=e),p.push(e),r=n+a,s=o+b}},u=function(a){var b=a.pathSegTypeAsLetter.toUpperCase();if("Z"!==b){switch(b){case"M":case"L":case"T":case"C":case"S":case"Q":r=a.x,s=a.y;break;case"H":r=a.x;break;case"V":s=a.y}t(r,s,a.pathSegType)}};for(a(b),f=b.getTotalLength(),i=[],d=0;d<b.pathSegList.numberOfItems;d+=1)i.push(b.pathSegList.getItem(d));
for(j=i.concat();q<f;){if(m=b.getPathSegAtLength(q),h=i[m],h!=k){for(;j.length&&j[0]!=h;)u(j.shift());k=h}switch(h.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":g=b.getPointAtLength(q),t(g.x,g.y,0)}q+=c}for(d=0,e=j.length;d<e;++d)u(j[d]);return p};var a=function(a){for(var b,c,d,e,f,g,h=a.pathSegList,i=0,j=0,k=h.numberOfItems,l=0;l<k;++l){var m=h.getItem(l),n=m.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(n))"x"in m&&(i=m.x),"y"in m&&(j=m.y);else switch("x1"in m&&(d=i+m.x1),"x2"in m&&(f=i+m.x2),"y1"in m&&(e=j+m.y1),"y2"in m&&(g=j+m.y2),"x"in m&&(i+=m.x),"y"in m&&(j+=m.y),n){case"m":h.replaceItem(a.createSVGPathSegMovetoAbs(i,j),l);break;case"l":h.replaceItem(a.createSVGPathSegLinetoAbs(i,j),l);break;case"h":h.replaceItem(a.createSVGPathSegLinetoHorizontalAbs(i),l);break;case"v":h.replaceItem(a.createSVGPathSegLinetoVerticalAbs(j),l);break;case"c":h.replaceItem(a.createSVGPathSegCurvetoCubicAbs(i,j,d,e,f,g),l);break;case"s":h.replaceItem(a.createSVGPathSegCurvetoCubicSmoothAbs(i,j,f,g),l);break;case"q":h.replaceItem(a.createSVGPathSegCurvetoQuadraticAbs(i,j,d,e),l);break;case"t":h.replaceItem(a.createSVGPathSegCurvetoQuadraticSmoothAbs(i,j),l);break;case"a":h.replaceItem(a.createSVGPathSegArcAbs(i,j,m.r1,m.r2,m.angle,m.largeArcFlag,m.sweepFlag),l);break;case"z":case"Z":i=b,j=c}"M"!=n&&"m"!=n||(b=i,c=j)}}}()},{"../geometry/Bounds":24}],26:[function(a,b,c){var d={};b.exports=d,function(){d.create=function(a,b){return{x:a||0,y:b||0}},d.clone=function(a){return{x:a.x,y:a.y}},d.magnitude=function(a){return Math.sqrt(a.x*a.x+a.y*a.y)},d.magnitudeSquared=function(a){return a.x*a.x+a.y*a.y},d.rotate=function(a,b){var c=Math.cos(b),d=Math.sin(b);return{x:a.x*c-a.y*d,y:a.x*d+a.y*c}},d.rotateAbout=function(a,b,c,d){var e=Math.cos(b),f=Math.sin(b);d||(d={});var g=c.x+((a.x-c.x)*e-(a.y-c.y)*f);return d.y=c.y+((a.x-c.x)*f+(a.y-c.y)*e),d.x=g,d},d.normalise=function(a){var b=d.magnitude(a);return 0===b?{x:0,y:0}:{x:a.x/b,y:a.y/b}},d.dot=function(a,b){return a.x*b.x+a.y*b.y},d.cross=function(a,b){return a.x*b.y-a.y*b.x},d.cross3=function(a,b,c){return(b.x-a.x)*(c.y-a.y)-(b.y-a.y)*(c.x-a.x)},d.add=function(a,b,c){return c||(c={}),c.x=a.x+b.x,c.y=a.y+b.y,c},d.sub=function(a,b,c){return c||(c={}),c.x=a.x-b.x,c.y=a.y-b.y,c},d.mult=function(a,b){return{x:a.x*b,y:a.y*b}},d.div=function(a,b){return{x:a.x/b,y:a.y/b}},d.perp=function(a,b){return b=b===!0?-1:1,{x:b*-a.y,y:b*a.x}},d.neg=function(a){return{x:-a.x,y:-a.y}},d.angle=function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)},d._temp=[d.create(),d.create(),d.create(),d.create(),d.create(),d.create()]}()},{}],27:[function(a,b,c){var d={};b.exports=d;var e=a("../geometry/Vector"),f=a("../core/Common");!function(){d.create=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],f={x:e.x,y:e.y,index:d,body:b,isInternal:!1};c.push(f)}return c},d.fromPath=function(a,b){var c=/L?\s*([\-\d\.e]+)[\s,]*([\-\d\.e]+)*/gi,e=[];return a.replace(c,function(a,b,c){e.push({x:parseFloat(b),y:parseFloat(c)})}),d.create(e,b)},d.centre=function(a){for(var b,c,f,g=d.area(a,!0),h={x:0,y:0},i=0;i<a.length;i++)f=(i+1)%a.length,b=e.cross(a[i],a[f]),c=e.mult(e.add(a[i],a[f]),b),h=e.add(h,c);return e.div(h,6*g)},d.mean=function(a){for(var b={x:0,y:0},c=0;c<a.length;c++)b.x+=a[c].x,b.y+=a[c].y;return e.div(b,a.length)},d.area=function(a,b){for(var c=0,d=a.length-1,e=0;e<a.length;e++)c+=(a[d].x-a[e].x)*(a[d].y+a[e].y),d=e;return b?c/2:Math.abs(c)/2},d.inertia=function(a,b){for(var c,d,f=0,g=0,h=a,i=0;i<h.length;i++)d=(i+1)%h.length,c=Math.abs(e.cross(h[d],h[i])),f+=c*(e.dot(h[d],h[d])+e.dot(h[d],h[i])+e.dot(h[i],h[i])),g+=c;return b/6*(f/g)},d.translate=function(a,b,c){var d;if(c)for(d=0;d<a.length;d++)a[d].x+=b.x*c,a[d].y+=b.y*c;else for(d=0;d<a.length;d++)a[d].x+=b.x,a[d].y+=b.y;return a},d.rotate=function(a,b,c){if(0!==b){for(var d=Math.cos(b),e=Math.sin(b),f=0;f<a.length;f++){var g=a[f],h=g.x-c.x,i=g.y-c.y;g.x=c.x+(h*d-i*e),g.y=c.y+(h*e+i*d)}return a}},d.contains=function(a,b){for(var c=0;c<a.length;c++){var d=a[c],e=a[(c+1)%a.length];if((b.x-d.x)*(e.y-d.y)+(b.y-d.y)*(d.x-e.x)>0)return!1}return!0},d.scale=function(a,b,c,f){if(1===b&&1===c)return a;f=f||d.centre(a);for(var g,h,i=0;i<a.length;i++)g=a[i],h=e.sub(g,f),a[i].x=f.x+h.x*b,a[i].y=f.y+h.y*c;return a},d.chamfer=function(a,b,c,d,g){b=b||[8],b.length||(b=[b]),c="undefined"!=typeof c?c:-1,d=d||2,g=g||14;for(var h=[],i=0;i<a.length;i++){var j=a[i-1>=0?i-1:a.length-1],k=a[i],l=a[(i+1)%a.length],m=b[i<b.length?i:b.length-1];if(0!==m){var n=e.normalise({x:k.y-j.y,y:j.x-k.x}),o=e.normalise({x:l.y-k.y,y:k.x-l.x}),p=Math.sqrt(2*Math.pow(m,2)),q=e.mult(f.clone(n),m),r=e.normalise(e.mult(e.add(n,o),.5)),s=e.sub(k,e.mult(r,p)),t=c;c===-1&&(t=1.75*Math.pow(m,.32)),t=f.clamp(t,d,g),t%2===1&&(t+=1);for(var u=Math.acos(e.dot(n,o)),v=u/t,w=0;w<t;w++)h.push(e.add(e.rotate(q,v*w),s))}else h.push(k)}return h},d.clockwiseSort=function(a){var b=d.mean(a);return a.sort(function(a,c){return e.angle(b,a)-e.angle(b,c)}),a},d.isConvex=function(a){var b,c,d,e,f=0,g=a.length;if(g<3)return null;for(b=0;b<g;b++)if(c=(b+1)%g,d=(b+2)%g,e=(a[c].x-a[b].x)*(a[d].y-a[c].y),e-=(a[c].y-a[b].y)*(a[d].x-a[c].x),e<0?f|=1:e>0&&(f|=2),3===f)return!1;return 0!==f||null},d.hull=function(a){var b,c,d=[],f=[];for(a=a.slice(0),a.sort(function(a,b){var c=a.x-b.x;return 0!==c?c:a.y-b.y}),c=0;c<a.length;c++){for(b=a[c];f.length>=2&&e.cross3(f[f.length-2],f[f.length-1],b)<=0;)f.pop();f.push(b)}for(c=a.length-1;c>=0;c--){for(b=a[c];d.length>=2&&e.cross3(d[d.length-2],d[d.length-1],b)<=0;)d.pop();d.push(b)}return d.pop(),f.pop(),d.concat(f)}}()},{"../core/Common":14,"../geometry/Vector":26}],28:[function(a,b,c){var d=b.exports={};d.version="master",d.Body=a("../body/Body"),d.Composite=a("../body/Composite"),d.World=a("../body/World"),d.Contact=a("../collision/Contact"),d.Detector=a("../collision/Detector"),d.Grid=a("../collision/Grid"),d.Pairs=a("../collision/Pairs"),d.Pair=a("../collision/Pair"),d.Query=a("../collision/Query"),d.Resolver=a("../collision/Resolver"),d.SAT=a("../collision/SAT"),d.Constraint=a("../constraint/Constraint"),d.MouseConstraint=a("../constraint/MouseConstraint"),d.Common=a("../core/Common"),d.Engine=a("../core/Engine"),d.Events=a("../core/Events"),d.Mouse=a("../core/Mouse"),d.Runner=a("../core/Runner"),d.Sleeping=a("../core/Sleeping"),d.Bodies=a("../factory/Bodies"),d.Composites=a("../factory/Composites"),d.Axes=a("../geometry/Axes"),d.Bounds=a("../geometry/Bounds"),d.Svg=a("../geometry/Svg"),d.Vector=a("../geometry/Vector"),d.Vertices=a("../geometry/Vertices"),d.Render=a("../render/Render"),d.RenderPixi=a("../render/RenderPixi"),d.World.add=d.Composite.add,d.World.remove=d.Composite.remove,d.World.addComposite=d.Composite.addComposite,d.World.addBody=d.Composite.addBody,d.World.addConstraint=d.Composite.addConstraint,d.World.clear=d.Composite.clear,d.Engine.run=d.Runner.run},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Contact":4,"../collision/Detector":5,"../collision/Grid":6,"../collision/Pair":7,"../collision/Pairs":8,"../collision/Query":9,"../collision/Resolver":10,"../collision/SAT":11,"../constraint/Constraint":12,"../constraint/MouseConstraint":13,"../core/Common":14,"../core/Engine":15,"../core/Events":16,"../core/Metrics":17,"../core/Mouse":18,"../core/Runner":19,"../core/Sleeping":20,"../factory/Bodies":21,"../factory/Composites":22,"../geometry/Axes":23,"../geometry/Bounds":24,"../geometry/Svg":25,"../geometry/Vector":26,"../geometry/Vertices":27,"../render/Render":29,"../render/RenderPixi":30}],29:[function(a,b,c){var d={};b.exports=d;var e=a("../core/Common"),f=a("../body/Composite"),g=a("../geometry/Bounds"),h=a("../core/Events"),i=a("../collision/Grid"),j=a("../geometry/Vector");!function(){var a,b;"undefined"!=typeof window&&(a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(function(){a(e.now())},1e3/60)},b=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),d.create=function(a){var b={controller:d,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,options:{width:800,height:600,pixelRatio:1,background:"#fafafa",wireframeBackground:"#222",hasBounds:!!a.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},f=e.extend(b,a);return f.canvas&&(f.canvas.width=f.options.width||f.canvas.width,f.canvas.height=f.options.height||f.canvas.height),f.mouse=a.mouse,f.engine=a.engine,f.canvas=f.canvas||c(f.options.width,f.options.height),f.context=f.canvas.getContext("2d"),f.textures={},f.bounds=f.bounds||{min:{x:0,y:0},max:{x:f.canvas.width,y:f.canvas.height}},1!==f.options.pixelRatio&&d.setPixelRatio(f,f.options.pixelRatio),e.isElement(f.element)?f.element.appendChild(f.canvas):e.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),f},d.run=function(b){!function c(e){b.frameRequestId=a(c),d.world(b)}()},d.stop=function(a){b(a.frameRequestId)},d.setPixelRatio=function(a,b){var c=a.options,d=a.canvas;"auto"===b&&(b=k(d)),c.pixelRatio=b,d.setAttribute("data-pixel-ratio",b),d.width=c.width*b,d.height=c.height*b,d.style.width=c.width+"px",d.style.height=c.height+"px",a.context.scale(b,b)},d.world=function(a){var b,c=a.engine,e=c.world,k=a.canvas,l=a.context,n=a.options,o=f.allBodies(e),p=f.allConstraints(e),q=n.wireframes?n.wireframeBackground:n.background,r=[],s=[],t={timestamp:c.timing.timestamp};if(h.trigger(a,"beforeRender",t),a.currentBackground!==q&&m(a,q),l.globalCompositeOperation="source-in",l.fillStyle="transparent",l.fillRect(0,0,k.width,k.height),l.globalCompositeOperation="source-over",n.hasBounds){var u=a.bounds.max.x-a.bounds.min.x,v=a.bounds.max.y-a.bounds.min.y,w=u/n.width,x=v/n.height;for(b=0;b<o.length;b++){var y=o[b];g.overlaps(y.bounds,a.bounds)&&r.push(y)}for(b=0;b<p.length;b++){var z=p[b],A=z.bodyA,B=z.bodyB,C=z.pointA,D=z.pointB;A&&(C=j.add(A.position,z.pointA)),B&&(D=j.add(B.position,z.pointB)),C&&D&&(g.contains(a.bounds,C)||g.contains(a.bounds,D))&&s.push(z)}l.scale(1/w,1/x),l.translate(-a.bounds.min.x,-a.bounds.min.y)}else s=p,r=o;!n.wireframes||c.enableSleeping&&n.showSleeping?d.bodies(a,r,l):(n.showConvexHulls&&d.bodyConvexHulls(a,r,l),d.bodyWireframes(a,r,l)),n.showBounds&&d.bodyBounds(a,r,l),(n.showAxes||n.showAngleIndicator)&&d.bodyAxes(a,r,l),n.showPositions&&d.bodyPositions(a,r,l),n.showVelocity&&d.bodyVelocity(a,r,l),n.showIds&&d.bodyIds(a,r,l),n.showSeparations&&d.separations(a,c.pairs.list,l),n.showCollisions&&d.collisions(a,c.pairs.list,l),n.showVertexNumbers&&d.vertexNumbers(a,r,l),n.showMousePosition&&d.mousePosition(a,a.mouse,l),d.constraints(s,l),n.showBroadphase&&c.broadphase.controller===i&&d.grid(a,c.broadphase,l),n.showDebug&&d.debug(a,l),n.hasBounds&&l.setTransform(n.pixelRatio,0,0,n.pixelRatio,0,0),h.trigger(a,"afterRender",t)},d.debug=function(a,b){var c=b,d=a.engine,e=d.world,g=d.metrics,h=a.options,i=(f.allBodies(e),"    ");if(d.timing.timestamp-(a.debugTimestamp||0)>=500){var j="";g.timing&&(j+="fps: "+Math.round(g.timing.fps)+i),a.debugString=j,a.debugTimestamp=d.timing.timestamp}if(a.debugString){c.font="12px Arial",h.wireframes?c.fillStyle="rgba(255,255,255,0.5)":c.fillStyle="rgba(0,0,0,0.5)";for(var k=a.debugString.split("\n"),l=0;l<k.length;l++)c.fillText(k[l],50,50+18*l)}},d.constraints=function(a,b){for(var c=b,d=0;d<a.length;d++){var e=a[d];if(e.render.visible&&e.pointA&&e.pointB){var f=e.bodyA,g=e.bodyB;f?(c.beginPath(),c.moveTo(f.position.x+e.pointA.x,f.position.y+e.pointA.y)):(c.beginPath(),c.moveTo(e.pointA.x,e.pointA.y)),g?c.lineTo(g.position.x+e.pointB.x,g.position.y+e.pointB.y):c.lineTo(e.pointB.x,e.pointB.y),c.lineWidth=e.render.lineWidth,c.strokeStyle=e.render.strokeStyle,c.stroke()}}},d.bodyShadows=function(a,b,c){for(var d=c,e=(a.engine,0);e<b.length;e++){var f=b[e];if(f.render.visible){if(f.circleRadius)d.beginPath(),d.arc(f.position.x,f.position.y,f.circleRadius,0,2*Math.PI),d.closePath();else{d.beginPath(),d.moveTo(f.vertices[0].x,f.vertices[0].y);for(var g=1;g<f.vertices.length;g++)d.lineTo(f.vertices[g].x,f.vertices[g].y);d.closePath()}var h=f.position.x-.5*a.options.width,i=f.position.y-.2*a.options.height,j=Math.abs(h)+Math.abs(i);d.shadowColor="rgba(0,0,0,0.15)",d.shadowOffsetX=.05*h,d.shadowOffsetY=.05*i,d.shadowBlur=1+12*Math.min(1,j/1e3),d.fill(),d.shadowColor=null,d.shadowOffsetX=null,d.shadowOffsetY=null,d.shadowBlur=null}}},d.bodies=function(a,b,c){var d,e,f,g,h=c,i=(a.engine,a.options),j=i.showInternalEdges||!i.wireframes;for(f=0;f<b.length;f++)if(d=b[f],d.render.visible)for(g=d.parts.length>1?1:0;g<d.parts.length;g++)if(e=d.parts[g],e.render.visible){if(i.showSleeping&&d.isSleeping?h.globalAlpha=.5*e.render.opacity:1!==e.render.opacity&&(h.globalAlpha=e.render.opacity),e.render.sprite&&e.render.sprite.texture&&!i.wireframes){var k=e.render.sprite,m=l(a,k.texture);h.translate(e.position.x,e.position.y),h.rotate(e.angle),h.drawImage(m,m.width*-k.xOffset*k.xScale,m.height*-k.yOffset*k.yScale,m.width*k.xScale,m.height*k.yScale),h.rotate(-e.angle),h.translate(-e.position.x,-e.position.y)}else{if(e.circleRadius)h.beginPath(),h.arc(e.position.x,e.position.y,e.circleRadius,0,2*Math.PI);else{h.beginPath(),h.moveTo(e.vertices[0].x,e.vertices[0].y);for(var n=1;n<e.vertices.length;n++)!e.vertices[n-1].isInternal||j?h.lineTo(e.vertices[n].x,e.vertices[n].y):h.moveTo(e.vertices[n].x,e.vertices[n].y),e.vertices[n].isInternal&&!j&&h.moveTo(e.vertices[(n+1)%e.vertices.length].x,e.vertices[(n+1)%e.vertices.length].y);h.lineTo(e.vertices[0].x,e.vertices[0].y),h.closePath()}i.wireframes?(h.lineWidth=1,h.strokeStyle="#bbb"):(h.fillStyle=e.render.fillStyle,h.lineWidth=e.render.lineWidth,h.strokeStyle=e.render.strokeStyle,h.fill()),h.stroke()}h.globalAlpha=1}},d.bodyWireframes=function(a,b,c){var d,e,f,g,h,i=c,j=a.options.showInternalEdges;for(i.beginPath(),f=0;f<b.length;f++)if(d=b[f],d.render.visible)for(h=d.parts.length>1?1:0;h<d.parts.length;h++){for(e=d.parts[h],i.moveTo(e.vertices[0].x,e.vertices[0].y),g=1;g<e.vertices.length;g++)!e.vertices[g-1].isInternal||j?i.lineTo(e.vertices[g].x,e.vertices[g].y):i.moveTo(e.vertices[g].x,e.vertices[g].y),e.vertices[g].isInternal&&!j&&i.moveTo(e.vertices[(g+1)%e.vertices.length].x,e.vertices[(g+1)%e.vertices.length].y);i.lineTo(e.vertices[0].x,e.vertices[0].y)}i.lineWidth=1,i.strokeStyle="#bbb",i.stroke()},d.bodyConvexHulls=function(a,b,c){var d,e,f,g=c;for(g.beginPath(),e=0;e<b.length;e++)if(d=b[e],d.render.visible&&1!==d.parts.length){for(g.moveTo(d.vertices[0].x,d.vertices[0].y),f=1;f<d.vertices.length;f++)g.lineTo(d.vertices[f].x,d.vertices[f].y);g.lineTo(d.vertices[0].x,d.vertices[0].y)}g.lineWidth=1,g.strokeStyle="rgba(255,255,255,0.2)",g.stroke()},d.vertexNumbers=function(a,b,c){var d,e,f,g=c;for(d=0;d<b.length;d++){var h=b[d].parts;for(f=h.length>1?1:0;f<h.length;f++){var i=h[f];for(e=0;e<i.vertices.length;e++)g.fillStyle="rgba(255,255,255,0.2)",g.fillText(d+"_"+e,i.position.x+.8*(i.vertices[e].x-i.position.x),i.position.y+.8*(i.vertices[e].y-i.position.y))}}},d.mousePosition=function(a,b,c){var d=c;d.fillStyle="rgba(255,255,255,0.8)",d.fillText(b.position.x+"  "+b.position.y,b.position.x+5,b.position.y-5)},d.bodyBounds=function(a,b,c){var d=c,e=(a.engine,a.options);d.beginPath();for(var f=0;f<b.length;f++){var g=b[f];if(g.render.visible)for(var h=b[f].parts,i=h.length>1?1:0;i<h.length;i++){var j=h[i];d.rect(j.bounds.min.x,j.bounds.min.y,j.bounds.max.x-j.bounds.min.x,j.bounds.max.y-j.bounds.min.y)}}e.wireframes?d.strokeStyle="rgba(255,255,255,0.08)":d.strokeStyle="rgba(0,0,0,0.1)",d.lineWidth=1,d.stroke()},d.bodyAxes=function(a,b,c){var d,e,f,g,h=c,i=(a.engine,a.options);for(h.beginPath(),e=0;e<b.length;e++){var j=b[e],k=j.parts;if(j.render.visible)if(i.showAxes)for(f=k.length>1?1:0;f<k.length;f++)for(d=k[f],g=0;g<d.axes.length;g++){var l=d.axes[g];h.moveTo(d.position.x,d.position.y),h.lineTo(d.position.x+20*l.x,d.position.y+20*l.y)}else for(f=k.length>1?1:0;f<k.length;f++)for(d=k[f],g=0;g<d.axes.length;g++)h.moveTo(d.position.x,d.position.y),h.lineTo((d.vertices[0].x+d.vertices[d.vertices.length-1].x)/2,(d.vertices[0].y+d.vertices[d.vertices.length-1].y)/2)}i.wireframes?h.strokeStyle="indianred":(h.strokeStyle="rgba(0,0,0,0.8)",h.globalCompositeOperation="overlay"),h.lineWidth=1,h.stroke(),h.globalCompositeOperation="source-over"},d.bodyPositions=function(a,b,c){var d,e,f,g,h=c,i=(a.engine,a.options);for(h.beginPath(),f=0;f<b.length;f++)if(d=b[f],d.render.visible)for(g=0;g<d.parts.length;g++)e=d.parts[g],h.arc(e.position.x,e.position.y,3,0,2*Math.PI,!1),h.closePath();for(i.wireframes?h.fillStyle="indianred":h.fillStyle="rgba(0,0,0,0.5)",h.fill(),h.beginPath(),f=0;f<b.length;f++)d=b[f],d.render.visible&&(h.arc(d.positionPrev.x,d.positionPrev.y,2,0,2*Math.PI,!1),h.closePath());h.fillStyle="rgba(255,165,0,0.8)",h.fill()},d.bodyVelocity=function(a,b,c){var d=c;d.beginPath();for(var e=0;e<b.length;e++){var f=b[e];f.render.visible&&(d.moveTo(f.position.x,f.position.y),d.lineTo(f.position.x+2*(f.position.x-f.positionPrev.x),f.position.y+2*(f.position.y-f.positionPrev.y)))}d.lineWidth=3,d.strokeStyle="cornflowerblue",d.stroke()},d.bodyIds=function(a,b,c){var d,e,f=c;for(d=0;d<b.length;d++)if(b[d].render.visible){var g=b[d].parts;for(e=g.length>1?1:0;e<g.length;e++){var h=g[e];f.font="12px Arial",f.fillStyle="rgba(255,255,255,0.5)",f.fillText(h.id,h.position.x+10,h.position.y-10)}}},d.collisions=function(a,b,c){var d,e,f,g,h=c,i=a.options;for(h.beginPath(),f=0;f<b.length;f++)if(d=b[f],d.isActive)for(e=d.collision,g=0;g<d.activeContacts.length;g++){var j=d.activeContacts[g],k=j.vertex;h.rect(k.x-1.5,k.y-1.5,3.5,3.5)}for(i.wireframes?h.fillStyle="rgba(255,255,255,0.7)":h.fillStyle="orange",h.fill(),h.beginPath(),f=0;f<b.length;f++)if(d=b[f],d.isActive&&(e=d.collision,d.activeContacts.length>0)){var l=d.activeContacts[0].vertex.x,m=d.activeContacts[0].vertex.y;2===d.activeContacts.length&&(l=(d.activeContacts[0].vertex.x+d.activeContacts[1].vertex.x)/2,m=(d.activeContacts[0].vertex.y+d.activeContacts[1].vertex.y)/2),e.bodyB===e.supports[0].body||e.bodyA.isStatic===!0?h.moveTo(l-8*e.normal.x,m-8*e.normal.y):h.moveTo(l+8*e.normal.x,m+8*e.normal.y),h.lineTo(l,m)}i.wireframes?h.strokeStyle="rgba(255,165,0,0.7)":h.strokeStyle="orange",h.lineWidth=1,h.stroke()},d.separations=function(a,b,c){var d,e,f,g,h,i=c,j=a.options;for(i.beginPath(),h=0;h<b.length;h++)if(d=b[h],d.isActive){e=d.collision,f=e.bodyA,g=e.bodyB;var k=1;g.isStatic||f.isStatic||(k=.5),g.isStatic&&(k=0),i.moveTo(g.position.x,g.position.y),i.lineTo(g.position.x-e.penetration.x*k,g.position.y-e.penetration.y*k),k=1,g.isStatic||f.isStatic||(k=.5),f.isStatic&&(k=0),i.moveTo(f.position.x,f.position.y),i.lineTo(f.position.x+e.penetration.x*k,f.position.y+e.penetration.y*k)}j.wireframes?i.strokeStyle="rgba(255,165,0,0.5)":i.strokeStyle="orange",i.stroke()},d.grid=function(a,b,c){var d=c,f=a.options;f.wireframes?d.strokeStyle="rgba(255,180,0,0.1)":d.strokeStyle="rgba(255,180,0,0.5)",d.beginPath();for(var g=e.keys(b.buckets),h=0;h<g.length;h++){var i=g[h];if(!(b.buckets[i].length<2)){var j=i.split(",");d.rect(.5+parseInt(j[0],10)*b.bucketWidth,.5+parseInt(j[1],10)*b.bucketHeight,b.bucketWidth,b.bucketHeight)}}d.lineWidth=1,d.stroke()},d.inspector=function(a,b){var c,d=(a.engine,a.selected),e=a.render,f=e.options;if(f.hasBounds){var g=e.bounds.max.x-e.bounds.min.x,h=e.bounds.max.y-e.bounds.min.y,i=g/e.options.width,j=h/e.options.height;b.scale(1/i,1/j),b.translate(-e.bounds.min.x,-e.bounds.min.y)}for(var k=0;k<d.length;k++){var l=d[k].data;switch(b.translate(.5,.5),b.lineWidth=1,b.strokeStyle="rgba(255,165,0,0.9)",b.setLineDash([1,2]),l.type){case"body":c=l.bounds,b.beginPath(),b.rect(Math.floor(c.min.x-3),Math.floor(c.min.y-3),Math.floor(c.max.x-c.min.x+6),Math.floor(c.max.y-c.min.y+6)),b.closePath(),b.stroke();break;case"constraint":var m=l.pointA;l.bodyA&&(m=l.pointB),b.beginPath(),b.arc(m.x,m.y,10,0,2*Math.PI),b.closePath(),b.stroke()}b.setLineDash([]),b.translate(-.5,-.5)}null!==a.selectStart&&(b.translate(.5,.5),b.lineWidth=1,b.strokeStyle="rgba(255,165,0,0.6)",b.fillStyle="rgba(255,165,0,0.1)",c=a.selectBounds,b.beginPath(),b.rect(Math.floor(c.min.x),Math.floor(c.min.y),Math.floor(c.max.x-c.min.x),Math.floor(c.max.y-c.min.y)),b.closePath(),b.stroke(),b.fill(),b.translate(-.5,-.5)),f.hasBounds&&b.setTransform(1,0,0,1,0,0)};var c=function(a,b){var c=document.createElement("canvas");return c.width=a,c.height=b,c.oncontextmenu=function(){return!1},c.onselectstart=function(){return!1},c},k=function(a){var b=a.getContext("2d"),c=window.devicePixelRatio||1,d=b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1;return c/d},l=function(a,b){var c=a.textures[b];return c?c:(c=a.textures[b]=new Image,c.src=b,c)},m=function(a,b){var c=b;/(jpg|gif|png)$/.test(b)&&(c="url("+b+")"),a.canvas.style.background=c,a.canvas.style.backgroundSize="contain",a.currentBackground=b}}()},{"../body/Composite":2,"../collision/Grid":6,"../core/Common":14,"../core/Events":16,"../geometry/Bounds":24,"../geometry/Vector":26}],30:[function(a,b,c){var d={};b.exports=d;var e=a("../body/Composite"),f=a("../core/Common");!function(){var a,b;"undefined"!=typeof window&&(a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(function(){a(f.now())},1e3/60)},b=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),d.create=function(a){f.log("RenderPixi.create: Matter.RenderPixi is deprecated (see docs)","warn");var b={controller:d,engine:null,element:null,frameRequestId:null,canvas:null,renderer:null,container:null,spriteContainer:null,pixiOptions:null,options:{width:800,height:600,background:"#fafafa",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1}},c=f.extend(b,a),e=!c.options.wireframes&&"transparent"===c.options.background;return c.pixiOptions=c.pixiOptions||{view:c.canvas,transparent:e,antialias:!0,backgroundColor:a.background},c.mouse=a.mouse,c.engine=a.engine,c.renderer=c.renderer||new PIXI.WebGLRenderer(c.options.width,c.options.height,c.pixiOptions),c.container=c.container||new PIXI.Container,c.spriteContainer=c.spriteContainer||new PIXI.Container,c.canvas=c.canvas||c.renderer.view,c.bounds=c.bounds||{min:{x:0,y:0},max:{x:c.options.width,y:c.options.height}},c.textures={},c.sprites={},c.primitives={},c.container.addChild(c.spriteContainer),f.isElement(c.element)?c.element.appendChild(c.canvas):f.log('No "render.element" passed, "render.canvas" was not inserted into document.',"warn"),c.canvas.oncontextmenu=function(){return!1},c.canvas.onselectstart=function(){return!1},c},d.run=function(b){!function c(e){b.frameRequestId=a(c),d.world(b)}()},d.stop=function(a){b(a.frameRequestId)},d.clear=function(a){for(var b=a.container,c=a.spriteContainer;b.children[0];)b.removeChild(b.children[0]);for(;c.children[0];)c.removeChild(c.children[0]);var d=a.sprites["bg-0"];a.textures={},a.sprites={},a.primitives={},a.sprites["bg-0"]=d,d&&b.addChildAt(d,0),a.container.addChild(a.spriteContainer),a.currentBackground=null,b.scale.set(1,1),b.position.set(0,0)},d.setBackground=function(a,b){if(a.currentBackground!==b){var c=b.indexOf&&b.indexOf("#")!==-1,d=a.sprites["bg-0"];if(c){var e=f.colorToNumber(b);a.renderer.backgroundColor=e,d&&a.container.removeChild(d)}else if(!d){var g=h(a,b);d=a.sprites["bg-0"]=new PIXI.Sprite(g),d.position.x=0,d.position.y=0,a.container.addChildAt(d,0)}a.currentBackground=b}},d.world=function(a){var b,c=a.engine,f=c.world,g=a.renderer,h=a.container,i=a.options,j=e.allBodies(f),k=e.allConstraints(f),l=[];i.wireframes?d.setBackground(a,i.wireframeBackground):d.setBackground(a,i.background);var m=a.bounds.max.x-a.bounds.min.x,n=a.bounds.max.y-a.bounds.min.y,o=m/a.options.width,p=n/a.options.height;if(i.hasBounds){for(b=0;b<j.length;b++){var q=j[b];q.render.sprite.visible=Bounds.overlaps(q.bounds,a.bounds)}for(b=0;b<k.length;b++){var r=k[b],s=r.bodyA,t=r.bodyB,u=r.pointA,v=r.pointB;s&&(u=Vector.add(s.position,r.pointA)),t&&(v=Vector.add(t.position,r.pointB)),u&&v&&(Bounds.contains(a.bounds,u)||Bounds.contains(a.bounds,v))&&l.push(r)}h.scale.set(1/o,1/p),h.position.set(-a.bounds.min.x*(1/o),-a.bounds.min.y*(1/p))}else l=k;for(b=0;b<j.length;b++)d.body(a,j[b]);for(b=0;b<l.length;b++)d.constraint(a,l[b]);g.render(h)},d.constraint=function(a,b){var c=(a.engine,b.bodyA),d=b.bodyB,e=b.pointA,g=b.pointB,h=a.container,i=b.render,j="c-"+b.id,k=a.primitives[j];return k||(k=a.primitives[j]=new PIXI.Graphics),i.visible&&b.pointA&&b.pointB?(f.indexOf(h.children,k)===-1&&h.addChild(k),k.clear(),k.beginFill(0,0),k.lineStyle(i.lineWidth,f.colorToNumber(i.strokeStyle),1),c?k.moveTo(c.position.x+e.x,c.position.y+e.y):k.moveTo(e.x,e.y),d?k.lineTo(d.position.x+g.x,d.position.y+g.y):k.lineTo(g.x,g.y),void k.endFill()):void k.clear()},d.body=function(a,b){var d=(a.engine,b.render);if(d.visible)if(d.sprite&&d.sprite.texture){var e="b-"+b.id,h=a.sprites[e],i=a.spriteContainer;h||(h=a.sprites[e]=c(a,b)),f.indexOf(i.children,h)===-1&&i.addChild(h),h.position.x=b.position.x,h.position.y=b.position.y,h.rotation=b.angle,h.scale.x=d.sprite.xScale||1,h.scale.y=d.sprite.yScale||1}else{var j="b-"+b.id,k=a.primitives[j],l=a.container;k||(k=a.primitives[j]=g(a,b),k.initialAngle=b.angle),f.indexOf(l.children,k)===-1&&l.addChild(k),k.position.x=b.position.x,k.position.y=b.position.y,k.rotation=b.angle-k.initialAngle}};var c=function(a,b){var c=b.render,d=c.sprite.texture,e=h(a,d),f=new PIXI.Sprite(e);return f.anchor.x=b.render.sprite.xOffset,f.anchor.y=b.render.sprite.yOffset,f},g=function(a,b){var c,d=b.render,e=a.options,g=new PIXI.Graphics,h=f.colorToNumber(d.fillStyle),i=f.colorToNumber(d.strokeStyle),j=f.colorToNumber(d.strokeStyle),k=f.colorToNumber("#bbb"),l=f.colorToNumber("#CD5C5C");g.clear();for(var m=b.parts.length>1?1:0;m<b.parts.length;m++){c=b.parts[m],e.wireframes?(g.beginFill(0,0),g.lineStyle(1,k,1)):(g.beginFill(h,1),g.lineStyle(d.lineWidth,i,1)),g.moveTo(c.vertices[0].x-b.position.x,c.vertices[0].y-b.position.y);for(var n=1;n<c.vertices.length;n++)g.lineTo(c.vertices[n].x-b.position.x,c.vertices[n].y-b.position.y);g.lineTo(c.vertices[0].x-b.position.x,c.vertices[0].y-b.position.y),g.endFill(),(e.showAngleIndicator||e.showAxes)&&(g.beginFill(0,0),e.wireframes?g.lineStyle(1,l,1):g.lineStyle(1,j),g.moveTo(c.position.x-b.position.x,c.position.y-b.position.y),g.lineTo((c.vertices[0].x+c.vertices[c.vertices.length-1].x)/2-b.position.x,(c.vertices[0].y+c.vertices[c.vertices.length-1].y)/2-b.position.y),g.endFill())}return g},h=function(a,b){var c=a.textures[b];return c||(c=a.textures[b]=PIXI.Texture.fromImage(b)),c}}()},{"../body/Composite":2,"../core/Common":14}]},{},[28])(28)});var AttributeDictionary=function(){};AttributeDictionary._rules={},AttributeDictionary._inheritance={},AttributeDictionary.addRule=function(a,b,c){return!!isObjectAssigned(a)&&(a=a.toLowerCase(),isObjectAssigned(AttributeDictionary._rules[a])||(AttributeDictionary._rules[a]={}),AttributeDictionary._rules[a][b]=c,!0)},AttributeDictionary.getRule=function(a,b){if(a=a.toLowerCase(),AttributeDictionary._rules[a]&&AttributeDictionary._rules[a][b])return AttributeDictionary._rules[a][b];if(AttributeDictionary._inheritance[a])for(var c=0;c<AttributeDictionary._inheritance[a].length;++c){var d=AttributeDictionary.getRule(AttributeDictionary._inheritance[a][c],b);if(null!=d)return d}return null},AttributeDictionary.inherit=function(a,b){a=a.toLowerCase(),b=b.toLowerCase(),isObjectAssigned(AttributeDictionary._inheritance[a])||(AttributeDictionary._inheritance[a]=[]),AttributeDictionary._inheritance[a].push(b)},CallbackResponse.prototype.isSuccessful=function(){return this.success};var SC={WEBGL:"webgl",EXECUTION_PHASES:{WAITING:0,UPDATE:10,SCENE_UPDATE:11,LATE_UPDATE:12,RENDER:13,SCENE_RENDER:14,LATE_RENDER:15},CONTENT_EXTENSIONS:{ATLAS:".atl"},EVENTS:{CONTENT_ASSET_LOADED:"editor_updatePropertyEditorView"}},sc={},ContentLoader=function(){};ContentLoader._fileLoaded={},ContentLoader._fileAlias={},ContentLoader._imgLoaded={},ContentLoader._imgAlias={},ContentLoader._audioLoaded={},ContentLoader._audioAlias={},ContentLoader._enrichRelativePath=function(a){return GameManager.activeProjectPath&&a.indexOf(GameManager.activeProjectPath)<0&&(a=GameManager.activeProjectPath+a),a},ContentLoader.clear=function(){ContentLoader._imgLoaded={},ContentLoader._imgAlias={},ContentLoader._audioLoaded={},ContentLoader._audioAlias={},ContentLoader._fileLoaded={},ContentLoader._fileAlias={}},ContentLoader.load=function(a){return new Promise(function(b,c){function d(a,c){g+=1,c?e.success.push(a):e.fail.push(a),g>=f&&b(e)}var e={success:[],fail:[]},f=0,g=0;a.images=a.images||[],a.images.forEach(function(a){a.path&&(f++,ContentLoader.loadImage(a.path,a.alias).then(function(){d(a,!0)},function(){d(a,!1)}))}),a.audio=a.audio||[],a.audio.forEach(function(a){a.path&&(f++,ContentLoader.loadAudio(a.path,a.alias).then(function(){d(a,!0)},function(){d(a,!1)}))}),a.files=a.files||[],a.files.forEach(function(a){a.path&&(f++,ContentLoader.loadFile(a.path,a.alias).then(function(){d(a,!0)},function(){d(a,!1)}))})})},ContentLoader.getImage=function(a){if(ContentLoader._imgAlias.hasOwnProperty(a))return ContentLoader._imgLoaded[ContentLoader._imgAlias[a]]},ContentLoader.loadImage=function(a,b){return new Promise(function(c,d){if(a=ContentLoader._enrichRelativePath(a),ContentLoader._imgLoaded.hasOwnProperty(a))c(ContentLoader._imgLoaded[a]);else{var e=new Image;e.src=a,e.onload=function(){ContentLoader._imgLoaded[a]=e,b&&(ContentLoader._imgAlias[b]=a),c(e)},e.onerror=function(){d()}}}.bind(this))},ContentLoader.getAudio=function(a){if(ContentLoader._audioAlias.hasOwnProperty(a))return ContentLoader._audioLoaded[ContentLoader._audioAlias[a]]},ContentLoader.loadAudio=function(a,b){return new Promise(function(c,d){if(a=ContentLoader._enrichRelativePath(a),ContentLoader._audioLoaded.hasOwnProperty(a))c(ContentLoader._audioLoaded[a]);else{var e=new Audio;e.src=a,e.oncanplaythrough=function(){ContentLoader._audioLoaded[a]=e,b&&(ContentLoader._audioAlias[b]=a),c(e)},e.onerror=function(){d()}}}.bind(this))},ContentLoader.getFile=function(a){if(ContentLoader._fileAlias.hasOwnProperty(a))return ContentLoader._fileLoaded[ContentLoader._fileAlias[a]]},ContentLoader.loadFile=function(a,b){return new Promise(function(c,d){if(a=ContentLoader._enrichRelativePath(a),ContentLoader._fileLoaded.hasOwnProperty(a))c(ContentLoader._fileLoaded[a]);else{var e=new XMLHttpRequest;e.open("GET",a,!0),e.onreadystatechange=function(){4===e.readyState&&"200"==e.status?(ContentLoader._fileLoaded[a]=e.responseText,b&&(ContentLoader._fileAlias[b]=a),c(e.responseText)):4===e.readyState&&"200"!=e.status&&d()},e.send(null)}}.bind(this))};var EventManager=function(){};EventManager._handlers={},EventManager.subscribe=function(a,b,c){EventManager._handlers.hasOwnProperty(a)||(EventManager._handlers[a]=[]),EventManager._handlers[a].push({callback:b,context:c})},EventManager.removeSubscription=function(a,b){if(EventManager._handlers[a]){for(var c=EventManager._handlers[a].length-1;c>=0;c--)EventManager._handlers[a][c].callback==b&&EventManager._handlers[a].splice(c,1);0==EventManager._handlers[a].length&&delete EventManager._handlers[a]}},EventManager.emit=function(a){var b,c=[];if(arguments.length>1)for(b=1;b<arguments.length;b++)c.push(arguments[b]);if(EventManager._handlers.hasOwnProperty(a))for(b=EventManager._handlers[a].length-1;b>=0;b--)EventManager._handlers[a][b].callback?EventManager._handlers[a][b].callback.apply(EventManager._handlers[a][b].context,c):EventManager._handlers[a].splice(b,1);
},EventManager.clear=function(){EventManager._handlers={}},Array.prototype.insert||(Array.prototype.insert=function(a,b){this.splice(a,0,b)}),String.prototype.endsWith||(String.prototype.endsWith=function(a,b){var c=this.toString();("number"!=typeof b||!isFinite(b)||Math.floor(b)!==b||b>c.length)&&(b=c.length),b-=a.length;var d=c.indexOf(a,b);return d!==-1&&d===b}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.indexOfObject=function(a){for(var b=0,c=this.length;b<c;b++)if(isEqual(this[b],a))return b;return-1},Logger.prototype.log=function(a){console.log(this._context+" | "+a)},Logger.prototype.warn=function(a){console.warn(this._context+" | "+a)},Logger.prototype.error=function(a){console.error(this._context+" | "+a)};var debug=new Logger("Debug"),SetterDictionary=function(){};SetterDictionary._rules={},SetterDictionary.addRule=function(a,b){return!!isObjectAssigned(a)&&(a=a.toLowerCase(),SetterDictionary._rules[a]=b,!0)},SetterDictionary.getRule=function(a){if(a=a.toLowerCase(),SetterDictionary._rules[a])return SetterDictionary._rules[a]};var _SS_UID=0;RigidBody.prototype._sync=function(){var a=this;if(isObjectAssigned(this.gameObject)){if(!isObjectAssigned(this._body)){var b=this.gameObject.transform.getPosition(),c=1,d=1;isSprite(this.gameObject)&&(c=this.gameObject.getTexture().getWidth(),d=this.gameObject.getTexture().getHeight()),this._body=Matter.Bodies.rectangle(b.x,b.y,c,d,{isStatic:this._isStatic}),Matter.World.add(GameManager.activeScene.getPhysicsWorld(),[this._body]);var e=this.gameObject.transform.getScale();Matter.Body.scale(this._body,e.x,e.y),this.gameObject.transform.overridePositionGetter(function(){return{x:a._body.position.x,y:a._body.position.y}}),this.gameObject.transform.overrideRotationGetter(function(){return a._body.angle})}isObjectAssigned(this._mass)&&Matter.Body.setMass(this._body,this._mass),isObjectAssigned(this._friction)&&(this._body.friction=this._friction)}},RigidBody.prototype.setMass=function(a){this._mass=a,Matter.Body.setMass(this._body,this._mass)},RigidBody.prototype.getMass=function(){return this.mass},RigidBody.prototype.setGameObject=function(a){this._sync()},RigidBody.prototype.onGameObjectDetach=function(){this.gameObject.transform.clearPositionGetter(),this.gameObject.transform.clearScaleGetter(),this.gameObject.transform.clearRotationGetter()},RigidBody.prototype.onGameObjectPositionUpdated=function(a){isObjectAssigned(this._body)&&Matter.Body.setPosition(this._body,a)},RigidBody.prototype.onGameObjectRotationUpdated=function(a){isObjectAssigned(this._body)&&Matter.Body.setAngle(this._body,a)},RigidBody.prototype.onGameObjectScaleUpdated=function(a){isObjectAssigned(this._body)&&Matter.Body.scale(this._body,a.x,a.y)},RigidBody.prototype.unload=function(){},ProjectFile.restore=function(a){return new ProjectFile(a)},TextureAtlas.prototype.objectify=function(){return{sourcePath:this.sourcePath}},TextureAtlas.restore=function(a){return new TextureAtlas({sourcePath:a.sourcePath})},TextureAtlas.prototype.getType=function(){return"TextureAtlas"},Camera2D.prototype.calculateMatrix=function(){return mat4.ortho(this._matrix,this.x+-this.viewWidth*this.zoom/2,this.x+this.viewWidth*this.zoom/2,this.y+this.viewHeight*this.zoom/2,this.y+-this.viewHeight*this.zoom/2,0,1),this._lastX=this.x,this._lastY=this.y,this._lastZoom=this.zoom,this._matrix},Camera2D.prototype.setViewSize=function(a,b){this.viewWidth=a,this.viewHeight=b,this.calculateMatrix()},Camera2D.prototype.getViewWidth=function(){return this.viewWidth},Camera2D.prototype.getViewHeight=function(){return this.viewHeight},Camera2D.prototype.getMatrix=function(){return this.x!=this._lastX||this.y!=this._lastY||this._lastZoom!=this.zoom?this.calculateMatrix():this._matrix},Camera2D.prototype.screenToWorldCoordinates=function(a,b){var c=2*a/this.viewWidth-1,d=1-2*b/this.viewHeight;return mat4.invert(this._omatrix,this.getMatrix()),Vector2.transformMat4(new Vector2(c,d),this._omatrix)},Camera2D.prototype.unload=function(){},Camera2D.prototype.objectify=function(){return{x:this.x,y:this.y,zoom:this.zoom}},Camera2D.restore=function(a){return new Camera2D(a.x,a.y,a.viewWidth,a.viewHeight,a.zoom)},SetterDictionary.addRule("color",["r","g","b","a"]),Color.prototype.clone=function(){return new Color(this.r,this.g,this.b,this.a,(!1))},Color.prototype.setSpecial=function(a,b,c,d,e){var f=this,g=1;e===!0&&(f=this.toRGBA(),g=255),a=isNumber(a)?a:f.r,b=isNumber(b)?b:f.g,c=isNumber(c)?c:f.b,d=isNumber(d)?d:f.a,this.r=MathHelper.clamp(a,0,g)/g,this.g=MathHelper.clamp(b,0,g)/g,this.b=MathHelper.clamp(c,0,g)/g,this.a=MathHelper.clamp(d,0,1)},Color.prototype.set=function(a,b,c,d){this.setSpecial(a,b,c,d,!1)},Color.prototype.setAsRGBA=function(a,b,c,d){this.setSpecial(a,b,c,d,!0)},Color.prototype.equalsIgnoreAlpha=function(a){return isNumber(a.r)&&isNumber(a.g)&&isNumber(a.b)?a.r===this.r&&a.g===this.g&&a.b===this.b:null},Color.prototype.equals=function(a){return isNumber(a.a)?this.equalsIgnoreAlpha(a)&&a.a===this.a:null},Color.prototype.objectify=function(){return{r:this.r,g:this.g,b:this.b,a:this.a}},Color.restore=function(a){return new Color(a.r,a.g,a.b,a.a,(!1))},Color.prototype.toRGBA=function(){return{r:255*this.r,g:255*this.g,b:255*this.b,a:this.a}},Color.prototype.toHex=function(){var a=this.toRGBA();return Color.rgbToHex(a.r,a.g,a.b)},Color.prototype.toArray=function(){return[this.r,this.g,this.b,this.a]},Color.prototype.toFloat32Array=function(){return new Float32Array([this.r,this.g,this.b,this.a])},Color.prototype.unload=function(){},Color.fromRGBA=function(a,b,c,d){return isNumber(a)&&isNumber(b)&&isNumber(c)&&isNumber(d)?new Color(a,b,c,d,(!0)):null},Color.fromHex=function(a){if(!isString(a))return null;var b=Color.hexToRGBA(a);return b?Color.fromRGBA(b.r,b.g,b.b,b.a):null},Color.fromRGB=function(a,b,c){return Color.fromRGBA(a,b,c,1)},Color.random=function(a){return a=isNumber(a)?a:1,Color.fromRGBA(255*Math.random(),255*Math.random(),255*Math.random(),a)},Color.rgbToHex=function(a,b,c){return isNumber(a)&&isNumber(b)&&isNumber(c)?(a=MathHelper.clamp(a,0,255),b=MathHelper.clamp(b,0,255),c=MathHelper.clamp(c,0,255),"#"+((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1)):""},Color.hexToRGBA=function(a){var b=/^#?([a-f\d])([a-f\d])([a-f\d])([a-f\d]?)$/i;a=a.replace(b,function(a,b,c,d,e){return b+b+c+c+d+d+e+e});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(a);return c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16),a:"undefined"!=c[4]?parseInt(c[4],16)/255:1}:null},FontStyle.prototype.getFontDescription=function(){return this._fontDescription},FontStyle.prototype.setFontDescription=function(a){if(!isObjectAssigned(a))throw new Error("fontInfo needs to be valid.");return this._fontDescription=a},FontStyle.prototype.getFontSize=function(){return this._fontSize},FontStyle.prototype.setFontSize=function(a){this._fontSize=a},FontStyle.prototype.getScale=function(){var a=this.getFontDescription().info.size;if(!a)return null;var b=this.getFontSize()/a;return!b||b<=0?null:b},FontStyle.prototype.getLetterSpacing=function(){return this._letterSpacing},FontStyle.prototype.setLetterSpacing=function(a){this._letterSpacing=a},FontStyle.prototype.findCharID=function(a){var b=this.getFontDescription().chars;if(!a||!b||0==b.length)return null;var c=a.charCodeAt(0);if(!c)return null;for(var d=0;d<b.length;d++){var e=b[d].id;if(e&&e===c)return d}return null},FontStyle.prototype.getKerning=function(a,b){var c=this.getFontDescription().kernings;if(!(a&&b&&c&&c.length&&0!==c.length))return 0;for(var d=0;d<c.length;d++){var e=c[d];if(e&&e.first&&e.second&&e.first===a&&e.second===b)return e.amount}return 0},Game.prototype.addRenderExtension=function(a,b){this._renderExtensions[a]=b},Game.prototype.removeRenderExtension=function(a){delete this._renderExtensions[a]},Game.prototype.clearRenderExtensions=function(){this._renderExtensions=[]},Game.prototype.getPhysicsEngine=function(){return this._physicsEngine},Game.prototype._bindInputHandlers=function(){window.addEventListener("keyup",this._keyUpListener.bind(this),!1),window.addEventListener("keydown",this._keyDownListener.bind(this),!1),this._inputHandlersBinded=!0},Game.prototype._unbindInputHandlers=function(){window.removeEventListener("keyup",this._keyUpListener.bind(this),!1),window.removeEventListener("keydown",this._keyDownListener.bind(this),!1),this._inputHandlersBinded=!1},Game.prototype._keyUpListener=function(a){var b=[a.keyCode];a.ctrlKey&&b.push(Keys.Ctrl),a.shiftKey&&b.push(Keys.Shift),Keyboard.removeKeys(b)},Game.prototype._keyDownListener=function(a){var b=[a.keyCode];a.ctrlKey&&b.push(Keys.Ctrl),a.shiftKey&&b.push(Keys.Shift),Keyboard.addKeys(b)},Game.prototype._onAnimationFrame=function(a){null===this._totalElapsedTime&&(this._totalElapsedTime=a),this._swapScene&&!this._swappingScenes&&(this.changeScene(this._swapScene),this._swapScene=null);var b=(a-this._totalElapsedTime)/1e3,c=this;if(this._totalElapsedTime=a,!this._paused&&isGameScene(this._gameScene)&&!this._swappingScenes){isFunction(this._gameScene.update)&&(this._executionPhase=SC.EXECUTION_PHASES.UPDATE,this._gameScene.update(b)),this._gameScene.sceneUpdate(b),isFunction(this._gameScene.lateUpdate)&&(this._executionPhase=SC.EXECUTION_PHASES.LATE_UPDATE,this._gameScene.lateUpdate(b)),this._gameScene.sceneLateUpdate(b),this._gameScene.prepareRender();var d=Object.keys(this._renderExtensions);d.forEach(function(a){c._renderExtensions[a].render(b)}),isFunction(this._gameScene.render)&&(this._executionPhase=SC.EXECUTION_PHASES.RENDER,this._gameScene.render(b)),this._executionPhase=SC.EXECUTION_PHASES.SCENE_RENDER,this._gameScene.sceneRender(b),this._gameScene.flushRender(),isFunction(this._gameScene.lateRender)&&(this._executionPhase=SC.EXECUTION_PHASES.LATE_RENDER,this._gameScene.lateRender(b),this._gameScene.flushRender()),this._executionPhase=SC.EXECUTION_PHASES.WAITING}requestAnimationFrame(this._onAnimationFrame.bind(this))},Game.prototype.pauseGame=function(){this._pause=!0},Game.prototype.resumeGame=function(){this._pause=!1},Game.prototype.getShaderManager=function(){return this._shaderManager},Game.prototype.getActiveCamera=function(){return this._gameScene?this._gameScene.getCamera():null},Game.prototype.getExecutionPhase=function(){return this._executionPhase},Game.prototype.init=function(a){return a=a||{},isObjectAssigned(this._canvas)?(this._onAnimationFrame(0),GameManager.activeGame=this,a.ignoreInputHandler||this._bindInputHandlers(),void(this._initalized=!0)):void this._logger.warn("Cannot initialize game, the render display target was not provided or is invalid.")},Game.prototype.setActive=function(){GameManager.activeGame=this},Game.prototype.setVirtualResolution=function(a,b){this._virtualResolution={width:a,height:b},isObjectAssigned(this._renderContext)&&(this._renderContext.setVirtualResolution(a,b),this.getActiveCamera().setViewSize(a,b))},Game.prototype.refreshVirtualResolution=function(){this._renderContext.setVirtualResolution(this._virtualResolution.width,this._virtualResolution.height);var a=this.getActiveCamera();a&&a.setViewSize(this._virtualResolution.width,this._virtualResolution.height)},Game.prototype.getVirtualResolution=function(){return this._virtualResolution},Game.prototype.getRenderContext=function(){return this._renderContext},Game.prototype.setTarget=function(a){this._canvas=isString(a)?document.getElementById(a):null,isObjectAssigned(this._canvas)&&(this._renderContext=new WebGLContext({renderContainer:this._canvas}),GameManager.renderContext=this._renderContext,this._shaderManager=new ShaderManager(this),this.refreshVirtualResolution())},Game.prototype.changeScene=function(a){isGameScene(a)&&(this._executionPhase==SC.EXECUTION_PHASES.WAITING?(this._swappingScenes=!0,this._gameScene&&this._gameScene.unload(),this._gameScene=a,this._gameScene.setGame(this),GameManager.activeScene=a,this.refreshVirtualResolution(),isFunction(this._gameScene.initialize)&&this._gameScene.initialize(),this._swappingScenes=!1):this._swapScene=a)},Game.prototype.getTotalElapsedTime=function(){return this._totalElapsedTime},Game.prototype.unload=function(){this._inputHandlersBinded&&this._unbindInputHandlers()};var GameManager=function(){};GameManager.renderContext=null,GameManager.activeScene=null,GameManager.activeProject=null,GameManager.activeGame=null,GameManager.activeProjectPath=null,AttributeDictionary.addRule("gameobject","transform",{ownContainer:!0}),AttributeDictionary.addRule("gameobject","_parent",{visible:!1});var GameObject=function(){function a(b){_classCallCheck(this,a),b=b||{},this.name=b.name||"GameObject",this.enabled=!0,b.transform&&(b.transform.gameObject=this),this.transform=b.transform||new Transform({gameObject:this}),this._uid=generateUID(),this._parent=b.parent||null,this._children=b.children||[],this._components=b.components||[],this._transformMatrix=mat4.create()}return _createClass(a,[{key:"equals",value:function(a){return a.getUID?this._uid===a.getUID():this===a}},{key:"getBaseWidth",value:function(){return 1}},{key:"getBaseHeight",value:function(){return 1}},{key:"getType",value:function(){return"GameObject"}},{key:"getUID",value:function(){return this._uid}},{key:"propagatePropertyUpdate",value:function(a,b){for(var c=0;c<this._components.length;++c)this._components[c]["onGameObject"+a+"Updated"]&&this._components[c]["onGameObject"+a+"Updated"](b)}},{key:"getMatrix",value:function(){return mat4.identity(this._transformMatrix),mat4.translate(this._transformMatrix,this._transformMatrix,[this.transform.getPosition().x,this.transform.getPosition().y,0]),this._transformMatrix}},{key:"getParent",value:function(){return this._parent}},{key:"removeParent",value:function(){this._parent?this._parent.removeChild(this):GameManager.activeScene.removeGameObject(this),this._parent=null}},{key:"setParent",value:function(a){a?(null!=this.getParent()?this.getParent().removeChild(this):GameManager.activeScene&&GameManager.activeScene.removeGameObject(this),a.addChild(this)):GameManager.activeScene&&GameManager.activeScene.addGameObject(this)}},{key:"removeChild",value:function(a){for(var b=this._children.length-1;b>=0;b--)if(this._children[b].getUID()==a.getUID())return this._children.splice(b,1)}},{key:"getChildren",value:function(){return this._children}},{key:"addChild",value:function(a,b){a.removeParent(),a._parent=this,isObjectAssigned(b)?this._children.insert(b,a):this._children.push(a)}},{key:"getHierarchyHash",value:function(){return this._parent?this._parent.getHierarchyHash()+"."+this._uid:this._uid+""}},{key:"isChild",value:function(a){var b=a.getHierarchyHash().split("."),c=b.indexOf(this._uid+""),d=b.indexOf(a.getUID()+"");return d>c&&c>=0}},{key:"addComponent",value:function(a){isFunction(a.setGameObject)&&a.setGameObject(this),a.gameObject=this,this._components.push(a)}},{key:"update",value:function(a){this.enabled&&(this._children.forEach(function(b){b.update&&b.update(a)}),this._components.forEach(function(b){b.update&&b.update(a)}))}},{key:"render",value:function(a,b){this.enabled&&(this._children.forEach(function(c){c.render&&c.render(a,b)}),this._components.forEach(function(c){c.render&&c.render(a,b)}))}},{key:"getComponents",value:function(){return this._components}},{key:"getBoundary",value:function(a){var b=this.getMatrix(),c=new Boundary(Vector2.transformMat4(new Vector2(0,0),b),Vector2.transformMat4(new Vector2(1,0),b),Vector2.transformMat4(new Vector2(1,1),b),Vector2.transformMat4(new Vector2(0,1),b));return a&&(c.topLeft.x-=a,c.topLeft.y-=a,c.topRight.x+=a,c.topRight.y-=a,c.bottomRight.x+=a,c.bottomRight.y+=a,c.bottomLeft.x-=a,c.bottomLeft.y+=a),c}},{key:"getRectangleBoundary",value:function(a){var b=this.getBoundary(a),c=Math.min(b.topLeft.x,b.topRight.x,b.bottomLeft.x,b.bottomRight.x),d=Math.max(b.topLeft.x,b.topRight.x,b.bottomLeft.x,b.bottomRight.x),e=Math.min(b.topLeft.y,b.topRight.y,b.bottomLeft.y,b.bottomRight.y),f=Math.max(b.topLeft.y,b.topRight.y,b.bottomLeft.y,b.bottomRight.y);return new Rectangle(c,e,d-c,f-e)}},{key:"collidesWith",value:function(a,b,c){return this.getBoundary(b).overlapsWith(a.getBoundary(c))}},{key:"collidesWithPoint",value:function(a,b){var c=this.getBoundary(b),d=new Boundary(new Vector2(a.x,a.y),new Vector2(a.x+1,a.y),new Vector2(a.x+1,a.y+1),new Vector2(a.x,a.y+1));return Boundary.overlap(c,d)}},{key:"objectify",value:function(){return{name:this.name,transform:this.transform.objectify(),children:Objectify.array(this._children),components:Objectify.array(this._components)}}},{key:"restore",value:function(b){return new a({name:b.name,transform:Transform.restore(b.transform),children:Objectify.restoreArray(b.children),components:Objectify.restoreArray(b.components)})}},{key:"unload",value:function(){for(var a=0;a<this._components.length;++a)isFunction(this._components[a].unload)&&this._components[a].unload()}}]),a}();GameProject.prototype.toJSON=function(){return{name:this.name}},AttributeDictionary.addRule("gameScene","_game",{visible:!1}),AttributeDictionary.addRule("gameScene","_gameObjects",{visible:!1}),AttributeDictionary.addRule("gameScene","_camera",{visible:!1}),AttributeDictionary.addRule("gameScene","_spriteBatch",{visible:!1}),GameScene.prototype.getUID=function(){return this._uid},GameScene.prototype.getPhysicsWorld=function(){return this._game.getPhysicsEngine().world},GameScene.prototype.getCamera=function(){return this._camera},GameScene.prototype.setGame=function(a){this._game=a},GameScene.prototype.getGame=function(){return this._game},GameScene.prototype.setBackgroundColor=function(a){this._backgroundColor=a},GameScene.prototype.getBackgroundColor=function(){return this._backgroundColor},GameScene.prototype.addGameObject=function(a,b){a.removeParent(),isObjectAssigned(b)?this._gameObjects.insert(b,a):this._gameObjects.push(a)},GameScene.prototype.getGameObjects=function(){return this._gameObjects},GameScene.prototype.removeGameObject=function(a){for(var b=this._gameObjects.length-1;b>=0;b--)if(this._gameObjects[b].getUID()==a.getUID())return this._gameObjects.splice(b,1)},GameScene.prototype.getAllGameObjects=function(){function a(c){c.forEach(function(c){b.push(c),a(c.getChildren())})}var b=[];return a(this._gameObjects),b},GameScene.prototype.prepareRender=function(){var a=this._game.getRenderContext().getContext();a.clearColor(this._backgroundColor.r,this._backgroundColor.g,this._backgroundColor.b,this._backgroundColor.a),a.clear(a.COLOR_BUFFER_BIT)},GameScene.prototype.sceneLateUpdate=function(a){Matter.Engine.update(this._game.getPhysicsEngine(),1e3/60)},GameScene.prototype.sceneUpdate=function(a){for(var b=0;b<this._gameObjects.length;b++)this._gameObjects[b].update(a)},GameScene.prototype.sceneRender=function(a){for(var b=0;b<this._gameObjects.length;b++)this._gameObjects[b].render(a,this._spriteBatch)},GameScene.prototype.flushRender=function(){this._spriteBatch.flush()},GameScene.prototype.objectify=function(){return{name:this.name,camera:this._camera.objectify(),backgroundColor:this._backgroundColor.objectify(),gameObjects:Objectify.array(this._gameObjects)}},GameScene.restore=function(a){return new GameScene({game:GameManager.activeGame,backgroundColor:Color.restore(a.backgroundColor),camera:Camera2D.restore(a.camera),gameObjects:Objectify.restoreArray(a.gameObjects)})},GameScene.prototype.unload=function(){},PrimitiveBatch.prototype.unload=function(){gl.deleteBuffer(this._vertexBuffer),gl.deleteBuffer(this._colorBuffer),this._primitiveShader.unload()},PrimitiveBatch.prototype.begin=function(){this._gl},PrimitiveBatch.prototype.clear=function(){this._rectangleVertexData=[],this._rectangleColorData=[],this._rectangleCount=0},PrimitiveBatch.prototype.flush=function(){var a=this._gl,b=this._game.getActiveCamera().getMatrix();if(this._game.getShaderManager().useShader(this._primitiveShader),this._rectangleCount>0){a.bindBuffer(a.ARRAY_BUFFER,this._vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this._rectangleData,a.STATIC_DRAW),a.enableVertexAttribArray(this._primitiveShader.attributes.aVertexPosition),a.vertexAttribPointer(this._primitiveShader.attributes.aVertexPosition,2,a.FLOAT,!1,0,0),a.uniformMatrix4fv(this._primitiveShader.uniforms.uMatrix._location,!1,b);for(var c=0;c<this._rectangleCount;c++)mat4.identity(this._transformMatrix),mat4.translate(this._transformMatrix,this._transformMatrix,[this._rectangleVertexData[c].x,this._rectangleVertexData[c].y,0]),mat4.scale(this._transformMatrix,this._transformMatrix,[this._rectangleVertexData[c].width,this._rectangleVertexData[c].height,0]),a.uniformMatrix4fv(this._primitiveShader.uniforms.uTransform._location,!1,this._transformMatrix),a.uniform4f(this._primitiveShader.uniforms.uColor._location,this._rectangleColorData[c].r,this._rectangleColorData[c].g,this._rectangleColorData[c].b,this._rectangleColorData[c].a),a.drawArrays(a.TRIANGLES,0,6)}this.clear()},PrimitiveBatch.prototype.drawPoint=function(a,b,c){},PrimitiveBatch.prototype.storeRectangle=function(a,b){this._rectangleColorData.push(b),this._rectangleVertexData.push(a),this._rectangleCount++},PrimitiveBatch.prototype.drawLine=function(a,b,c,d){},PrimitiveRender.prototype.unload=function(){gl.deleteBuffer(this._vertexBuffer),this._primitiveShader.unload()},PrimitiveRender.prototype.drawPoint=function(a,b,c){var d=this._gl;this._game.getShaderManager().useShader(this._primitiveShader),d.bindBuffer(d.ARRAY_BUFFER,this._vertexBuffer),d.bufferData(d.ARRAY_BUFFER,this._pointData,d.STATIC_DRAW),d.enableVertexAttribArray(this._primitiveShader.attributes.aVertexPosition),d.vertexAttribPointer(this._primitiveShader.attributes.aVertexPosition,2,this._gl.FLOAT,!1,0,0),mat4.identity(this._transformMatrix),mat4.translate(this._transformMatrix,this._transformMatrix,[a.x,a.y,0]),d.uniformMatrix4fv(this._primitiveShader.uniforms.uMatrix._location,!1,this._game.getActiveCamera().getMatrix()),d.uniformMatrix4fv(this._primitiveShader.uniforms.uTransform._location,!1,this._transformMatrix),d.uniform4f(this._primitiveShader.uniforms.uColor._location,c.r,c.g,c.b,c.a),d.uniform1f(this._primitiveShader.uniforms.uPointSize._location,b),d.drawArrays(d.POINTS,0,1)},PrimitiveRender.prototype.drawTriangle=function(a,b,c,d){var e=this._gl,f=this._transformMatrix;this._game.getShaderManager().useShader(this._primitiveShader);var g=new Float32Array([a.x,a.y,b.x,b.y,c.x,c.y]);e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,g,e.STATIC_DRAW),e.enableVertexAttribArray(this._primitiveShader.attributes.aVertexPosition),e.vertexAttribPointer(this._primitiveShader.attributes.aVertexPosition,2,e.FLOAT,!1,0,0),mat4.identity(f),e.uniformMatrix4fv(this._primitiveShader.uniforms.uMatrix._location,!1,this._game.getActiveCamera().getMatrix()),e.uniformMatrix4fv(this._primitiveShader.uniforms.uTransform._location,!1,f),e.uniform4f(this._primitiveShader.uniforms.uColor._location,d.r,d.g,d.b,d.a),e.drawArrays(e.TRIANGLES,0,3)},PrimitiveRender.prototype.drawCircle=function(a,b,c,d){var e=this._gl;this._game.getShaderManager().useShader(this._primitiveShader);for(var f=[],g=0;g<c;g++)f.push(a.x+b*Math.cos(g*MathHelper.PI2/c)),f.push(a.y+b*Math.sin(g*MathHelper.PI2/c));f=new Float32Array(f),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,f,e.STATIC_DRAW),e.enableVertexAttribArray(this._primitiveShader.attributes.aVertexPosition),e.vertexAttribPointer(this._primitiveShader.attributes.aVertexPosition,2,this._gl.FLOAT,!1,0,0),mat4.identity(this._transformMatrix),e.uniformMatrix4fv(this._primitiveShader.uniforms.uMatrix._location,!1,this._game.getActiveCamera().getMatrix()),e.uniformMatrix4fv(this._primitiveShader.uniforms.uTransform._location,!1,this._transformMatrix),e.uniform4f(this._primitiveShader.uniforms.uColor._location,d.r,d.g,d.b,d.a),e.drawArrays(e.TRIANGLE_FAN,0,c)},PrimitiveRender.prototype.drawRectangle=function(a,b,c){var d=this._gl,e=this._transformMatrix;this._game.getShaderManager().useShader(this._primitiveShader),d.bindBuffer(d.ARRAY_BUFFER,this._vertexBuffer),d.bufferData(d.ARRAY_BUFFER,this._rectangleData,d.STATIC_DRAW),d.enableVertexAttribArray(this._primitiveShader.attributes.aVertexPosition),d.vertexAttribPointer(this._primitiveShader.attributes.aVertexPosition,2,d.FLOAT,!1,0,0),mat4.identity(e),mat4.translate(e,e,[a.x,a.y,0]),c&&(mat4.translate(e,e,[a.width/2,a.height/2,0]),mat4.rotate(e,e,c,[0,0,1]),mat4.translate(e,e,[-a.width/2,-a.height/2,0])),mat4.scale(e,e,[a.width,a.height,0]),d.uniformMatrix4fv(this._primitiveShader.uniforms.uMatrix._location,!1,this._game.getActiveCamera().getMatrix()),d.uniformMatrix4fv(this._primitiveShader.uniforms.uTransform._location,!1,e),d.uniform4f(this._primitiveShader.uniforms.uColor._location,b.r,b.g,b.b,b.a),d.drawArrays(d.TRIANGLES,0,6)},PrimitiveRender.prototype.drawRectangleFromMatrix=function(a,b){var c=this._gl;this._game.getShaderManager().useShader(this._primitiveShader),c.bindBuffer(c.ARRAY_BUFFER,this._vertexBuffer),c.bufferData(c.ARRAY_BUFFER,this._rectangleData,c.STATIC_DRAW),c.enableVertexAttribArray(this._primitiveShader.attributes.aVertexPosition),c.vertexAttribPointer(this._primitiveShader.attributes.aVertexPosition,2,c.FLOAT,!1,0,0),c.uniformMatrix4fv(this._primitiveShader.uniforms.uMatrix._location,!1,this._game.getActiveCamera().getMatrix()),c.uniformMatrix4fv(this._primitiveShader.uniforms.uTransform._location,!1,a),c.uniform4f(this._primitiveShader.uniforms.uColor._location,b.r,b.g,b.b,b.a),c.drawArrays(c.TRIANGLES,0,6)},PrimitiveRender.prototype.drawLine=function(a,b,c,d){var e=this._gl;this._game.getShaderManager().useShader(this._primitiveShader);var f=new Float32Array([a.x,a.y,b.x,b.y]);e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,f,e.STATIC_DRAW),e.enableVertexAttribArray(this._primitiveShader.attributes.aVertexPosition),e.vertexAttribPointer(this._primitiveShader.attributes.aVertexPosition,2,this._gl.FLOAT,!1,0,0),mat4.identity(this._transformMatrix),e.uniformMatrix4fv(this._primitiveShader.uniforms.uMatrix._location,!1,this._game.getActiveCamera().getMatrix()),e.uniformMatrix4fv(this._primitiveShader.uniforms.uTransform._location,!1,this._transformMatrix),e.uniform4f(this._primitiveShader.uniforms.uColor._location,d.r,d.g,d.b,d.a),e.drawArrays(e.LINES,0,2)},Scripts._store={},Scripts._setupScript=function(a){a.properties={_store:{},_target:a,add:function(a,b){this._store[a]=b},get:function(a){return this._store[a]},getAll:function(){return this._store}}},Scripts.clear=function(){Scripts._store={}},Scripts.addScript=function(a){var b=function(){};return Scripts._store[a]=b,Scripts._setupScript(b),b},sc.addScript=Scripts.addScript,Scripts.assign=function(a,b){var c=Scripts.generateComponent(a);return b.addComponent(c),c},sc.assignScript=Scripts.assign,Scripts.generateComponent=function(a){if(!Scripts._store[a])return null;var b=Object.create(Scripts._store[a].prototype);b._name=a;var c=Scripts._store[a].properties.getAll(),d=Object.keys(c);return d&&d.length>0&&d.forEach(function(a){b[a]=c[a]["default"]}),b},Sound.fromPath=function(a){return new Promise(function(b,c){ContentLoader.loadAudio(a).then(function(a){b(new Sound(a))},function(){c()})}.bind(this))},Sound.prototype.setAudioSource=function(a){this._source=a},Sound.prototype.play=function(){this._source.play()},Sound.prototype.pause=function(){this._source.pause()},Sound.prototype.stop=function(){this._source.pause(),this._source.currentTime=0},Sound.prototype.setLoop=function(a){this._source.loop=a},Sound.prototype.setVolume=function(a){this._source.volume=a},AttributeDictionary.inherit("sprite","gameobject"),AttributeDictionary.addRule("sprite","_source",{displayName:"Source",editor:"filepath"}),AttributeDictionary.addRule("sprite","_tint",{displayName:"Tint"}),AttributeDictionary.addRule("sprite","_texture",{visible:!1}),AttributeDictionary.addRule("sprite","_wrapMode",{visible:!1}),AttributeDictionary.addRule("sprite","_atlasRegion",{displayName:"Region",available:function(){return isObjectAssigned(this._atlas)}}),inheritsFrom(Sprite,GameObject),Sprite.prototype.getBaseWidth=function(){return this._textureWidth},Sprite.prototype.getBaseHeight=function(){return this._textureHeight},Sprite.prototype.getMatrix=function(){var a,b,c,d;return a=this.transform.getPosition().x,b=this.transform.getPosition().y,c=this._textureWidth*this.transform.getScale().x,d=this._textureHeight*this.transform.getScale().y,mat4.identity(this._transformMatrix),this._wrapMode!=WrapMode.REPEAT?mat4.translate(this._transformMatrix,this._transformMatrix,[a-c*this._origin.x,b-d*this._origin.y,0]):mat4.translate(this._transformMatrix,this._transformMatrix,[-c*this._origin.x,-d*this._origin.y,0]),mat4.translate(this._transformMatrix,this._transformMatrix,[c*this._origin.x,d*this._origin.y,0]),mat4.rotate(this._transformMatrix,this._transformMatrix,this.transform.getRotation(),[0,0,1]),mat4.translate(this._transformMatrix,this._transformMatrix,[-c*this._origin.x,-d*this._origin.y,0]),mat4.scale(this._transformMatrix,this._transformMatrix,[c,d,0]),this._transformMatrix},Sprite.prototype.setWrapMode=function(a){this._wrapMode=a},Sprite.prototype.getWrapMode=function(){return this._wrapMode},Sprite.prototype.setOrigin=function(a){this._origin=a},Sprite.prototype.getOrigin=function(){return this._origin},Sprite.prototype.setTint=function(a){this._tint=a},Sprite.prototype.getTint=function(){return this._tint},Sprite.prototype.setSource=function(a){if(this._source=a,a&&a.length>0){var b=Path.getFileExtension(a);b==SC.CONTENT_EXTENSIONS.ATLAS?ContentLoader.loadFile(a).then(function(b){var c=Objectify.restoreFromString(b);c&&isObjectAssigned(c.sourcePath)&&(this._atlas=c,this._assignTextureFromPath(this._atlas.sourcePath),EventManager.emit(SC.EVENTS.CONTENT_ASSET_LOADED,a))}.bind(this),function(a){console.log("failed")}):(this._atlas=null,this._assignTextureFromPath(a))}else this.setTexture(null)},Sprite.prototype._assignTextureFromPath=function(a){Texture2D.fromPath(a).then(function(a){this.setTexture(a)}.bind(this),function(a){this.setTexture(null)}.bind(this))},Sprite.prototype.getAtlasRegion=function(){return this._atlasRegion},Sprite.prototype.setAtlasRegion=function(a){this._atlasRegion=a},Sprite.prototype.getSource=function(){return this._source},Sprite.prototype.getType=function(){return"Sprite"},Sprite.prototype.getTexture=function(){return this._texture},Sprite.prototype.setTexture=function(a){return a&&a.isReady()?(this._texture=a,this._textureWidth=this._texture.getWidth(),void(this._textureHeight=this._texture.getHeight())):(this._texture=null,this._textureWidth=0,void(this._textureHeight=0))},Sprite.prototype.render=function(a,b){this.enabled&&(b.storeSprite(this),GameObject.prototype.render.call(this,a,b))},Sprite.prototype.objectify=function(){var a=GameObject.prototype.objectify.call(this);return Objectify.extend(a,{src:this._source,tint:this._tint.objectify()})},Sprite.restore=function(a){var b=new Sprite({name:a.name,transform:Transform.restore(a.transform),children:Objectify.restoreArray(a.children),components:Objectify.restoreArray(a.components)});return b.setSource(a.src),b},Sprite.prototype.unload=function(){},SpriteBatch.prototype.clear=function(){this._sprites=[]},SpriteBatch.prototype.storeSprite=function(a){this._sprites.push(a)},SpriteBatch.prototype.flush=function(){if(0!=this._sprites.length){var a=this._gl,b=this._game.getActiveCamera().getMatrix();this._game.getShaderManager().useShader(this._textureShader),a.bindBuffer(a.ARRAY_BUFFER,this._vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this._rectangleData,a.STATIC_DRAW),a.enableVertexAttribArray(this._textureShader.attributes.aVertexPosition),a.vertexAttribPointer(this._textureShader.attributes.aVertexPosition,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this._texBuffer),a.bufferData(a.ARRAY_BUFFER,this._textureData,a.STATIC_DRAW),a.enableVertexAttribArray(this._textureShader.attributes.aTextureCoord),a.vertexAttribPointer(this._textureShader.attributes.aTextureCoord,2,a.FLOAT,!1,0,0),
a.uniformMatrix4fv(this._textureShader.uniforms.uMatrix._location,!1,b);for(var c,d,e=0;e<this._sprites.length;e++)if(c=this._sprites[e].getTexture(),c&&c.isReady()){switch(d=this._sprites[e].getTint(),c.bind(),this._lastTexUID=c.getUID(),this._sprites[e].getWrapMode()){case WrapMode.REPEAT:a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT);break;case WrapMode.CLAMP:}a.uniformMatrix4fv(this._textureShader.uniforms.uTransform._location,!1,this._sprites[e].getMatrix()),d&&a.uniform4f(this._textureShader.uniforms.uColor._location,d.r,d.g,d.b,d.a),a.drawArrays(a.TRIANGLES,0,6)}this.clear()}},SpriteBatch.prototype.unload=function(){gl.deleteBuffer(this._vertexBuffer),gl.deleteBuffer(this._texBuffer),this._textureShader.unload()},SpriteBatchOld.prototype.clear=function(){this._drawData=[]},SpriteBatchOld.prototype.storeSprite=function(a){this._drawData.push({texture:a.getTexture(),x:a.transform.getPosition().x,y:a.transform.getPosition().y,scaleX:a.transform.getScale().x,scaleY:a.transform.getScale().y,rotation:a.transform.getRotation(),tint:a.getTint()})},SpriteBatchOld.prototype.store=function(a,b,c,d,e,f){this._drawData.push({texture:a,x:b,y:c,scaleX:d,scaleY:e,rotation:f})},SpriteBatchOld.prototype.flush=function(){if(0!=this._drawData.length){var a=this._gl,b=this._game.getActiveCamera().getMatrix();this._game.getShaderManager().useShader(this._textureShader),a.bindBuffer(a.ARRAY_BUFFER,this._vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this._rectangleData,a.STATIC_DRAW),a.enableVertexAttribArray(this._textureShader.attributes.aVertexPosition),a.vertexAttribPointer(this._textureShader.attributes.aVertexPosition,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this._texBuffer),a.bufferData(a.ARRAY_BUFFER,this._textureData,a.STATIC_DRAW),a.enableVertexAttribArray(this._textureShader.attributes.aTextureCoord),a.vertexAttribPointer(this._textureShader.attributes.aTextureCoord,2,a.FLOAT,!1,0,0),a.uniformMatrix4fv(this._textureShader.uniforms.uMatrix._location,!1,b);for(var c=0;c<this._drawData.length;c++){var d=this._drawData[c].texture;if(d&&d.isReady()){this._lastTexUID!=d.getUID()&&(d.bind(),this._lastTexUID=d.getUID());var e=d.getImageData().width*this._drawData[c].scaleX,f=d.getImageData().height*this._drawData[c].scaleY;mat4.identity(this._transformMatrix),mat4.translate(this._transformMatrix,this._transformMatrix,[this._drawData[c].x,this._drawData[c].y,0]),mat4.translate(this._transformMatrix,this._transformMatrix,[e/2,f/2,0]),mat4.rotate(this._transformMatrix,this._transformMatrix,this._drawData[c].rotation,[0,0,1]),mat4.translate(this._transformMatrix,this._transformMatrix,[-e/2,-f/2,0]),mat4.scale(this._transformMatrix,this._transformMatrix,[e,f,0]),a.uniformMatrix4fv(this._textureShader.uniforms.uTransform._location,!1,this._transformMatrix),this._drawData[c].tint&&a.uniform4f(this._textureShader.uniforms.uColor._location,this._drawData[c].tint.r,this._drawData[c].tint.g,this._drawData[c].tint.b,this._drawData[c].tint.a),a.drawArrays(a.TRIANGLES,0,6)}}this.clear()}},SpriteBatchOld.prototype.unload=function(){gl.deleteBuffer(this._vertexBuffer),gl.deleteBuffer(this._texBuffer),this._textureShader.unload()},Stroke.prototype.getColor=function(){return this._color},Stroke.prototype.setColor=function(a){if(a instanceof Color)return void(this._color=a.clone());if(!(isNumber(a.r)&&isNumber(a.g)&&isNumber(a.b)&&isNumber(a.a)))throw new Error("The given stroke color is invalid");this._color.set(a.r,a.g,a.b,a.a)},Stroke.prototype.setOpacity=function(a){if(!isNumber(a))throw new Error("The given alpha is invalid");var b=this.getColor();this._color.set(b.r,b.g,b.b,a)},Stroke.prototype.getOpacity=function(){return this.getColor().a},Stroke.prototype.getSize=function(){return this._size},Stroke.prototype.setSize=function(a){if(!isNumber(a))throw new Error("The given size is invalid");this._size=a},Stroke.prototype.objectify=function(){return{color:this._color.objectify(),size:this.getSize()}},Stroke.prototype.restore=function(a){return{color:Color.restore(a),size:a.size}},AttributeDictionary.inherit("text","gameobject"),AttributeDictionary.addRule("text","_textureSrc",{displayName:"Image Src",editor:"filepath"}),AttributeDictionary.addRule("text","_color",{displayName:"Color"}),AttributeDictionary.addRule("text","_text",{displayName:"Text"}),AttributeDictionary.addRule("text","_texture",{visible:!1}),inheritsFrom(Text,GameObject),Text.AlignType={LEFT:1,CENTER:2,RIGHT:3};var maxWidth=500;Text.prototype.render=function(a,b){if(this.enabled){var c=this._gl;GameManager.activeGame.getShaderManager().useShader(this._textShader),c.enableVertexAttribArray(this._textShader.attributes.aPos),c.enableVertexAttribArray(this._textShader.attributes.aTexCoord),this._drawText();var d=GameManager.activeGame.getActiveCamera().getMatrix();c.uniformMatrix4fv(this._textShader.uniforms.uMatrix._location,!1,d),c.uniformMatrix4fv(this._textShader.uniforms.uTransform._location,!1,this.getMatrix()),c.activeTexture(c.TEXTURE0),this._texture.bind(),c.uniform1i(this._textShader.uniforms.uTexture._location,0),c.uniform1f(this._textShader.uniforms.uDebug._location,this._debug),c.bindBuffer(c.ARRAY_BUFFER,this._vertexBuffer),c.vertexAttribPointer(this._textShader.attributes.aPos,2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,this._textureBuffer),c.vertexAttribPointer(this._textShader.attributes.aTexCoord,2,c.FLOAT,!1,0,0);var e=this.getStroke().getColor();c.uniform4fv(this._textShader.uniforms.uOutlineColor._location,[e.r,e.g,e.b,e.a]);var f=.7*this.getStroke().getSize()/10;c.uniform1f(this._textShader.uniforms.uOutlineDistance._location,.7-f+.1);var g=this.getDropShadow().getColor();c.uniform4fv(this._textShader.uniforms.uDropShadowColor._location,[g.r,g.g,g.b,g.a]),c.uniform1f(this._textShader.uniforms.uDropShadowSmoothing._location,.5*this.getDropShadow().getSize()/10),this._dropShadowOffset.set(.005,.005),c.uniform2fv(this._textShader.uniforms.uDropShadowOffset._location,[this._dropShadowOffset.x,this._dropShadowOffset.y]);var h=this.getColor();c.uniform4fv(this._textShader.uniforms.uColor._location,[h.r,h.g,h.b,h.a]),c.uniform1f(this._textShader.uniforms.uGamma._location,1.4142*this.getGamma()/this.getFontSize()),c.drawElements(c.TRIANGLES,this._vertexIndicesBuffer.numItems,c.UNSIGNED_SHORT,0),GameObject.prototype.render.call(this,a,b)}},Text.prototype.unload=function(){this._gl.deleteBuffer(this._vertexBuffer),this._gl.deleteBuffer(this._textureBuffer),this._gl.deleteBuffer(this._vertexIndicesBuffer),this._textShader.unload()},Text.prototype.getMatrix=function(){var a,b;return a=this.transform.getPosition().x,b=this.transform.getPosition().y,mat4.identity(this._transformMatrix),mat4.translate(this._transformMatrix,this._transformMatrix,[a,b,0]),this._transformMatrix},Text.prototype.getType=function(){return"Text"},Text.prototype.getTexture=function(){return this._texture},Text.prototype.setTexture=function(a){if(!a||!a.isReady())return this._texture=null,this._textureWidth=0,void(this._textureHeight=0);this._texture=a,this._textureWidth=this._texture.getWidth(),this._textureHeight=this._texture.getHeight();var b=this._gl;b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.uniform2f(this._textShader.uniforms.uTexSize._location,this._texture.getWidth(),this._texture.getHeight())},Text.prototype.setColor=function(a){this._color=a},Text.prototype.getColor=function(){return this._color},Text.prototype.setStroke=function(a){this._stroke=a},Text.prototype.getStroke=function(){return this._stroke},Text.prototype.getDropShadow=function(){return this._dropShadow},Text.prototype.setDropShadow=function(a){this._dropShadow=a},Text.prototype.setText=function(a){this._text=a},Text.prototype.getText=function(){return this._text},Text.prototype.getFontStyle=function(){return this._fontStyle},Text.prototype.setFontStyle=function(a){this._fontStyle=a},Text.prototype.setFontSize=function(a){this.getFontStyle().setFontSize(a)},Text.prototype.getFontSize=function(){return this.getFontStyle().getFontSize()},Text.prototype.getLetterSpacing=function(){return this.getFontStyle().getLetterSpacing()},Text.prototype.setLetterSpacing=function(a){this.getFontStyle().setLetterSpacing(a)},Text.prototype.setGamma=function(a){this._gamma=a},Text.prototype.getGamma=function(){return this._gamma},Text.prototype.setDebug=function(a){this._debug=a},Text.prototype.getDebug=function(){return this._debug},Text.prototype.setWordWrap=function(a){this._wordWrap=a},Text.prototype.getWordWrap=function(){return this._wordWrap},Text.prototype.setCharacterWrap=function(a){this._characterWrap=a},Text.prototype.getCharacterWrap=function(){return this._characterWrap},Text.prototype.setAlign=function(a){this._alignType=a},Text.prototype.getAlign=function(){return this._alignType},Text.prototype.setTextureSrc=function(a){this._textureSrc=a,a&&a.length>0?Texture2D.fromPath(a).then(function(a){this.setTexture(a)}.bind(this),function(a){this.setTexture(null)}.bind(this)):this.setTexture(null)},Text.prototype.getTextureSrc=function(){return this._textureSrc},Text.prototype._drawText=function(){var a=this.getFontStyle();if(a){var b=a.getFontDescription();if(b&&b.common&&b.common.lineHeight){var c=b.common.lineHeight||this.getFontSize(),d=a.getScale();if(d){var e=TextUtils.measureText(a,this.getText(),maxWidth,this.getWordWrap(),this.getCharacterWrap());this._drawLines(e,d,c)}}}},Text.prototype._alignLine=function(a){var b;switch(this.getAlign()){case Text.AlignType.LEFT:b=this.transform.getPosition().x;break;case Text.AlignType.CENTER:b=this.transform.getPosition().x+maxWidth/2-a/2;break;case Text.AlignType.RIGHT:b=this.transform.getPosition().x+maxWidth-a;break;default:b=0}return b},Text.prototype._drawLines=function(a,b,c){if(a&&b&&!(b<=0)&&c&&0!==c){for(var d=this._gl,e=[],f=[],g=[],h={x:0,y:this.transform.getPosition().y},i=0;i<a.length;i++){h.x=this._alignLine(a[i].width);var j=a[i].chars;this._prepareLineToBeDrawn(j,b,h,e,f,g),h.y+=c*b}d.bindBuffer(d.ARRAY_BUFFER,this._vertexBuffer),d.bufferData(d.ARRAY_BUFFER,new Float32Array(e),d.STATIC_DRAW),this._vertexBuffer.numItems=e.length/2,d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,this._vertexIndicesBuffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,new Uint16Array(g),d.STATIC_DRAW),this._vertexIndicesBuffer.numItems=g.length,d.bindBuffer(d.ARRAY_BUFFER,this._textureBuffer),d.bufferData(d.ARRAY_BUFFER,new Float32Array(f),d.STATIC_DRAW),this._textureBuffer.numItems=f.length/2}},Text.prototype._prepareLineToBeDrawn=function(a,b,c,d,e,f){for(var g=0,h=0;h<a.length;h++){var i=a[h];g=this._createGlyph(i,b,c,g,d,e,f)}},Text.prototype._createGlyph=function(a,b,c,d,e,f,g){var h=this.getFontStyle();if(!h)return 0;var i=h.getFontDescription();if(!(i&&i.chars&&a&&b&&!(b<=0)&&c&&null!=d&&e&&f&&g))return 0;var j=h.findCharID(a);if(null===j)return 0;var k=i.chars[j],l=k.width,m=k.height,n=k.xoffset,o=k.yoffset,p=k.xadvance,q=k.x,r=k.y,s=k.id,t=0;if(l>0&&m>0){d&&(t=h.getKerning(d,s));var u=g.length/6*4;g.push(0+u,1+u,2+u,1+u,2+u,3+u),e.push(c.x+(n+t)*b,c.y+o*b,c.x+(n+t+l)*b,c.y+o*b,c.x+(n+t)*b,c.y+(m+o)*b,c.x+(n+t+l)*b,c.y+(m+o)*b),f.push(q,r,q+l,r,q,r+m,q+l,r+m)}return c.x=c.x+h.getLetterSpacing()+(p+t)*b,s},Texture2D.fromPath=function(a){return new Promise(function(b,c){ContentLoader.loadImage(a).then(function(a){b(new Texture2D(a))},function(){c()})}.bind(this))},Texture2D.prototype.getUID=function(){return this._uid},Texture2D.prototype.bind=function(){this._gl.bindTexture(this._gl.TEXTURE_2D,this._texture)},Texture2D.prototype.setImageData=function(a){this._source=a},Texture2D.prototype.getWidth=function(){return this._source.width},Texture2D.prototype.getHeight=function(){return this._source.height},Texture2D.prototype.getImageData=function(){return this._source},Texture2D.prototype.getTexture=function(){return this._texture},Texture2D.prototype.isReady=function(){return this._hasLoaded},Texture2D.prototype.unload=function(){},AttributeDictionary.addRule("transform","gameObject",{ownContainer:!0}),Transform.prototype.clearPositionGetter=function(){this._overridePositionFunction=null},Transform.prototype.clearRotationGetter=function(){this._overrideRotationFunction=null},Transform.prototype.clearScaleGetter=function(){this._overrideScaleFunction=null},Transform.prototype.overridePositionGetter=function(a){this._overridePositionFunction=a},Transform.prototype.overrideScaleGetter=function(a){this._overrideScaleFunction=a},Transform.prototype.overrideRotationGetter=function(a){this._overrideRotationFunction=a},Transform.prototype.lookAt=function(a){var b=this.getPosition().subtract(a).normalize();this.setRotation(Math.atan2(b.y,b.x))},Transform.prototype.setPosition=function(a,b){this._position.set(a,b),this.gameObject.propagatePropertyUpdate("Position",this._position)},Transform.prototype.getPosition=function(){return isFunction(this._overridePositionFunction)?this._overridePositionFunction():this._position},Transform.prototype.translate=function(a,b){var c=this.getPosition();this.setPosition(c.x+(a||0),c.y+(b||0))},Transform.prototype.rotate=function(a){this.setRotation(this.getRotation()+(a||0))},Transform.prototype.scale=function(a,b){var c=this.getScale();this.setPosition(c.x+(a||0),c.y+(b||0))},Transform.prototype.setRotation=function(a){this._rotation=a,this.gameObject.propagatePropertyUpdate("Rotation",this._rotation)},Transform.prototype.getRotation=function(){return isFunction(this._overrideRotationFunction)?this._overrideRotationFunction():this._rotation},Transform.prototype.setScale=function(a,b){this._scale.set(a,b||a),this.gameObject.propagatePropertyUpdate("Scale",this._scale)},Transform.prototype.getScale=function(){return isFunction(this._overrideScaleFunction)?this._overrideScaleFunction():this._scale},Transform.prototype.clone=function(){return Transform.restore(this.objectify())},Transform.prototype.objectify=function(){return{position:this._position.objectify(),rotation:this._rotation,scale:this._scale.objectify()}},Transform.restore=function(a){return new Transform({position:Vector2.restore(a.position),rotation:a.rotation,scale:Vector2.restore(a.scale)})},Transform.prototype.unload=function(){};var WrapMode={CLAMP:0,REPEAT:1};GridExt.prototype.setOriginLines=function(a){this._originLines=a},GridExt.prototype.setGridSize=function(a){this._gridSize=a},GridExt.prototype.getGridSize=function(){return this._gridSize},GridExt.prototype.setGridColor=function(a){this._gridColor=a},GridExt.prototype.render=function(a){if(this.enabled){for(var b=this._game.getActiveCamera().zoom,c=Math.floor(b),d=this._gridSize,e=0;e<c-1;e++)e%this._zoomMultiplier==0&&(d*=2);var f=2*d,g=this._game.getVirtualResolution(),h=this._game.getActiveCamera().x-this._game.getActiveCamera().x%d,i=this._game.getActiveCamera().y-this._game.getActiveCamera().y%d,j=b*g.width*2,k=b*g.height*2,l=Math.floor((g.width+j)/d+2),m=Math.floor((g.height+k)/d+2),n=Math.floor(l/2)%2==0,o=Math.floor(m/2)%2==0,p=-(g.width+j)/2,q=(g.width+j)/2,r=-(g.height+k)/2,s=(g.height+k)/2,t=this._gridColor.clone(),u=null;b>1&&(t.a=1-b%this._zoomMultiplier/this._zoomMultiplier);for(var v=0;v<l;v++)u=this._gridColor,(v*d+h+(n?d:0))%f&&(u=t),this._primitiveRender.drawLine({x:v*d+p-p%d+h,y:s+d+i},{x:v*d+p-p%d+h,y:r-d+i},1,u);for(var w=0;w<m;w++)u=this._gridColor,(w*d+i+(o?d:0))%f&&(u=t),this._primitiveRender.drawLine({x:q+this._gridSize+h,y:w*d+r-r%d+i},{x:p-d+h,y:w*d+r-r%d+i},1,u);this._originLines&&(this._primitiveRender.drawRectangle(new Rectangle((-2),r-this._gridSize+i,4,g.height+k),this._gridColor),this._primitiveRender.drawRectangle(new Rectangle(p-this._gridSize+h,(-2),g.width+j,4),this._gridColor))}},Keyboard._keys=[],Keyboard.removeKey=function(a){var b=Keyboard._keys.indexOf(a);b>=0&&Keyboard._keys.splice(b,1)},Keyboard.removeKeys=function(a){a.forEach(function(a){Keyboard.removeKey(a)})},Keyboard.addKey=function(a){Keyboard._keys.indexOf(a)<0&&Keyboard._keys.push(a)},Keyboard.addKeys=function(a){a.forEach(function(a){Keyboard.addKey(a)})},Keyboard.setKeys=function(a){Keyboard._keys=a},Keyboard.clearKeys=function(){Keyboard._keys=[]},Keyboard.getState=function(){return new KeyboardState(Keyboard._keys)},Keyboard.isKeyDown=function(a){return Keyboard._keys.indexOf(a)>=0},Keyboard.isKeyUp=function(a){return Keyboard._keys.indexOf(a)<0},KeyboardState.prototype.getKeys=function(){return this._keys},KeyboardState.prototype.isKeyDown=function(a){return this._keys.indexOf(a)>=0},KeyboardState.prototype.isKeyUp=function(a){return this._keys.indexOf(a)<0},Keys.Backspace=8,Keys.Tab=9,Keys.Enter=13,Keys.Shift=16,Keys.Ctrl=17,Keys.Alt=18,Keys.Pause=19,Keys.Break=19,Keys.CapsLock=20,Keys.Escape=27,Keys.PageUp=33,Keys.PageDown=34,Keys.End=35,Keys.Home=36,Keys.LeftArrow=37,Keys.UpArrow=38,Keys.RightArrow=39,Keys.DownArrow=40,Keys.Insert=45,Keys.Delete=46,Keys.Space=32,Keys.D0=48,Keys.D1=49,Keys.D2=50,Keys.D3=51,Keys.D4=52,Keys.D5=53,Keys.D6=54,Keys.D7=55,Keys.D8=56,Keys.D9=57,Keys.A=65,Keys.B=66,Keys.C=67,Keys.D=68,Keys.E=69,Keys.F=70,Keys.G=71,Keys.H=72,Keys.I=73,Keys.J=74,Keys.K=75,Keys.L=76,Keys.M=77,Keys.N=78,Keys.O=79,Keys.P=80,Keys.Q=81,Keys.R=82,Keys.S=83,Keys.T=84,Keys.U=85,Keys.V=86,Keys.W=87,Keys.X=88,Keys.Y=89,Keys.Z=90,Keys.LeftWindowKey=91,Keys.RightWindowKey=92,Keys.SelectKey=93,Keys.NumPad0=96,Keys.NumPad1=97,Keys.NumPad2=98,Keys.NumPad3=99,Keys.NumPad4=100,Keys.NumPad5=101,Keys.NumPad6=102,Keys.NumPad7=103,Keys.NumPad8=104,Keys.NumPad9=105,Keys.Multiply=106,Keys.Add=107,Keys.Subtract=109,Keys.DecimalPoint=110,Keys.Divide=111,Keys.F1=112,Keys.F2=113,Keys.F3=114,Keys.F4=115,Keys.F5=116,Keys.F6=117,Keys.F7=118,Keys.F8=119,Keys.F9=120,Keys.F10=121,Keys.F11=122,Keys.F12=123,Keys.NumLock=144,Keys.ScrollLock=145,Keys.SemiColon=186,Keys.EqualSign=187,Keys.Comma=188,Keys.Dash=189,Keys.Period=190,Keys.ForwardSlash=191,Keys.GraveAccent=192,Keys.OpenBracket=219,Keys.BackSlash=220,Keys.CloseBraket=221,Keys.SingleQuote=222,Boundary.prototype.getVertices=function(){return[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft]},Boundary.prototype.getNormals=function(){return{top:new Vector2(this.topRight.x-this.topLeft.x,this.topRight.y-this.topLeft.y).normalLeft(),right:new Vector2(this.bottomRight.x-this.topRight.x,this.bottomRight.y-this.topRight.y).normalLeft(),bottom:new Vector2(this.bottomLeft.x-this.bottomRight.x,this.bottomLeft.y-this.bottomRight.y).normalLeft(),left:new Vector2(this.topLeft.x-this.bottomLeft.x,this.topLeft.y-this.bottomLeft.y).normalLeft()}},Boundary.prototype.overlapsWith=function(a){return Boundary.overlap(this,a)},Boundary.overlap=function(a,b){function c(a,b){var c=a.topRight.dot(b),d=a.bottomRight.dot(b),e=a.bottomLeft.dot(b),f=a.topLeft.dot(b);return{max:Math.max(c,d,e,f),min:Math.min(c,d,e,f)}}for(var d,e,f,g,h=a.getNormals(),i=b.getNormals(),j=0;j<4;j++)if(f=j>=2?i:h,g=j%2==0?f.bottom:f.right,d=c(a,g),e=c(b,g),d.max<e.min||e.max<d.min)return!1;return!0},Boundary.fromVector2=function(a,b){var c=b/2;return new Boundary(new Vector2(a.x-c,a.y-c),new Vector2(a.x+c,a.y-c),new Vector2(a.x+c,a.y+c),new Vector2(a.x-c,a.y+c))};var MathHelper=function(){};MathHelper.PI=Math.PI,MathHelper.PI2=2*MathHelper.PI,MathHelper.PI4=4*MathHelper.PI,MathHelper.PIo2=MathHelper.PI/2,MathHelper.PIo4=MathHelper.PI/4,MathHelper.clamp=function(a,b,c){return a<b?b:a>c?c:a},MathHelper.degToRad=function(a){return.0174532925*a},MathHelper.radToDeg=function(a){return 57.295779513*a},SetterDictionary.addRule("ray",["origin","direction"]),Ray.prototype.set=function(a,b){this.origin=a,this.direction=b},Ray.prototype.objectify=function(){return{origin:this.origin,direction:this.direction}},Ray.restore=function(a){return new Ray(a.origin,a.direction)},Ray.prototype.equals=function(a){return a.origin===this.origin&&a.direction===this.direction},Ray.prototype.unload=function(){},SetterDictionary.addRule("rectangle",["x","y","width","height"]),Rectangle.fromVectors=function(a,b){var c,d,e,f;return a.x>b.x?(c=b.x,e=Math.abs(a.x-b.x)):(c=a.x,e=Math.abs(b.x-a.x)),a.y>b.y?(d=b.y,f=Math.abs(a.y-b.y)):(d=a.y,f=Math.abs(b.y-a.y)),new Rectangle(c,d,e,f)},Rectangle.prototype.getVertices=function(){return{topLeft:new Vector2(this.x,this.y),topRight:new Vector2(this.x+this.width,this.y),bottomRight:new Vector2(this.x+this.width,this.y+this.height),bottomLeft:new Vector2(this.x,this.y+this.height)}},Rectangle.prototype.intersects=function(a){return a.x<=this.x+this.width&&this.x<=a.x+a.width&&a.y<=this.y+this.height&&this.y<=a.y+a.height},Rectangle.prototype.contains=function(a){return a.x>=this.x&&a.x+a.width<=this.x+this.width&&a.y>=this.y&&a.y+a.height<=this.y+this.height},Rectangle.prototype.set=function(a,b,c,d){this.x=a,this.y=b,this.width=c,this.height=d},Rectangle.prototype.objectify=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},Rectangle.restore=function(a){return new Rectangle(a.x,a.y,a.width,a.height)},Rectangle.prototype.equals=function(a){return a.x===this.x&&a.y===this.y&&a.width===this.width&&a.height===this.height},Rectangle.prototype.unload=function(){},SetterDictionary.addRule("vector2",["x","y"]),Vector2.prototype.set=function(a,b){this.x=a,this.y=b},Vector2.prototype.objectify=function(){return{x:this.x,y:this.y}},Vector2.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Vector2.prototype.sqrMagnitude=function(){return this.x*this.x+this.y*this.y},Vector2.prototype.normalLeft=function(){return new Vector2(this.y,-1*this.x)},Vector2.prototype.normalRight=function(){return new Vector2(-1*this.y,this.x)},Vector2.prototype.normalize=function(){return Vector2.normalize(this)},Vector2.normalize=function(a){var b=1/Math.sqrt(a.x*a.x+a.y*a.y);return a.x*=b,a.y*=b,a},Vector2.prototype.dot=function(a){return this.x*a.x+this.y*a.y},Vector2.prototype.cross=function(a){return this.x*a.y-this.y*a.x},Vector2.prototype.distanceTo=function(a){return Math.sqrt((this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y))},Vector2.prototype.multiply=function(a){this.x*=a.x,this.y*=a.y},Vector2.prototype.equals=function(a){return a.x===this.x&&a.y===this.y},Vector2.prototype.unload=function(){},Vector2.prototype.subtract=function(a){return Vector2.subtract(this,a)},Vector2.prototype.add=function(a){return Vector2.add(this,a)},Vector2.subtract=function(a,b){return new Vector2(a.x-b.x,a.y-b.y)},Vector2.add=function(a,b){return new Vector2(a.x+b.x,a.y+b.y)},Vector2.multiply=function(a,b){return new Vector2(a.x*b.x,a.y*b.y)},Vector2.restore=function(a){return new Vector2(a.x,a.y)},Vector2.distance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},Vector2.sqrDistance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d},Vector2.transformMat4=function(a,b){return new Vector2(b[0]*a.x+b[4]*a.y+b[12],b[1]*a.x+b[5]*a.y+b[13])},Vector2.transformMat3=function(a,b){return new Vector2(b[0]*a.x+b[3]*a.y+b[6],b[1]*a.x+b[4]*a.y+b[7])},SetterDictionary.addRule("vector3",["x","y","z"]),Vector3.prototype.set=function(a,b,c){this.x=a,this.y=b,this.z=c},Vector3.prototype.objectify=function(){return{x:this.x,y:this.y,z:this.z}},Vector3.restore=function(a){return new Vector3(a.x,a.y,a.z)},Vector3.prototype.equals=function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},Vector3.prototype.unload=function(){},Vector3.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},Vector3.prototype.sqrMagnitude=function(){return this.x*this.x+this.y*this.y+this.z*this.z},Vector3.prototype.distanceTo=function(a){return Math.sqrt((this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y)+(this.z-a.z)*(this.z-a.z))},Vector3.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z},Vector3.prototype.cross=function(a){return new Vector3(this.y*a.z-this.z*a.y,this.z*a.x-this.x*a.z,this.x*a.y-this.y*a.x)},SetterDictionary.addRule("vector4",["x","y","z","w"]),Vector4.prototype.set=function(a,b,c,d){this.x=a,this.y=b,this.z=c,this.w=d},Vector4.prototype.objectify=function(){return{x:this.x,y:this.y,z:this.z,w:this.w}},Vector4.restore=function(a){return new Vector4(a.x,a.y,a.z,a.w)},Vector4.prototype.equals=function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},Vector4.prototype.unload=function(){},Shader.prototype.setup=function(){if(this.compile()){var a=GameManager.activeGame.getShaderManager();a?a.useShader(this):this._gl.useProgram(this._program),this.cacheUniformLocations(Object.keys(this.uniforms)),this.cacheAttributeLocations(Object.keys(this.attributes))}else debug.error("Shader setup failed")},Shader.prototype.compile=function(){var a=glu.createProgramFromScripts(this._gl,this._vertexScript,this._fragmentScript);return isObjectAssigned(a)?(this._program=a,!0):(a=null,!1)},Shader.prototype.getUID=function(){return this._uid},Shader.prototype.cacheUniformLocations=function(a){for(var b=0;b<a.length;++b)this.uniforms[a[b]]._location=this._gl.getUniformLocation(this._program,a[b])},Shader.prototype.cacheAttributeLocations=function(a){for(var b=0;b<a.length;++b)this.attributes[a[b]]=this._gl.getAttribLocation(this._program,a[b])},Shader.prototype.syncUniforms=function(){this._textureCount=1;for(var a in this.uniforms)this.syncUniform(this.uniforms[a])},Shader.prototype.syncUniform=function(a){var b=a._location,c=a.value,d=this._gl;switch(a.type){case"b":case"bool":d.uniform1i(b,c?1:0);break;case"i":case"1i":d.uniform1i(b,c);break;case"2i":d.uniform2i(b,c[0],c[1]);break;case"3i":d.uniform3i(b,c[0],c[1],c[2]);break;case"4i":d.uniform4i(b,c[0],c[1],c[2],c[3]);break;case"f":case"1f":d.uniform1f(b,c);break;case"2f":d.uniform2f(b,c[0],c[1]);break;case"3f":d.uniform3f(b,c[0],c[1],c[2]);break;case"4f":d.uniform4f(b,c[0],c[1],c[2],c[3]);break;case"m2":case"mat2":d.uniformMatrix2fv(b,a.transpose,c);break;case"m3":case"mat3":d.uniformMatrix3fv(b,a.transpose,c);break;case"m4":case"mat4":d.uniformMatrix4fv(b,a.transpose,c);break;case"tex":if(!isTexture2D(a.value)||!a.value.isReady()){debug.warn("Could not assign texture uniform because the texture isn't ready.");break}d.activeTexture(d["TEXTURE"+this._textureCount]);var e=a.value.getImageData()._glTextures[d.id];!isObjectAssigned(e);break;default:debug.warn("Unknown uniform type: "+a.type)}},Shader.prototype.getProgram=function(){return this._program},Shader.prototype.initSampler2D=function(a){if(!isTexture2D(a.value)||!a.value.isReady())return void debug.warn("Could not initialize sampler2D because the texture isn't ready.");var b=a.value.getImageData();b.baseTexture},Shader.prototype.unload=function(){this._gl.deleteProgram(this._program)},ShaderManager.prototype.unload=function(){},ShaderManager.prototype.useShader=function(a){isObjectAssigned(this._activeShader)&&this._activeShader.getUID()===a.getUID()||(this._activeShader=a,this._gl.useProgram(a.getProgram()))},inheritsFrom(TestShader,Shader),inheritsFrom(TextShader,Shader),inheritsFrom(TextureShader,Shader);var Objectify=function(){};Objectify._logger=new Logger("Objectify"),Objectify.array=function(a){var b=[];return a.forEach(function(a){if(isFunction(a.objectify))try{var c=Objectify.create(a);c&&b.push(c)}catch(d){Objectify._logger.error("Failed to objectify element: "+d)}}),b},Objectify.restoreArray=function(a){var b=[];return a.forEach(function(a){a._otype&&b.push(Objectify.restore(a,a._otype))}),b},Objectify.createDataString=function(a,b){return b?JSON.stringify(Objectify.create(a),null,4):JSON.stringify(Objectify.create(a))},Objectify.create=function(a){var b,c=getType(a);return b=a.objectify?a.objectify():JSON.parse(JSON.stringify(a)),b._otype=c,b},Objectify.restore=function(data,typeName){try{var type=isObjectAssigned(typeName)?typeName:data._otype;if(type=eval(type),type&&type.restore)return type.restore(data)}catch(ex){Objectify._logger.error("Failed to restore element: "+ex)}},Objectify.restoreFromString=function(a,b){return Objectify.restore(JSON.parse(a),b)},Objectify.extend=function(a,b){return Object.keys(b).forEach(function(c){a[c]=b[c]}),a};var Path=function(){};Path._IS_WIN=navigator.platform.toLowerCase().indexOf("win")>-1,Path.TRAILING_SLASH=Path._IS_WIN?"\\":"/",Path.wrapDirectoryPath=function(a){return a+(a.endsWith("/")||a.endsWith("\\")?"":Path.TRAILING_SLASH)},Path.getDirectory=function(a){var b=Math.max(a.lastIndexOf("/"),a.lastIndexOf("\\"));return a.substring(0,b>=0?b:a.length)},Path.getDirectoryName=function(a){(a.endsWith("/")||a.endsWith("\\"))&&(a=a.substring(0,a.length-1));var b=Math.max(a.lastIndexOf("/"),a.lastIndexOf("\\"));return a.substring(b+1,a.length)},Path.getFilename=function(a){var b=Math.max(a.lastIndexOf("/"),a.lastIndexOf("\\"));return a.substring(b>=0&&b<a.length-1?b+1:0,a.length)},Path.getFileExtension=function(a){return a.substring(a.lastIndexOf("."),a.length)},Path.relativeTo=function(a,b){return 0===Path.wrapDirectoryPath(a).indexOf(Path.wrapDirectoryPath(b))},Path.makeRelative=function(a,b){return b.replace(Path.wrapDirectoryPath(a),"")};var TextUtils=function(){};Array.prototype.insert=function(a){this.splice.apply(this,[a,0].concat(this.slice.call(arguments,1)))},String.prototype.insert=function(a,b){return a>0?this.substring(0,a)+b+this.substring(a,this.length):b+this},TextUtils.measureCharacterWidth=function(a,b){if(!a||!b)return 0;var c=a.getScale();if(!c)return 0;var d=a.findCharID(b);if(null===d)return 0;var e=a.getFontDescription().chars[d].xadvance*c;return e},TextUtils.measureTextWidth=function(a,b){if(!a||!b||!a.getScale())return 0;for(var c=0,d=0,e=!1,f=0;f<b.length;f++){var g=b[f];!e&&c>0&&(d=a.getLetterSpacing(),e=!0);var h=TextUtils.measureCharacterWidth(a,g);h>0&&(c+=h+d)}return c},TextUtils.wrapWordsShortVersion=function(a,b,c){var d=[];if(!a||!b||!c||c<=0)return d;var e=b.split(" ");if(1==e.length)return e;for(var f=" ",g=e.shift(),h=0;h<e.length;h++){var i=e[h],j=g+f+i,k=TextUtils.measureTextWidth(a,j);k>c?(d.push(g),g=i):g+=f+i}return d.push(g),d},TextUtils.wrapWordsLongVersion=function(a,b,c,d){var e=[];if(!a||!b||!c||c<=0)return e;for(var f=b.split(" "),g="",h=0,i="",j=0,k=!1,l=0;l<f.length;l++){var m=f[l];!k&&h>0&&(i=" ",j=TextUtils.measureCharacterWidth(a,i)+a.getLetterSpacing(),k=!0);var n=TextUtils.measureTextWidth(a,m);if(d&&n>c){var o=g+i+m,p=TextUtils.wrapTextByCharacter(a,o,c);g=p.splice(-1,1)[0].chars.join(""),h=TextUtils.measureTextWidth(a,g),i="",j=0,k=!1;for(var q=0;q<p.length;q++){var r=p[q].chars.join("");e.push(r)}}else{var s=h+n+j;s>c?(e.push(g),g=m,h=n,i="",j=0,k=!1):(g+=i+m,h+=j+n)}}return e.push(g),e},TextUtils.wrapTextByCharacter=function(a,b,c){var d=[];if(!a||!b||!c||c<=0)return d;d.push({chars:[],width:0});for(var e=0,f=!1,g=0;g<b.length;g++){var h=b[g],i=d.length-1;!f&&d[i].width>0&&(e=a.getLetterSpacing(),f=!0);var j=TextUtils.measureCharacterWidth(a,h),k=d[i].width+j+e;k>c&&(d.push({chars:[],width:0}),i++,e=0,f=!1," "===h)||(d[i].width+=j+e,d[i].chars.push(h))}return d},TextUtils.convertTextStringToLineFormat=function(a,b){var c={chars:Array(),width:0};return a&&b&&a.getScale()?(c.chars=b.split(""),c.width=TextUtils.measureTextWidth(a,b),c):c},TextUtils.measureText=function(a,b,c,d,e){var f=[];if(!(a&&b&&c&&a.getScale()))return f;f.push({chars:[],width:0});var g=b,h=[];if(d){var i="";h=g.split(/(?:\r\n|\r|\n)/);for(var j=0;j<h.length;j++){var k=TextUtils.wrapWordsLongVersion(a,h[j],c,e).join("\n");k=k.insert(k.length,"\n"),i=i.concat(k)}g=i}h=g.split(/(?:\r\n|\r|\n)/);for(var j=0;j<h.length;j++){var l=h[j],m=[];!d&&e?m=TextUtils.wrapTextByCharacter(a,l,c):m.push(TextUtils.convertTextStringToLineFormat(a,l)),Array.prototype.push.apply(f,m)}return f};var Utility=function(){};WebGLContext.prototype.setVirtualResolution=function(a,b){isObjectAssigned(this._gl)&&(this._canvas.width=a,this._canvas.height=b,this._gl.viewport(0,0,a,b))},WebGLContext.prototype.assignContextFromContainer=function(a){var b=this._gl=a.getContext("experimental-webgl",{
alpha:!1})||a.getContext("webgl",{alpha:!1})||a.getContext("webkit-3d",{alpha:!1})||a.getContext("moz-webgl",{alpha:!1});return isObjectAssigned(this._gl)?(this._canvas=a,b.disable(b.CULL_FACE),b.disable(b.DEPTH_TEST),b.blendFuncSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE),b.enable(b.BLEND),void b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA)):void this._logger.warn("WebGL not supported, find a container that does (eg. Chrome, Firefox)")},WebGLContext.prototype.getName=function(){return SC.WEBGL},WebGLContext.prototype.getContext=function(){return this._gl},WebGLContext.prototype.unload=function(){},function(a,b){if("object"==typeof exports&&"object"==typeof module)module.exports=b();else if("function"==typeof define&&define.amd)define([],b);else{var c=b();for(var d in c)("object"==typeof exports?exports:a)[d]=c[d]}}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){b.glMatrix=c(1),b.mat2=c(2),b.mat2d=c(3),b.mat3=c(4),b.mat4=c(5),b.quat=c(6),b.vec2=c(9),b.vec3=c(7),b.vec4=c(8)},function(a,b){var c={};c.EPSILON=1e-6,c.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,c.RANDOM=Math.random,c.ENABLE_SIMD=!1,c.SIMD_AVAILABLE=c.ARRAY_TYPE===this.Float32Array&&"SIMD"in this,c.USE_SIMD=c.ENABLE_SIMD&&c.SIMD_AVAILABLE,c.setMatrixArrayType=function(a){c.ARRAY_TYPE=a};var d=Math.PI/180;c.toRadian=function(a){return a*d},c.equals=function(a,b){return Math.abs(a-b)<=c.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))},a.exports=c},function(a,b,c){var d=c(1),e={};e.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},e.clone=function(a){var b=new d.ARRAY_TYPE(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},e.fromValues=function(a,b,c,e){var f=new d.ARRAY_TYPE(4);return f[0]=a,f[1]=b,f[2]=c,f[3]=e,f},e.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},e.transpose=function(a,b){if(a===b){var c=b[1];a[1]=b[2],a[2]=c}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*f-e*d;return g?(g=1/g,a[0]=f*g,a[1]=-d*g,a[2]=-e*g,a[3]=c*g,a):null},e.adjoint=function(a,b){var c=b[0];return a[0]=b[3],a[1]=-b[1],a[2]=-b[2],a[3]=c,a},e.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*h+f*i,a[1]=e*h+g*i,a[2]=d*j+f*k,a[3]=e*j+g*k,a},e.mul=e.multiply,e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+f*h,a[1]=e*i+g*h,a[2]=d*-h+f*i,a[3]=e*-h+g*i,a},e.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1];return a[0]=d*h,a[1]=e*h,a[2]=f*i,a[3]=g*i,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=-c,a[3]=d,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=b[1],a},e.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))},e.LDU=function(a,b,c,d){return a[2]=d[2]/d[0],c[0]=d[0],c[1]=d[1],c[3]=d[3]-a[2]*c[1],[a,b,c]},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},e.sub=e.subtract,e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]},e.equals=function(a,b){var c=a[0],e=a[1],f=a[2],g=a[3],h=b[0],i=b[1],j=b[2],k=b[3];return Math.abs(c-h)<=d.EPSILON*Math.max(1,Math.abs(c),Math.abs(h))&&Math.abs(e-i)<=d.EPSILON*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(f-j)<=d.EPSILON*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(g-k)<=d.EPSILON*Math.max(1,Math.abs(g),Math.abs(k))},e.multiplyScalar=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},e.multiplyScalarAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a},a.exports=e},function(a,b,c){var d=c(1),e={};e.create=function(){var a=new d.ARRAY_TYPE(6);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(6);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},e.fromValues=function(a,b,c,e,f,g){var h=new d.ARRAY_TYPE(6);return h[0]=a,h[1]=b,h[2]=c,h[3]=e,h[4]=f,h[5]=g,h},e.set=function(a,b,c,d,e,f,g){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a[4]=f,a[5]=g,a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=c*f-d*e;return i?(i=1/i,a[0]=f*i,a[1]=-d*i,a[2]=-e*i,a[3]=c*i,a[4]=(e*h-f*g)*i,a[5]=(d*g-c*h)*i,a):null},e.determinant=function(a){return a[0]*a[3]-a[1]*a[2]},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1],l=c[2],m=c[3],n=c[4],o=c[5];return a[0]=d*j+f*k,a[1]=e*j+g*k,a[2]=d*l+f*m,a[3]=e*l+g*m,a[4]=d*n+f*o+h,a[5]=e*n+g*o+i,a},e.mul=e.multiply,e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=Math.sin(c),k=Math.cos(c);return a[0]=d*k+f*j,a[1]=e*k+g*j,a[2]=d*-j+f*k,a[3]=e*-j+g*k,a[4]=h,a[5]=i,a},e.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1];return a[0]=d*j,a[1]=e*j,a[2]=f*k,a[3]=g*k,a[4]=h,a[5]=i,a},e.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=d*j+f*k+h,a[5]=e*j+g*k+i,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=-c,a[3]=d,a[4]=0,a[5]=0,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=b[1],a[4]=0,a[5]=0,a},e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=b[0],a[5]=b[1],a},e.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a[4]=b[4]+c[4],a[5]=b[5]+c[5],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a[4]=b[4]-c[4],a[5]=b[5]-c[5],a},e.sub=e.subtract,e.multiplyScalar=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a[4]=b[4]*c,a[5]=b[5]*c,a},e.multiplyScalarAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a[4]=b[4]+c[4]*d,a[5]=b[5]+c[5]*d,a},e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]},e.equals=function(a,b){var c=a[0],e=a[1],f=a[2],g=a[3],h=a[4],i=a[5],j=b[0],k=b[1],l=b[2],m=b[3],n=b[4],o=b[5];return Math.abs(c-j)<=d.EPSILON*Math.max(1,Math.abs(c),Math.abs(j))&&Math.abs(e-k)<=d.EPSILON*Math.max(1,Math.abs(e),Math.abs(k))&&Math.abs(f-l)<=d.EPSILON*Math.max(1,Math.abs(f),Math.abs(l))&&Math.abs(g-m)<=d.EPSILON*Math.max(1,Math.abs(g),Math.abs(m))&&Math.abs(h-n)<=d.EPSILON*Math.max(1,Math.abs(h),Math.abs(n))&&Math.abs(i-o)<=d.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))},a.exports=e},function(a,b,c){var d=c(1),e={};e.create=function(){var a=new d.ARRAY_TYPE(9);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromMat4=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[4],a[4]=b[5],a[5]=b[6],a[6]=b[8],a[7]=b[9],a[8]=b[10],a},e.clone=function(a){var b=new d.ARRAY_TYPE(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},e.fromValues=function(a,b,c,e,f,g,h,i,j){var k=new d.ARRAY_TYPE(9);return k[0]=a,k[1]=b,k[2]=c,k[3]=e,k[4]=f,k[5]=g,k[6]=h,k[7]=i,k[8]=j,k},e.set=function(a,b,c,d,e,f,g,h,i,j){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a[4]=f,a[5]=g,a[6]=h,a[7]=i,a[8]=j,a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},e.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a},e.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},e.mul=e.multiply,e.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=m*d+n*g+j,a[7]=m*e+n*h+k,a[8]=m*f+n*i+l,a},e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=Math.sin(c),n=Math.cos(c);return a[0]=n*d+m*g,a[1]=n*e+m*h,a[2]=n*f+m*i,a[3]=n*g-m*d,a[4]=n*h-m*e,a[5]=n*i-m*f,a[6]=j,a[7]=k,a[8]=l,a},e.scale=function(a,b,c){var d=c[0],e=c[1];return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=e*b[3],a[4]=e*b[4],a[5]=e*b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=b[0],a[7]=b[1],a[8]=1,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=-c,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=b[1],a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromMat2d=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=0,a[3]=b[2],a[4]=b[3],a[5]=0,a[6]=b[4],a[7]=b[5],a[8]=1,a},e.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[3]=k-r,a[6]=m+q,a[1]=k+r,a[4]=1-j-o,a[7]=n-p,a[2]=m-q,a[5]=n+p,a[8]=1-j-l,a},e.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(i*A-g*D-j*z)*E,a[2]=(g*C-h*A+j*y)*E,a[3]=(e*C-d*D-f*B)*E,a[4]=(c*D-e*A+f*z)*E,a[5]=(d*A-c*C-f*y)*E,a[6]=(p*x-q*w+r*v)*E,a[7]=(q*u-o*x-r*t)*E,a[8]=(o*w-p*u+r*s)*E,a):null},e.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a[4]=b[4]+c[4],a[5]=b[5]+c[5],a[6]=b[6]+c[6],a[7]=b[7]+c[7],a[8]=b[8]+c[8],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a[4]=b[4]-c[4],a[5]=b[5]-c[5],a[6]=b[6]-c[6],a[7]=b[7]-c[7],a[8]=b[8]-c[8],a},e.sub=e.subtract,e.multiplyScalar=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a[4]=b[4]*c,a[5]=b[5]*c,a[6]=b[6]*c,a[7]=b[7]*c,a[8]=b[8]*c,a},e.multiplyScalarAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a[4]=b[4]+c[4]*d,a[5]=b[5]+c[5]*d,a[6]=b[6]+c[6]*d,a[7]=b[7]+c[7]*d,a[8]=b[8]+c[8]*d,a},e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]},e.equals=function(a,b){var c=a[0],e=a[1],f=a[2],g=a[3],h=a[4],i=a[5],j=a[6],k=a[7],l=a[8],m=b[0],n=b[1],o=b[2],p=b[3],q=b[4],r=b[5],s=a[6],t=b[7],u=b[8];return Math.abs(c-m)<=d.EPSILON*Math.max(1,Math.abs(c),Math.abs(m))&&Math.abs(e-n)<=d.EPSILON*Math.max(1,Math.abs(e),Math.abs(n))&&Math.abs(f-o)<=d.EPSILON*Math.max(1,Math.abs(f),Math.abs(o))&&Math.abs(g-p)<=d.EPSILON*Math.max(1,Math.abs(g),Math.abs(p))&&Math.abs(h-q)<=d.EPSILON*Math.max(1,Math.abs(h),Math.abs(q))&&Math.abs(i-r)<=d.EPSILON*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(j-s)<=d.EPSILON*Math.max(1,Math.abs(j),Math.abs(s))&&Math.abs(k-t)<=d.EPSILON*Math.max(1,Math.abs(k),Math.abs(t))&&Math.abs(l-u)<=d.EPSILON*Math.max(1,Math.abs(l),Math.abs(u))},a.exports=e},function(a,b,c){var d=c(1),e={scalar:{},SIMD:{}};e.create=function(){var a=new d.ARRAY_TYPE(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.clone=function(a){var b=new d.ARRAY_TYPE(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.fromValues=function(a,b,c,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=new d.ARRAY_TYPE(16);return r[0]=a,r[1]=b,r[2]=c,r[3]=e,r[4]=f,r[5]=g,r[6]=h,r[7]=i,r[8]=j,r[9]=k,r[10]=l,r[11]=m,r[12]=n,r[13]=o,r[14]=p,r[15]=q,r},e.set=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a[4]=f,a[5]=g,a[6]=h,a[7]=i,a[8]=j,a[9]=k,a[10]=l,a[11]=m,a[12]=n,a[13]=o,a[14]=p,a[15]=q,a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.scalar.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},e.SIMD.transpose=function(a,b){var c,d,e,f,g,h,i,j,k,l;return c=SIMD.Float32x4.load(b,0),d=SIMD.Float32x4.load(b,4),e=SIMD.Float32x4.load(b,8),f=SIMD.Float32x4.load(b,12),g=SIMD.Float32x4.shuffle(c,d,0,1,4,5),h=SIMD.Float32x4.shuffle(e,f,0,1,4,5),i=SIMD.Float32x4.shuffle(g,h,0,2,4,6),j=SIMD.Float32x4.shuffle(g,h,1,3,5,7),SIMD.Float32x4.store(a,0,i),SIMD.Float32x4.store(a,4,j),g=SIMD.Float32x4.shuffle(c,d,2,3,6,7),h=SIMD.Float32x4.shuffle(e,f,2,3,6,7),k=SIMD.Float32x4.shuffle(g,h,0,2,4,6),l=SIMD.Float32x4.shuffle(g,h,1,3,5,7),SIMD.Float32x4.store(a,8,k),SIMD.Float32x4.store(a,12,l),a},e.transpose=d.USE_SIMD?e.SIMD.transpose:e.scalar.transpose,e.scalar.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null},e.SIMD.invert=function(a,b){var c,d,e,f,g,h,i,j,k,l,m=SIMD.Float32x4.load(b,0),n=SIMD.Float32x4.load(b,4),o=SIMD.Float32x4.load(b,8),p=SIMD.Float32x4.load(b,12);return g=SIMD.Float32x4.shuffle(m,n,0,1,4,5),d=SIMD.Float32x4.shuffle(o,p,0,1,4,5),c=SIMD.Float32x4.shuffle(g,d,0,2,4,6),d=SIMD.Float32x4.shuffle(d,g,1,3,5,7),g=SIMD.Float32x4.shuffle(m,n,2,3,6,7),f=SIMD.Float32x4.shuffle(o,p,2,3,6,7),e=SIMD.Float32x4.shuffle(g,f,0,2,4,6),f=SIMD.Float32x4.shuffle(f,g,1,3,5,7),g=SIMD.Float32x4.mul(e,f),g=SIMD.Float32x4.swizzle(g,1,0,3,2),h=SIMD.Float32x4.mul(d,g),i=SIMD.Float32x4.mul(c,g),g=SIMD.Float32x4.swizzle(g,2,3,0,1),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,g),h),i=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,g),i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),g=SIMD.Float32x4.mul(d,e),g=SIMD.Float32x4.swizzle(g,1,0,3,2),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,g),h),k=SIMD.Float32x4.mul(c,g),g=SIMD.Float32x4.swizzle(g,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(f,g)),k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,g),k),k=SIMD.Float32x4.swizzle(k,2,3,0,1),g=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,3,0,1),f),g=SIMD.Float32x4.swizzle(g,1,0,3,2),e=SIMD.Float32x4.swizzle(e,2,3,0,1),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,g),h),j=SIMD.Float32x4.mul(c,g),g=SIMD.Float32x4.swizzle(g,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(e,g)),j=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,g),j),j=SIMD.Float32x4.swizzle(j,2,3,0,1),g=SIMD.Float32x4.mul(c,d),g=SIMD.Float32x4.swizzle(g,1,0,3,2),j=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,g),j),k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(e,g),k),g=SIMD.Float32x4.swizzle(g,2,3,0,1),j=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,g),j),k=SIMD.Float32x4.sub(k,SIMD.Float32x4.mul(e,g)),g=SIMD.Float32x4.mul(c,f),g=SIMD.Float32x4.swizzle(g,1,0,3,2),i=SIMD.Float32x4.sub(i,SIMD.Float32x4.mul(e,g)),j=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,g),j),g=SIMD.Float32x4.swizzle(g,2,3,0,1),i=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,g),i),j=SIMD.Float32x4.sub(j,SIMD.Float32x4.mul(d,g)),g=SIMD.Float32x4.mul(c,e),g=SIMD.Float32x4.swizzle(g,1,0,3,2),i=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,g),i),k=SIMD.Float32x4.sub(k,SIMD.Float32x4.mul(d,g)),g=SIMD.Float32x4.swizzle(g,2,3,0,1),i=SIMD.Float32x4.sub(i,SIMD.Float32x4.mul(f,g)),k=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,g),k),l=SIMD.Float32x4.mul(c,h),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,2,3,0,1),l),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,1,0,3,2),l),g=SIMD.Float32x4.reciprocalApproximation(l),l=SIMD.Float32x4.sub(SIMD.Float32x4.add(g,g),SIMD.Float32x4.mul(l,SIMD.Float32x4.mul(g,g))),(l=SIMD.Float32x4.swizzle(l,0,0,0,0))?(SIMD.Float32x4.store(a,0,SIMD.Float32x4.mul(l,h)),SIMD.Float32x4.store(a,4,SIMD.Float32x4.mul(l,i)),SIMD.Float32x4.store(a,8,SIMD.Float32x4.mul(l,j)),SIMD.Float32x4.store(a,12,SIMD.Float32x4.mul(l,k)),a):null},e.invert=d.USE_SIMD?e.SIMD.invert:e.scalar.invert,e.scalar.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},e.SIMD.adjoint=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;return c=SIMD.Float32x4.load(b,0),d=SIMD.Float32x4.load(b,4),e=SIMD.Float32x4.load(b,8),f=SIMD.Float32x4.load(b,12),k=SIMD.Float32x4.shuffle(c,d,0,1,4,5),h=SIMD.Float32x4.shuffle(e,f,0,1,4,5),g=SIMD.Float32x4.shuffle(k,h,0,2,4,6),h=SIMD.Float32x4.shuffle(h,k,1,3,5,7),k=SIMD.Float32x4.shuffle(c,d,2,3,6,7),j=SIMD.Float32x4.shuffle(e,f,2,3,6,7),i=SIMD.Float32x4.shuffle(k,j,0,2,4,6),j=SIMD.Float32x4.shuffle(j,k,1,3,5,7),k=SIMD.Float32x4.mul(i,j),k=SIMD.Float32x4.swizzle(k,1,0,3,2),l=SIMD.Float32x4.mul(h,k),m=SIMD.Float32x4.mul(g,k),k=SIMD.Float32x4.swizzle(k,2,3,0,1),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,k),l),m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,k),m),m=SIMD.Float32x4.swizzle(m,2,3,0,1),k=SIMD.Float32x4.mul(h,i),k=SIMD.Float32x4.swizzle(k,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(j,k),l),o=SIMD.Float32x4.mul(g,k),k=SIMD.Float32x4.swizzle(k,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(j,k)),o=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,k),o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),k=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,3,0,1),j),k=SIMD.Float32x4.swizzle(k,1,0,3,2),i=SIMD.Float32x4.swizzle(i,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,k),l),n=SIMD.Float32x4.mul(g,k),k=SIMD.Float32x4.swizzle(k,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(i,k)),n=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,k),n),n=SIMD.Float32x4.swizzle(n,2,3,0,1),k=SIMD.Float32x4.mul(g,h),k=SIMD.Float32x4.swizzle(k,1,0,3,2),n=SIMD.Float32x4.add(SIMD.Float32x4.mul(j,k),n),o=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,k),o),k=SIMD.Float32x4.swizzle(k,2,3,0,1),n=SIMD.Float32x4.sub(SIMD.Float32x4.mul(j,k),n),o=SIMD.Float32x4.sub(o,SIMD.Float32x4.mul(i,k)),k=SIMD.Float32x4.mul(g,j),k=SIMD.Float32x4.swizzle(k,1,0,3,2),m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(i,k)),n=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,k),n),k=SIMD.Float32x4.swizzle(k,2,3,0,1),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,k),m),n=SIMD.Float32x4.sub(n,SIMD.Float32x4.mul(h,k)),k=SIMD.Float32x4.mul(g,i),k=SIMD.Float32x4.swizzle(k,1,0,3,2),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(j,k),m),o=SIMD.Float32x4.sub(o,SIMD.Float32x4.mul(h,k)),k=SIMD.Float32x4.swizzle(k,2,3,0,1),m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(j,k)),o=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,k),o),SIMD.Float32x4.store(a,0,l),SIMD.Float32x4.store(a,4,m),SIMD.Float32x4.store(a,8,n),SIMD.Float32x4.store(a,12,o),a},e.adjoint=d.USE_SIMD?e.SIMD.adjoint:e.scalar.adjoint,e.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x},e.SIMD.multiply=function(a,b,c){var d=SIMD.Float32x4.load(b,0),e=SIMD.Float32x4.load(b,4),f=SIMD.Float32x4.load(b,8),g=SIMD.Float32x4.load(b,12),h=SIMD.Float32x4.load(c,0),i=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),g))));SIMD.Float32x4.store(a,0,i);var j=SIMD.Float32x4.load(c,4),k=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(j,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(j,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(j,2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(j,3,3,3,3),g))));SIMD.Float32x4.store(a,4,k);var l=SIMD.Float32x4.load(c,8),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,3,3,3,3),g))));SIMD.Float32x4.store(a,8,m);var n=SIMD.Float32x4.load(c,12),o=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,3,3,3,3),g))));return SIMD.Float32x4.store(a,12,o),a},e.scalar.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},e.multiply=d.USE_SIMD?e.SIMD.multiply:e.scalar.multiply,e.mul=e.multiply,e.scalar.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},e.SIMD.translate=function(a,b,c){var d=SIMD.Float32x4.load(b,0),e=SIMD.Float32x4.load(b,4),f=SIMD.Float32x4.load(b,8),g=SIMD.Float32x4.load(b,12),h=SIMD.Float32x4(c[0],c[1],c[2],0);b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11]),d=SIMD.Float32x4.mul(d,SIMD.Float32x4.swizzle(h,0,0,0,0)),e=SIMD.Float32x4.mul(e,SIMD.Float32x4.swizzle(h,1,1,1,1)),f=SIMD.Float32x4.mul(f,SIMD.Float32x4.swizzle(h,2,2,2,2));var i=SIMD.Float32x4.add(d,SIMD.Float32x4.add(e,SIMD.Float32x4.add(f,g)));return SIMD.Float32x4.store(a,12,i),a},e.translate=d.USE_SIMD?e.SIMD.translate:e.scalar.translate,e.scalar.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.SIMD.scale=function(a,b,c){var d,e,f,g=SIMD.Float32x4(c[0],c[1],c[2],0);return d=SIMD.Float32x4.load(b,0),SIMD.Float32x4.store(a,0,SIMD.Float32x4.mul(d,SIMD.Float32x4.swizzle(g,0,0,0,0))),e=SIMD.Float32x4.load(b,4),SIMD.Float32x4.store(a,4,SIMD.Float32x4.mul(e,SIMD.Float32x4.swizzle(g,1,1,1,1))),f=SIMD.Float32x4.load(b,8),SIMD.Float32x4.store(a,8,SIMD.Float32x4.mul(f,SIMD.Float32x4.swizzle(g,2,2,2,2))),a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.scale=d.USE_SIMD?e.SIMD.scale:e.scalar.scale,e.rotate=function(a,b,c,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=e[0],E=e[1],F=e[2],G=Math.sqrt(D*D+E*E+F*F);return Math.abs(G)<d.EPSILON?null:(G=1/G,D*=G,E*=G,F*=G,f=Math.sin(c),g=Math.cos(c),h=1-g,i=b[0],j=b[1],k=b[2],l=b[3],m=b[4],n=b[5],o=b[6],p=b[7],q=b[8],r=b[9],s=b[10],t=b[11],u=D*D*h+g,v=E*D*h+F*f,w=F*D*h-E*f,x=D*E*h-F*f,y=E*E*h+g,z=F*E*h+D*f,A=D*F*h+E*f,B=E*F*h-D*f,C=F*F*h+g,a[0]=i*u+m*v+q*w,a[1]=j*u+n*v+r*w,a[2]=k*u+o*v+s*w,a[3]=l*u+p*v+t*w,a[4]=i*x+m*y+q*z,a[5]=j*x+n*y+r*z,a[6]=k*x+o*y+s*z,a[7]=l*x+p*y+t*z,a[8]=i*A+m*B+q*C,a[9]=j*A+n*B+r*C,a[10]=k*A+o*B+s*C,a[11]=l*A+p*B+t*C,b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a)},e.scalar.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a},e.SIMD.rotateX=function(a,b,c){var d=SIMD.Float32x4.splat(Math.sin(c)),e=SIMD.Float32x4.splat(Math.cos(c));b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);var f=SIMD.Float32x4.load(b,4),g=SIMD.Float32x4.load(b,8);return SIMD.Float32x4.store(a,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(f,e),SIMD.Float32x4.mul(g,d))),SIMD.Float32x4.store(a,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,e),SIMD.Float32x4.mul(f,d))),a},e.rotateX=d.USE_SIMD?e.SIMD.rotateX:e.scalar.rotateX,e.scalar.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a},e.SIMD.rotateY=function(a,b,c){var d=SIMD.Float32x4.splat(Math.sin(c)),e=SIMD.Float32x4.splat(Math.cos(c));b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);var f=SIMD.Float32x4.load(b,0),g=SIMD.Float32x4.load(b,8);return SIMD.Float32x4.store(a,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,e),SIMD.Float32x4.mul(g,d))),SIMD.Float32x4.store(a,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(f,d),SIMD.Float32x4.mul(g,e))),a},e.rotateY=d.USE_SIMD?e.SIMD.rotateY:e.scalar.rotateY,e.scalar.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},e.SIMD.rotateZ=function(a,b,c){var d=SIMD.Float32x4.splat(Math.sin(c)),e=SIMD.Float32x4.splat(Math.cos(c));b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);var f=SIMD.Float32x4.load(b,0),g=SIMD.Float32x4.load(b,4);return SIMD.Float32x4.store(a,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(f,e),SIMD.Float32x4.mul(g,d))),SIMD.Float32x4.store(a,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,e),SIMD.Float32x4.mul(f,d))),a},e.rotateZ=d.USE_SIMD?e.SIMD.rotateZ:e.scalar.rotateZ,e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=b[0],a[13]=b[1],a[14]=b[2],a[15]=1,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=b[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromRotation=function(a,b,c){var e,f,g,h=c[0],i=c[1],j=c[2],k=Math.sqrt(h*h+i*i+j*j);return Math.abs(k)<d.EPSILON?null:(k=1/k,h*=k,i*=k,j*=k,e=Math.sin(b),f=Math.cos(b),g=1-f,a[0]=h*h*g+f,a[1]=i*h*g+j*e,a[2]=j*h*g-i*e,a[3]=0,a[4]=h*i*g-j*e,a[5]=i*i*g+f,a[6]=j*i*g+h*e,a[7]=0,a[8]=h*j*g+i*e,a[9]=i*j*g-h*e,a[10]=j*j*g+f,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)},e.fromXRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=d,a[6]=c,a[7]=0,a[8]=0,a[9]=-c,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromYRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=0,a[2]=-c,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=c,a[9]=0,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromZRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=0,a[4]=-c,a[5]=d,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},e.getTranslation=function(a,b){return a[0]=b[12],a[1]=b[13],a[2]=b[14],a},e.getRotation=function(a,b){var c=b[0]+b[5]+b[10],d=0;return c>0?(d=2*Math.sqrt(c+1),a[3]=.25*d,a[0]=(b[6]-b[9])/d,a[1]=(b[8]-b[2])/d,a[2]=(b[1]-b[4])/d):b[0]>b[5]&b[0]>b[10]?(d=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/d,a[0]=.25*d,a[1]=(b[1]+b[4])/d,a[2]=(b[8]+b[2])/d):b[5]>b[10]?(d=2*Math.sqrt(1+b[5]-b[0]-b[10]),
a[3]=(b[8]-b[2])/d,a[0]=(b[1]+b[4])/d,a[1]=.25*d,a[2]=(b[6]+b[9])/d):(d=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/d,a[0]=(b[8]+b[2])/d,a[1]=(b[6]+b[9])/d,a[2]=.25*d),a},e.fromRotationTranslationScale=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3],i=e+e,j=f+f,k=g+g,l=e*i,m=e*j,n=e*k,o=f*j,p=f*k,q=g*k,r=h*i,s=h*j,t=h*k,u=d[0],v=d[1],w=d[2];return a[0]=(1-(o+q))*u,a[1]=(m+t)*u,a[2]=(n-s)*u,a[3]=0,a[4]=(m-t)*v,a[5]=(1-(l+q))*v,a[6]=(p+r)*v,a[7]=0,a[8]=(n+s)*w,a[9]=(p-r)*w,a[10]=(1-(l+o))*w,a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},e.fromRotationTranslationScaleOrigin=function(a,b,c,d,e){var f=b[0],g=b[1],h=b[2],i=b[3],j=f+f,k=g+g,l=h+h,m=f*j,n=f*k,o=f*l,p=g*k,q=g*l,r=h*l,s=i*j,t=i*k,u=i*l,v=d[0],w=d[1],x=d[2],y=e[0],z=e[1],A=e[2];return a[0]=(1-(p+r))*v,a[1]=(n+u)*v,a[2]=(o-t)*v,a[3]=0,a[4]=(n-u)*w,a[5]=(1-(m+r))*w,a[6]=(q+s)*w,a[7]=0,a[8]=(o+t)*x,a[9]=(q-s)*x,a[10]=(1-(m+p))*x,a[11]=0,a[12]=c[0]+y-(a[0]*y+a[4]*z+a[8]*A),a[13]=c[1]+z-(a[1]*y+a[5]*z+a[9]*A),a[14]=c[2]+A-(a[2]*y+a[6]*z+a[10]*A),a[15]=1,a},e.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[1]=k+r,a[2]=m-q,a[3]=0,a[4]=k-r,a[5]=1-j-o,a[6]=n+p,a[7]=0,a[8]=m+q,a[9]=n-p,a[10]=1-j-l,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=g*f*2*j,a[15]=0,a},e.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},e.perspectiveFromFieldOfView=function(a,b,c,d){var e=Math.tan(b.upDegrees*Math.PI/180),f=Math.tan(b.downDegrees*Math.PI/180),g=Math.tan(b.leftDegrees*Math.PI/180),h=Math.tan(b.rightDegrees*Math.PI/180),i=2/(g+h),j=2/(e+f);return a[0]=i,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=j,a[6]=0,a[7]=0,a[8]=-((g-h)*i*.5),a[9]=(e-f)*j*.5,a[10]=d/(c-d),a[11]=-1,a[12]=0,a[13]=0,a[14]=d*c/(c-d),a[15]=0,a},e.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},e.lookAt=function(a,b,c,f){var g,h,i,j,k,l,m,n,o,p,q=b[0],r=b[1],s=b[2],t=f[0],u=f[1],v=f[2],w=c[0],x=c[1],y=c[2];return Math.abs(q-w)<d.EPSILON&&Math.abs(r-x)<d.EPSILON&&Math.abs(s-y)<d.EPSILON?e.identity(a):(m=q-w,n=r-x,o=s-y,p=1/Math.sqrt(m*m+n*n+o*o),m*=p,n*=p,o*=p,g=u*o-v*n,h=v*m-t*o,i=t*n-u*m,p=Math.sqrt(g*g+h*h+i*i),p?(p=1/p,g*=p,h*=p,i*=p):(g=0,h=0,i=0),j=n*i-o*h,k=o*g-m*i,l=m*h-n*g,p=Math.sqrt(j*j+k*k+l*l),p?(p=1/p,j*=p,k*=p,l*=p):(j=0,k=0,l=0),a[0]=g,a[1]=j,a[2]=m,a[3]=0,a[4]=h,a[5]=k,a[6]=n,a[7]=0,a[8]=i,a[9]=l,a[10]=o,a[11]=0,a[12]=-(g*q+h*r+i*s),a[13]=-(j*q+k*r+l*s),a[14]=-(m*q+n*r+o*s),a[15]=1,a)},e.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a[4]=b[4]+c[4],a[5]=b[5]+c[5],a[6]=b[6]+c[6],a[7]=b[7]+c[7],a[8]=b[8]+c[8],a[9]=b[9]+c[9],a[10]=b[10]+c[10],a[11]=b[11]+c[11],a[12]=b[12]+c[12],a[13]=b[13]+c[13],a[14]=b[14]+c[14],a[15]=b[15]+c[15],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a[4]=b[4]-c[4],a[5]=b[5]-c[5],a[6]=b[6]-c[6],a[7]=b[7]-c[7],a[8]=b[8]-c[8],a[9]=b[9]-c[9],a[10]=b[10]-c[10],a[11]=b[11]-c[11],a[12]=b[12]-c[12],a[13]=b[13]-c[13],a[14]=b[14]-c[14],a[15]=b[15]-c[15],a},e.sub=e.subtract,e.multiplyScalar=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a[4]=b[4]*c,a[5]=b[5]*c,a[6]=b[6]*c,a[7]=b[7]*c,a[8]=b[8]*c,a[9]=b[9]*c,a[10]=b[10]*c,a[11]=b[11]*c,a[12]=b[12]*c,a[13]=b[13]*c,a[14]=b[14]*c,a[15]=b[15]*c,a},e.multiplyScalarAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a[4]=b[4]+c[4]*d,a[5]=b[5]+c[5]*d,a[6]=b[6]+c[6]*d,a[7]=b[7]+c[7]*d,a[8]=b[8]+c[8]*d,a[9]=b[9]+c[9]*d,a[10]=b[10]+c[10]*d,a[11]=b[11]+c[11]*d,a[12]=b[12]+c[12]*d,a[13]=b[13]+c[13]*d,a[14]=b[14]+c[14]*d,a[15]=b[15]+c[15]*d,a},e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]},e.equals=function(a,b){var c=a[0],e=a[1],f=a[2],g=a[3],h=a[4],i=a[5],j=a[6],k=a[7],l=a[8],m=a[9],n=a[10],o=a[11],p=a[12],q=a[13],r=a[14],s=a[15],t=b[0],u=b[1],v=b[2],w=b[3],x=b[4],y=b[5],z=b[6],A=b[7],B=b[8],C=b[9],D=b[10],E=b[11],F=b[12],G=b[13],H=b[14],I=b[15];return Math.abs(c-t)<=d.EPSILON*Math.max(1,Math.abs(c),Math.abs(t))&&Math.abs(e-u)<=d.EPSILON*Math.max(1,Math.abs(e),Math.abs(u))&&Math.abs(f-v)<=d.EPSILON*Math.max(1,Math.abs(f),Math.abs(v))&&Math.abs(g-w)<=d.EPSILON*Math.max(1,Math.abs(g),Math.abs(w))&&Math.abs(h-x)<=d.EPSILON*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(i-y)<=d.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(j-z)<=d.EPSILON*Math.max(1,Math.abs(j),Math.abs(z))&&Math.abs(k-A)<=d.EPSILON*Math.max(1,Math.abs(k),Math.abs(A))&&Math.abs(l-B)<=d.EPSILON*Math.max(1,Math.abs(l),Math.abs(B))&&Math.abs(m-C)<=d.EPSILON*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(n-D)<=d.EPSILON*Math.max(1,Math.abs(n),Math.abs(D))&&Math.abs(o-E)<=d.EPSILON*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(p-F)<=d.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(q-G)<=d.EPSILON*Math.max(1,Math.abs(q),Math.abs(G))&&Math.abs(r-H)<=d.EPSILON*Math.max(1,Math.abs(r),Math.abs(H))&&Math.abs(s-I)<=d.EPSILON*Math.max(1,Math.abs(s),Math.abs(I))},a.exports=e},function(a,b,c){var d=c(1),e=c(4),f=c(7),g=c(8),h={};h.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},h.rotationTo=function(){var a=f.create(),b=f.fromValues(1,0,0),c=f.fromValues(0,1,0);return function(d,e,g){var i=f.dot(e,g);return i<-.999999?(f.cross(a,b,e),f.length(a)<1e-6&&f.cross(a,c,e),f.normalize(a,a),h.setAxisAngle(d,a,Math.PI),d):i>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(f.cross(a,e,g),d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=1+i,h.normalize(d,d))}}(),h.setAxes=function(){var a=e.create();return function(b,c,d,e){return a[0]=d[0],a[3]=d[1],a[6]=d[2],a[1]=e[0],a[4]=e[1],a[7]=e[2],a[2]=-c[0],a[5]=-c[1],a[8]=-c[2],h.normalize(b,h.fromMat3(b,a))}}(),h.clone=g.clone,h.fromValues=g.fromValues,h.copy=g.copy,h.set=g.set,h.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},h.setAxisAngle=function(a,b,c){c=.5*c;var d=Math.sin(c);return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=Math.cos(c),a},h.getAxisAngle=function(a,b){var c=2*Math.acos(b[3]),d=Math.sin(c/2);return 0!=d?(a[0]=b[0]/d,a[1]=b[1]/d,a[2]=b[2]/d):(a[0]=1,a[1]=0,a[2]=0),c},h.add=g.add,h.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a},h.mul=h.multiply,h.scale=g.scale,h.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+g*h,a[1]=e*i+f*h,a[2]=f*i-e*h,a[3]=g*i-d*h,a},h.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i-f*h,a[1]=e*i+g*h,a[2]=f*i+d*h,a[3]=g*i-e*h,a},h.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=e*i-d*h,a[2]=f*i+g*h,a[3]=g*i-f*h,a},h.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];return a[0]=c,a[1]=d,a[2]=e,a[3]=Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a},h.dot=g.dot,h.lerp=g.lerp,h.slerp=function(a,b,c,d){var e,f,g,h,i,j=b[0],k=b[1],l=b[2],m=b[3],n=c[0],o=c[1],p=c[2],q=c[3];return f=j*n+k*o+l*p+m*q,f<0&&(f=-f,n=-n,o=-o,p=-p,q=-q),1-f>1e-6?(e=Math.acos(f),g=Math.sin(e),h=Math.sin((1-d)*e)/g,i=Math.sin(d*e)/g):(h=1-d,i=d),a[0]=h*j+i*n,a[1]=h*k+i*o,a[2]=h*l+i*p,a[3]=h*m+i*q,a},h.sqlerp=function(){var a=h.create(),b=h.create();return function(c,d,e,f,g,i){return h.slerp(a,d,g,i),h.slerp(b,e,f,i),h.slerp(c,a,b,2*i*(1-i)),c}}(),h.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1/g:0;return a[0]=-c*h,a[1]=-d*h,a[2]=-e*h,a[3]=f*h,a},h.conjugate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=b[3],a},h.length=g.length,h.len=h.length,h.squaredLength=g.squaredLength,h.sqrLen=h.squaredLength,h.normalize=g.normalize,h.fromMat3=function(a,b){var c,d=b[0]+b[4]+b[8];if(d>0)c=Math.sqrt(d+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=(b[1]-b[3])*c;else{var e=0;b[4]>b[0]&&(e=1),b[8]>b[3*e+e]&&(e=2);var f=(e+1)%3,g=(e+2)%3;c=Math.sqrt(b[3*e+e]-b[3*f+f]-b[3*g+g]+1),a[e]=.5*c,c=.5/c,a[3]=(b[3*f+g]-b[3*g+f])*c,a[f]=(b[3*f+e]+b[3*e+f])*c,a[g]=(b[3*g+e]+b[3*e+g])*c}return a},h.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},h.exactEquals=g.exactEquals,h.equals=g.equals,a.exports=h},function(a,b,c){var d=c(1),e={};e.create=function(){var a=new d.ARRAY_TYPE(3);return a[0]=0,a[1]=0,a[2]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(3);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},e.fromValues=function(a,b,c){var e=new d.ARRAY_TYPE(3);return e[0]=a,e[1]=b,e[2]=c,e},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a},e.set=function(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a},e.div=e.divide,e.ceil=function(a,b){return a[0]=Math.ceil(b[0]),a[1]=Math.ceil(b[1]),a[2]=Math.ceil(b[2]),a},e.floor=function(a,b){return a[0]=Math.floor(b[0]),a[1]=Math.floor(b[1]),a[2]=Math.floor(b[2]),a},e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a},e.round=function(a,b){return a[0]=Math.round(b[0]),a[1]=Math.round(b[1]),a[2]=Math.round(b[2]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},e.cross=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a},e.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a},e.hermite=function(a,b,c,d,e,f){var g=f*f,h=g*(2*f-3)+1,i=g*(f-2)+f,j=g*(f-1),k=g*(3-2*f);return a[0]=b[0]*h+c[0]*i+d[0]*j+e[0]*k,a[1]=b[1]*h+c[1]*i+d[1]*j+e[1]*k,a[2]=b[2]*h+c[2]*i+d[2]*j+e[2]*k,a},e.bezier=function(a,b,c,d,e,f){var g=1-f,h=g*g,i=f*f,j=h*g,k=3*f*h,l=3*i*g,m=i*f;return a[0]=b[0]*j+c[0]*k+d[0]*l+e[0]*m,a[1]=b[1]*j+c[1]*k+d[1]*l+e[1]*m,a[2]=b[2]*j+c[2]*k+d[2]*l+e[2]*m,a},e.random=function(a,b){b=b||1;var c=2*d.RANDOM()*Math.PI,e=2*d.RANDOM()-1,f=Math.sqrt(1-e*e)*b;return a[0]=Math.cos(c)*f,a[1]=Math.sin(c)*f,a[2]=e*b,a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[3]*d+c[7]*e+c[11]*f+c[15];return g=g||1,a[0]=(c[0]*d+c[4]*e+c[8]*f+c[12])/g,a[1]=(c[1]*d+c[5]*e+c[9]*f+c[13])/g,a[2]=(c[2]*d+c[6]*e+c[10]*f+c[14])/g,a},e.transformMat3=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=d*c[0]+e*c[3]+f*c[6],a[1]=d*c[1]+e*c[4]+f*c[7],a[2]=d*c[2]+e*c[5]+f*c[8],a},e.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},e.rotateX=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0],f[1]=e[1]*Math.cos(d)-e[2]*Math.sin(d),f[2]=e[1]*Math.sin(d)+e[2]*Math.cos(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.rotateY=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[2]*Math.sin(d)+e[0]*Math.cos(d),f[1]=e[1],f[2]=e[2]*Math.cos(d)-e[0]*Math.sin(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.rotateZ=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0]*Math.cos(d)-e[1]*Math.sin(d),f[1]=e[0]*Math.sin(d)+e[1]*Math.cos(d),f[2]=e[2],a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=3),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;h<i;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2];return b}}(),e.angle=function(a,b){var c=e.fromValues(a[0],a[1],a[2]),d=e.fromValues(b[0],b[1],b[2]);e.normalize(c,c),e.normalize(d,d);var f=e.dot(c,d);return f>1?0:Math.acos(f)},e.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]},e.equals=function(a,b){var c=a[0],e=a[1],f=a[2],g=b[0],h=b[1],i=b[2];return Math.abs(c-g)<=d.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(e-h)<=d.EPSILON*Math.max(1,Math.abs(e),Math.abs(h))&&Math.abs(f-i)<=d.EPSILON*Math.max(1,Math.abs(f),Math.abs(i))},a.exports=e},function(a,b,c){var d=c(1),e={};e.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},e.fromValues=function(a,b,c,e){var f=new d.ARRAY_TYPE(4);return f[0]=a,f[1]=b,f[2]=c,f[3]=e,f},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},e.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a},e.div=e.divide,e.ceil=function(a,b){return a[0]=Math.ceil(b[0]),a[1]=Math.ceil(b[1]),a[2]=Math.ceil(b[2]),a[3]=Math.ceil(b[3]),a},e.floor=function(a,b){return a[0]=Math.floor(b[0]),a[1]=Math.floor(b[1]),a[2]=Math.floor(b[2]),a[3]=Math.floor(b[3]),a},e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a[3]=Math.min(b[3],c[3]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a},e.round=function(a,b){return a[0]=Math.round(b[0]),a[1]=Math.round(b[1]),a[2]=Math.round(b[2]),a[3]=Math.round(b[3]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a[3]=1/b[3],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g),a[0]=c*g,a[1]=d*g,a[2]=e*g,a[3]=f*g),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},e.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a},e.random=function(a,b){return b=b||1,a[0]=d.RANDOM(),a[1]=d.RANDOM(),a[2]=d.RANDOM(),a[3]=d.RANDOM(),e.normalize(a,a),e.scale(a,a,b),a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a},e.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a[3]=b[3],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=4),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;h<i;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],a[3]=b[h+3],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2],b[h+3]=a[3];return b}}(),e.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]},e.equals=function(a,b){var c=a[0],e=a[1],f=a[2],g=a[3],h=b[0],i=b[1],j=b[2],k=b[3];return Math.abs(c-h)<=d.EPSILON*Math.max(1,Math.abs(c),Math.abs(h))&&Math.abs(e-i)<=d.EPSILON*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(f-j)<=d.EPSILON*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(g-k)<=d.EPSILON*Math.max(1,Math.abs(g),Math.abs(k))},a.exports=e},function(a,b,c){var d=c(1),e={};e.create=function(){var a=new d.ARRAY_TYPE(2);return a[0]=0,a[1]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(2);return b[0]=a[0],b[1]=a[1],b},e.fromValues=function(a,b){var c=new d.ARRAY_TYPE(2);return c[0]=a,c[1]=b,c},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},e.set=function(a,b,c){return a[0]=b,a[1]=c,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},e.div=e.divide,e.ceil=function(a,b){return a[0]=Math.ceil(b[0]),a[1]=Math.ceil(b[1]),a},e.floor=function(a,b){return a[0]=Math.floor(b[0]),a[1]=Math.floor(b[1]),a},e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},e.round=function(a,b){return a[0]=Math.round(b[0]),a[1]=Math.round(b[1]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},e.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},e.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},e.random=function(a,b){b=b||1;var c=2*d.RANDOM()*Math.PI;return a[0]=Math.cos(c)*b,a[1]=Math.sin(c)*b,a},e.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e,a[1]=c[1]*d+c[3]*e,a},e.transformMat2d=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e+c[4],a[1]=c[1]*d+c[3]*e+c[5],a},e.transformMat3=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[3]*e+c[6],a[1]=c[1]*d+c[4]*e+c[7],a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[4]*e+c[12],a[1]=c[1]*d+c[5]*e+c[13],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;h<i;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),e.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]},e.equals=function(a,b){var c=a[0],e=a[1],f=b[0],g=b[1];return Math.abs(c-f)<=d.EPSILON*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(e-g)<=d.EPSILON*Math.max(1,Math.abs(e),Math.abs(g))},a.exports=e}])}),WebGLUtils.prototype._compileShader=function(a,b,c){var d=a.createShader(c);a.shaderSource(d,b),a.compileShader(d);var e=a.getShaderParameter(d,a.COMPILE_STATUS);if(!e){var f=a.getShaderInfoLog(d);return this._logger.error("Error compiling shader '"+d+"':"+f),a.deleteShader(d),null}return d},WebGLUtils.prototype.createProgram=function(a,b,c){var d=a.createProgram();a.attachShader(d,b),a.attachShader(d,c),a.linkProgram(d);var e=a.getProgramParameter(d,a.LINK_STATUS);return e||this._logger.error("Program filed to link:"+a.getProgramInfoLog(d)),d},WebGLUtils.prototype.createShader=function(a,b,c){var d;if("vertex"===c)d=a.VERTEX_SHADER;else if("fragment"===c)d=a.FRAGMENT_SHADER;else if(!c)return this._logger.warn("Shader type not set, discarding.."),null;return this._compileShader(a,b,d)},WebGLUtils.prototype.createShaderFromScript=function(a,b,c){var d=document.getElementById(b);return d?void this.createShader(a,d.text,c):(this._logger.warn("Unknown script target element, discarding.."),null)},WebGLUtils.prototype.createProgramFromScripts=function(a,b,c){var d=this.createShader(a,b,"vertex"),e=this.createShader(a,c,"fragment");return isObjectAssigned(d)&&isObjectAssigned(e)?this.createProgram(a,d,e):(this._logger.warn("Could not create program because scripts could not be compiled, discarding.."),a.deleteShader(d),a.deleteShader(e),null)},WebGLUtils.prototype.createProgramFromScriptElements=function(a,b,c){var d=this.createShaderFromScript(a,b,"vertex"),e=this.createShaderFromScript(a,c,"fragment");return isObjectAssigned(d)&&isObjectAssigned(e)?this.createProgram(a,d,e):(this._logger.warn("Could not create program because scripts could not be compiled, discarding.."),a.deleteShader(d),a.deleteShader(e),null)};var glu=new WebGLUtils;inheritsFrom(PrimitiveShader,Shader);